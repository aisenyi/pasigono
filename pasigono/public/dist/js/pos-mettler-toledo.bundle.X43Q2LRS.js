(()=>{var n,i,l=0,c=!1,f=!1,d;onmessage=function(a){a.data.command=="connect"?m():a.data.command=="start"?(console.log("Start called"),c=!0,u()):a.data.command=="stop"&&(c=!1)};async function m(){var a=!1,e=await navigator.serial.getPorts();if(i=new TextEncoderStream,e.length>0){n=e[0];var r=!1;try{await n.open({baudRate:9600,dataBits:7,parity:"even",stopBits:1}),i.readable.pipeTo(n.writable),d=n.readable.getReader(),f=!0}catch(t){}}}async function u(){if(f){console.log("Port connected");try{var a="";await s("W")}catch(o){}for(;n.readable&&c;)try{for(;c;){let{value:o,done:v}=await d.read();if(o){var[e,r]=await w(o);if(!r)a.concat(e);else{a==""?a=e:a.concat(e);var t=parseFloat(a);console.log({"new weight":t}),t!=l&&!isNaN(t)&&(l=t,postMessage({message:"weight",weight:l})),setTimeout(async function(){a="",await s("W")},500)}}}}catch(o){console.log(o.message)}finally{}}}async function s(a){try{var e=i.writable.getWriter();await e.write(a),e.releaseLock()}catch(r){console.log(r.message)}}async function w(a){for(var e="",r=!1,t=0;t<a.byteLength;t++)a[t]!=2&&(a[t]==13?r=!0:e=e.concat(String.fromCharCode(a[t])));return[e,r]}})();
//# sourceMappingURL=pos-mettler-toledo.bundle.X43Q2LRS.js.map
