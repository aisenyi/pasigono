{
  "version": 3,
  "sources": ["../../../../../apps/erpnext/node_modules/onscan.js/onscan.js", "../../../../../apps/pasigono/pasigono/custom_scripts/stripe_terminal/stripe_terminal.js", "../../../../../apps/pasigono/pasigono/pos_assets/pos_item_selector.js", "../../../../../apps/pasigono/pasigono/pos_assets/pos_item_cart.js", "../../../../../apps/pasigono/pasigono/pos_assets/pos_item_details.js", "../../../../../apps/pasigono/pasigono/custom_scripts/pos_scripts/pos_item_details.js", "../../../../../apps/pasigono/pasigono/pos_assets/pos_number_pad.js", "../../../../../apps/pasigono/pasigono/pos_assets/pos_payment.js", "../../../../../apps/pasigono/pasigono/custom_scripts/pos_scripts/pos_payment.js", "../../../../../apps/pasigono/pasigono/pos_assets/pos_past_order_list.js", "../../../../../apps/pasigono/pasigono/pos_assets/pos_past_order_summary.js", "../../../../../apps/pasigono/pasigono/custom_scripts/pos_scripts/pos_past_order_summary.js", "../../../../../apps/pasigono/pasigono/pos_assets/pos_controller.js", "../../../../../apps/pasigono/pasigono/custom_scripts/pos_scripts/pos_controller.js"],
  "sourcesContent": ["/*\n * onScan.js - scan-events for hardware barcodes scanners in javascript\n */\n;(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define(factory()) :\n    global.onScan = factory()\n}(this, (function () {\n\tvar onScan = {\t\n\t\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @param Object oOptions\n\t\t * @return self\n\t\t */\n\t\tattachTo: function(oDomElement, oOptions) {\n\t\n\t\t\tif(oDomElement.scannerDetectionData !== undefined){\n\t\t\t\tthrow new Error(\"onScan.js is already initialized for DOM element \" + oDomElement);\n\t\t\t}\n\t\n\t\t\tvar oDefaults = {\n\t\t\t\tonScan: function(sScanned, iQty){}, // Callback after detection of a successfull scanning:  function(){sScancode, iCount)}()\n\t\t\t\tonScanError: function(oDebug){}, // Callback after detection of a unsuccessfull scanning (scanned string in parameter)\n\t\t\t\tonKeyProcess: function(sChar, oEvent){}, // Callback after receiving and processing a char (scanned char in parameter)\n\t\t\t\tonKeyDetect: function(iKeyCode, oEvent){}, // Callback after detecting a keyDown (key char in parameter) - in contrast to onKeyProcess, this fires for non-character keys like tab, arrows, etc. too!\n\t\t\t\tonPaste: function(sPasted, oEvent){}, // Callback after receiving a value on paste, no matter if it is a valid code or not\n\t\t\t\tkeyCodeMapper: function(oEvent) {return onScan.decodeKeyEvent(oEvent)}, // Custom function to decode a keydown event into a character. Must return decoded character or NULL if the given event should not be processed.\n\t\t\t\tonScanButtonLongPress: function(){}, // Callback after detection of a successfull scan while the scan button was pressed and held down\n\t\t\t\tscanButtonKeyCode:false, // Key code of the scanner hardware button (if the scanner button a acts as a key itself) \n\t\t\t\tscanButtonLongPressTime:500, // How long (ms) the hardware button should be pressed, until a callback gets executed\n\t\t\t\ttimeBeforeScanTest:100, // Wait duration (ms) after keypress event to check if scanning is finished\n\t\t\t\tavgTimeByChar:30, // Average time (ms) between 2 chars. Used to do difference between keyboard typing and scanning\n\t\t\t\tminLength:6, // Minimum length for a scanning\n\t\t\t\tsuffixKeyCodes:[9,13], // Chars to remove and means end of scanning\n\t\t\t\tprefixKeyCodes:[], // Chars to remove and means start of scanning\n\t\t\t\tignoreIfFocusOn:false, // do not handle scans if the currently focused element matches this selector or object\n\t\t\t\tstopPropagation:false, // Stop immediate propagation on keypress event\n\t\t\t\tpreventDefault:false, // Prevent default action on keypress event\n\t\t\t\tcaptureEvents:false, // Get the events before any listeners deeper in the DOM\n\t\t\t\treactToKeydown:true, // look for scan input in keyboard events\n\t\t\t\treactToPaste:false, // look for scan input in paste events\n\t\t\t\tsingleScanQty: 1, // Quantity of Items put out to onScan in a single scan\n\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\toOptions = this._mergeOptions(oDefaults, oOptions);\n\t\n\t\t\t// initializing options and variables on DomElement\n\t\t\toDomElement.scannerDetectionData = {\n\t\t\t\t\toptions: oOptions,\n\t\t\t\t\tvars:{\n\t\t\t\t\t\tfirstCharTime: 0,\n\t\t\t\t\t\tlastCharTime: 0,\n\t\t\t\t\t\taccumulatedString: '',\n\t\t\t\t\t\ttestTimer: false,\n\t\t\t\t\t\tlongPressTimeStart: 0,\n\t\t\t\t\t\tlongPressed: false\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t};\n\t\t\t\n\t\t\t// initializing handlers (based on settings)\n\t\t\tif (oOptions.reactToPaste === true){\n\t\t\t\toDomElement.addEventListener(\"paste\", this._handlePaste, oOptions.captureEvents);\n\t\t\t}\n\t\t\tif (oOptions.scanButtonKeyCode !== false){\n\t\t\t\toDomElement.addEventListener(\"keyup\", this._handleKeyUp, oOptions.captureEvents);\n\t\t\t}\n\t\t\tif (oOptions.reactToKeydown === true || oOptions.scanButtonKeyCode !== false){\t\n\t\t\t\toDomElement.addEventListener(\"keydown\", this._handleKeyDown, oOptions.captureEvents);\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @return void\n\t\t */\n\t\tdetachFrom: function(oDomElement) {\n\t\t\t// detaching all used events\n\t\t\tif (oDomElement.scannerDetectionData.options.reactToPaste){\n\t\t\t\toDomElement.removeEventListener(\"paste\", this._handlePaste);\n\t\t\t}\n\t\t\tif (oDomElement.scannerDetectionData.options.scanButtonKeyCode !== false){\n\t\t\t\toDomElement.removeEventListener(\"keyup\", this._handleKeyUp);\n\t\t\t}\n\t\t\toDomElement.removeEventListener(\"keydown\", this._handleKeyDown);\n\t\t\t\n\t\t\t// clearing data off DomElement\n\t\t\toDomElement.scannerDetectionData = undefined; \n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @return Object\n\t\t */\n\t\tgetOptions: function(oDomElement){\n\t\t\treturn oDomElement.scannerDetectionData.options;\t\t\t\n\t\t},\n\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @param Object oOptions\n\t\t * @return self\n\t\t */\n\t\tsetOptions: function(oDomElement, oOptions){\n\t\t\t// check if some handlers need to be changed based on possible option changes\n\t\t\tswitch (oDomElement.scannerDetectionData.options.reactToPaste){\n\t\t\t\tcase true: \n\t\t\t\t\tif (oOptions.reactToPaste === false){\n\t\t\t\t\t\toDomElement.removeEventListener(\"paste\", this._handlePaste);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase false:\n\t\t\t\t\tif (oOptions.reactToPaste === true){\n\t\t\t\t\t\toDomElement.addEventListener(\"paste\", this._handlePaste);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\tswitch (oDomElement.scannerDetectionData.options.scanButtonKeyCode){\n\t\t\t\tcase false:\n\t\t\t\t\tif (oOptions.scanButtonKeyCode !== false){\n\t\t\t\t\t\toDomElement.addEventListener(\"keyup\", this._handleKeyUp);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault: \n\t\t\t\t\tif (oOptions.scanButtonKeyCode === false){\n\t\t\t\t\t\toDomElement.removeEventListener(\"keyup\", this._handleKeyUp);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\t// merge old and new options\n\t\t\toDomElement.scannerDetectionData.options = this._mergeOptions(oDomElement.scannerDetectionData.options, oOptions);\n\t\t\n\t\t\t// reinitiallize\n\t\t\tthis._reinitialize(oDomElement);\n\t\t\treturn this;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Transforms key codes into characters.\n\t\t * \n\t\t * By default, only the follwing key codes are taken into account\n\t\t * - 48-90 (letters and regular numbers)\n\t\t * - 96-105 (numeric keypad numbers)\n\t\t * - 106-111 (numeric keypad operations)\n\t\t * \n\t\t * All other keys will yield empty strings!\n\t\t * \n\t\t * The above keycodes will be decoded using the KeyboardEvent.key property on modern\n\t\t * browsers. On older browsers the method will fall back to String.fromCharCode()\n\t\t * putting the result to upper/lower case depending on KeyboardEvent.shiftKey if\n\t\t * it is set.\n\t\t * \n\t\t * @param KeyboardEvent oEvent\n\t\t * @return string\n\t\t */\n\t\tdecodeKeyEvent : function (oEvent) {\n\t\t\tvar iCode = this._getNormalizedKeyNum(oEvent);\n\t\t\tswitch (true) {\n\t\t\t\tcase iCode >= 48 && iCode <= 90: // numbers and letters\n\t\t\t\tcase iCode >= 106 && iCode <= 111: // operations on numeric keypad (+, -, etc.)\n\t\t\t\t\tif (oEvent.key !== undefined && oEvent.key !== '') {\n\t\t\t\t\t\treturn oEvent.key;\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\tvar sDecoded = String.fromCharCode(iCode);\n\t\t\t\t\tswitch (oEvent.shiftKey) {\n\t\t\t\t\t\tcase false: sDecoded = sDecoded.toLowerCase(); break;\n\t\t\t\t\t\tcase true: sDecoded = sDecoded.toUpperCase(); break;\n\t\t\t\t\t}\n\t\t\t\t\treturn sDecoded;\n\t\t\t\tcase iCode >= 96 && iCode <= 105: // numbers on numeric keypad\n\t\t\t\t\treturn 0+(iCode-96);\n\t\t\t}\n\t\t\treturn '';\n\t\t},\n\t\t\n\t\t/**\n\t\t * Simulates a scan of the provided code.\n\t     *\n\t\t * The scan code can be defined as\n\t\t * - a string - in this case no keyCode decoding is done and the code is merely validated\n\t\t * against constraints like minLenght, etc.\n\t\t * - an array of keyCodes (e.g. `[70,71,80]`) - will produce `keydown` events with corresponding\n\t\t * `keyCode` properties. NOTE: these events will have empty `key` properties, so decoding may\n\t\t * yield different results than with native events.\n\t\t * - an array of objects (e.g. `[{keyCode: 70, key: \"F\", shiftKey: true}, {keyCode: 71, key: \"g\"}]`) -\n\t\t * this way almost any event can be simulated, but it's a lot of work to do.\n\t\t *\n\t\t * @param DomElement oDomElement\n\t\t * @param string|array mStringOrArray\n\t\t * @return self\n\t\t */\n\t\tsimulate: function(oDomElement, mStringOrArray){\n\t\t\tthis._reinitialize(oDomElement);\n\t\t\tif (Array.isArray(mStringOrArray)){\n\t\t\t\tmStringOrArray.forEach(function(mKey){\n\t\t\t\t\tvar oEventProps = {};\n\t\t\t\t\tif( (typeof mKey === \"object\" || typeof mKey === 'function') && (mKey !== null) ) {\n\t\t\t\t\t\toEventProps = mKey;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toEventProps.keyCode = parseInt(mKey);\n\t\t\t\t\t}\n\t\t\t\t\tvar oEvent = new KeyboardEvent('keydown', oEventProps);\n\t\t\t\t\tdocument.dispatchEvent(oEvent);\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tthis._validateScanCode(oDomElement, mStringOrArray);\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param DomElement oDomElement\n\t\t * @return void\n\t\t */\n\t\t_reinitialize: function(oDomElement){\n\t\t\tvar oVars = oDomElement.scannerDetectionData.vars;\n\t\t\toVars.firstCharTime = 0;\n\t\t\toVars.lastCharTime = 0;\n\t\t\toVars.accumulatedString = '';\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param DomElement oDomElement\n\t     * @return boolean\n\t\t */\n\t\t_isFocusOnIgnoredElement: function(oDomElement){\n\t\t\t\n\t\t\tvar ignoreSelectors = oDomElement.scannerDetectionData.options.ignoreIfFocusOn;\n\t\n\t        if(!ignoreSelectors){\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\n\t\t\tvar oFocused = document.activeElement;\n\t\t\t\n\t\t\t// checks if ignored element is an array, and if so it checks if one of the elements of it is an active one\n\t\t\tif (Array.isArray(ignoreSelectors)){\n\t\t\t\tfor(var i=0; i<ignoreSelectors.length; i++){\n\t\t\t\t\tif(oFocused.matches(ignoreSelectors[i]) === true){\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t// if the option consists of an single element, it only checks this one\n\t\t\t} else if (oFocused.matches(ignoreSelectors)){\n\t\t\t\treturn true;\t\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t// if the active element is not listed in the ignoreIfFocusOn option, return false\n\t\t    return false;\n\t    },\n\t\t\n\t    /**\n\t     * Validates the scan code accumulated by the given DOM element and fires the respective events.\n\t     * \n\t     * @private\n\t     * @param DomElement oDomElement\n\t     * @return boolean\n\t     */\n\t\t_validateScanCode: function(oDomElement, sScanCode){\n\t\t\tvar oScannerData = oDomElement.scannerDetectionData;\t\t\t\n\t\t\tvar oOptions = oScannerData.options;\n\t\t\tvar iSingleScanQty = oScannerData.options.singleScanQty;\n\t\t\tvar iFirstCharTime = oScannerData.vars.firstCharTime;\n\t\t\tvar iLastCharTime = oScannerData.vars.lastCharTime;\n\t\t\tvar oScanError = {};\n\t        var oEvent;\n\t        \n\t\t\tswitch(true){\n\t\t\t\t\n\t\t\t\t// detect codes that are too short\n\t\t\t\tcase (sScanCode.length < oOptions.minLength):\n\t\t\t\t\toScanError = {\n\t\t\t\t\t\tmessage: \"Receieved code is shorter then minimal length\"\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// detect codes that were entered too slow\t\n\t\t\t\tcase ((iLastCharTime - iFirstCharTime) > (sScanCode.length * oOptions.avgTimeByChar)):\n\t\t\t\t\toScanError = {\n\t\t\t\t\t\tmessage: \"Receieved code was not entered in time\"\n\t\t\t\t\t};\t\t\t\t\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// if a code was not filtered out earlier it is valid\t\n\t\t\t\tdefault:\n\t\t\t\t\toOptions.onScan.call(oDomElement, sScanCode, iSingleScanQty);\n\t\t\t\t\toEvent = new CustomEvent(\n\t\t\t\t\t\t'scan',\n\t\t\t\t\t\t{\t\n\t\t\t\t\t\t\tdetail: { \n\t\t\t\t\t\t\t\tscanCode: sScanCode,\n\t\t\t\t\t\t\t\tqty: iSingleScanQty\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\toDomElement.dispatchEvent(oEvent);\n\t\t\t\t\tonScan._reinitialize(oDomElement);\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t\t\n\t\t\t// If an error occurred (otherwise the method would return earlier) create an object for errordetection\n\t\t\toScanError.scanCode = sScanCode;\n\t\t\toScanError.scanDuration = iLastCharTime - iFirstCharTime;\n\t\t\toScanError.avgTimeByChar = oOptions.avgTimeByChar;\n\t\t\toScanError.minLength = oOptions.minLength;\n\t\t\t\n\t\t\toOptions.onScanError.call(oDomElement, oScanError);\n\t\t\t\n\t\t\toEvent = new CustomEvent(\n\t\t\t\t'scanError', \n\t\t\t\t{detail: oScanError}\n\t\t\t);\n\t\t\toDomElement.dispatchEvent(oEvent);\n\t\t\t\n\t\t\tonScan._reinitialize(oDomElement);\n\t\t\treturn false;\n\t    },\n\t\n\t    /**\n\t     * @private\n\t     * @param Object oDefaults\n\t     * @param Object oOptions\n\t     * @return Object\n\t     */\n\t\t_mergeOptions: function(oDefaults, oOptions){\n\t\t\tvar oExtended = {};\n\t\t\tvar prop;\n\t\t\tfor (prop in oDefaults){\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(oDefaults, prop)){\n\t\t\t\t\toExtended[prop] = oDefaults[prop];\n\t\t\t\t}\n\t\t\t}\t\t\t\n\t\t\tfor (prop in oOptions){\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(oOptions, prop)){\n\t\t\t\t\toExtended[prop] = oOptions[prop];\n\t\t\t\t}\n\t\t\t}\t\t\t\n\t\t\treturn oExtended;\n\t\t},\n\t\n\t\t/**\n\t\t * @private\n\t\t * @param KeyboardEvent e\n\t\t * @return int\n\t\t * @see https://www.w3schools.com/jsref/event_key_keycode.asp\n\t\t */\n\t\t_getNormalizedKeyNum: function(e){\n\t\t\treturn e.which || e.keyCode;\n\t\t},\n\t\n\t\n\t\t/**\n\t\t * @private\n\t\t * @param KeyboardEvent e\n\t\t * @return void\n\t\t */\n\t\t_handleKeyDown: function(e){\n\t\t\tvar iKeyCode = onScan._getNormalizedKeyNum(e);\n\t\t\tvar oOptions = this.scannerDetectionData.options;\n\t\t\tvar oVars = this.scannerDetectionData.vars;\n\t\t\tvar bScanFinished = false;\n\t\t\t\n\t\t\tif (oOptions.onKeyDetect.call(this, iKeyCode, e) === false) {\n\t\t\t\treturn;\n\t\t\t}\t\t\n\t\t\t\n\t\t\tif (onScan._isFocusOnIgnoredElement(this)){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\t\t\t\n\t        // If it's just the button of the scanner, ignore it and wait for the real input\n\t\t    if(oOptions.scanButtonKeyCode !== false && iKeyCode==oOptions.scanButtonKeyCode) {\n\t\t\t\t\n\t\t\t\t// if the button was first pressed, start a timeout for the callback, which gets interrupted if the scanbutton gets released\n\t\t\t\tif (!oVars.longPressed){\n\t\t\t\t\toVars.longPressTimer = setTimeout( oOptions.onScanButtonLongPress, oOptions.scanButtonLongPressTime, this);\n\t\t\t\t\toVars.longPressed = true;\n\t\t\t\t}\n\t\n\t\t\t\treturn;\n\t        }\n\t\t\t\n\t\t\tswitch(true){\n\t\t\t\t// If it's not the first character and we encounter a terminating character, trigger scan process\n\t\t\t\tcase (oVars.firstCharTime && oOptions.suffixKeyCodes.indexOf(iKeyCode)!==-1):\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\tbScanFinished=true;\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// If it's the first character and we encountered one of the starting characters, don't process the scan\t\n\t\t\t\tcase (!oVars.firstCharTime && oOptions.prefixKeyCodes.indexOf(iKeyCode)!==-1):\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\tbScanFinished=false;\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// Otherwise, just add the character to the scan string we're building\t\n\t\t\t\tdefault:\n\t\t\t\t\tvar character = oOptions.keyCodeMapper.call(this, e);\n\t\t\t\t\tif (character === null){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\toVars.accumulatedString += character;\n\t\t\t\t\t\n\t\t\t\t\tif (oOptions.preventDefault) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t\tif (oOptions.stopPropagation) {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tbScanFinished=false;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t        \n\t\t\tif(!oVars.firstCharTime){\n\t\t\t\toVars.firstCharTime=Date.now();\n\t\t\t}\n\t\t\t\n\t\t\toVars.lastCharTime=Date.now();\n\t\n\t\t\tif(oVars.testTimer){ \n\t\t\t\tclearTimeout(oVars.testTimer);\n\t\t\t}\n\t\t\t\n\t\t\tif(bScanFinished){\n\t\t\t\tonScan._validateScanCode(this, oVars.accumulatedString);\n\t\t\t\toVars.testTimer=false;\n\t\t\t} else {\n\t\t\t\toVars.testTimer=setTimeout(onScan._validateScanCode, oOptions.timeBeforeScanTest, this, oVars.accumulatedString);\n\t\t\t}\n\t\n\t\t\toOptions.onKeyProcess.call(this, character, e);\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param Event e\n\t\t * @return void\n\t\t */\n\t\t_handlePaste: function(e){\n\t\n\t\t\tvar oOptions = this.scannerDetectionData.options;\n\t\t\tvar oVars = this.scannerDetectionData.vars;\n\t\t\tvar sPasteString = (event.clipboardData || window.clipboardData).getData('text');\n\t\t\t\n\t\t\t// if the focus is on an ignored element, abort\n\t\t\tif (onScan._isFocusOnIgnoredElement(this)){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\te.preventDefault();\n\n\t\t\tif (oOptions.stopPropagation) {\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t}\n\t\t\t\t\t\t\n\t\t\toOptions.onPaste.call(this, sPasteString, event);\n\t\t\t\n\t\t\toVars.firstCharTime = 0;\n\t\t\toVars.lastCharTime = 0;\n\t\t\t\n\t\t\t// validate the string\n\t\t\tonScan._validateScanCode(this, sPasteString);\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param KeyboardEvent e\n\t\t * @return void\n\t\t */\n\t\t_handleKeyUp: function(e){\n\t\t\t// if the focus is on an ignored element, abort\n\t\t\tif (onScan._isFocusOnIgnoredElement(this)){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tvar iKeyCode = onScan._getNormalizedKeyNum(e);\n\t\t\t\n\t\t\t// if hardware key is not being pressed anymore stop the timeout and reset\n\t\t\tif (iKeyCode == this.scannerDetectionData.options.scanButtonKeyCode){\n\t\t\t\tclearTimeout(this.scannerDetectionData.vars.longPressTimer);\n\t\t\t\tthis.scannerDetectionData.vars.longPressed = false;\n\t\t\t}\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Returns TRUE the scanner is currently in the middle of a scan sequence.\n\t\t * \n\t\t * @param DomElement\n\t\t * @return boolean\n\t\t */\n\t\tisScanInProgressFor: function(oDomElement) {\n\t\t\treturn oDomElement.scannerDetectionData.vars.firstCharTime > 0;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Returns TRUE if onScan is attached to the given DOM element and FALSE otherwise.\n\t\t * \n\t\t * @param DomElement\n\t\t * @return boolean\n\t\t */\n\t\tisAttachedTo: function(oDomElement) {\n\t\t\treturn (oDomElement.scannerDetectionData !== undefined);\n\t\t}\n\t};\n\t\n\treturn onScan;\n})));", "erpnext.PointOfSale.StripeTerminal = function(){\n\tvar connectiontoken = \"\";\n\tvar terminal;\n\tvar loading_dialog, connecting_dialog, message_dilaog, confirm_dialog;\n\tvar payment_object,is_online;\n\tvar me = this;\n\n\tthis.assign_stripe_connection_token = function(payment, is_online) {\n\t\tpayment_object = payment;\n\t\tis_online = is_online;\n\t\tshow_loading_modal('Connecting to Stripe Terminal', 'Please Wait<br>Connecting to Stripe Terminal');\n\t\tfrappe.dom.freeze();\n\t\tfrappe.call({\n\t\t\tmethod: \"pasigono.pasigono.api.get_stripe_terminal_token\",\n\t\t\tfreeze: true,\n\t\t\theaders: {\n\t\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\tif (r.message) {\n\t\t\t\t\tconnectiontoken = r.message.secret;\n\t\t\t\t\tterminal = StripeTerminal.create({\n\t\t\t\t\t\tonFetchConnectionToken: fetchConnectionToken,\n\t\t\t\t\t\tonUnexpectedReaderDisconnect: unexpectedDisconnect\n\t\t\t\t\t});\n\t\t\t\t\tconnect_to_stripe_terminal(payment, is_online);\n\t\t\t\t} else {\n\t\t\t\t\tshow_error_dialog('Please configure the stripe settings.');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction fetchConnectionToken() {\n\t\treturn connectiontoken;\n\n\t}\n\n\tfunction show_loading_modal(title, message) {\n\t\tloading_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: title,\n\t\t\tfields: [{\n\t\t\t\t\tlabel: '',\n\t\t\t\t\tfieldname: 'show_dialog',\n\t\t\t\t\tfieldtype: 'HTML'\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\tvar html = '<div style=\"min-height:200px;position: relative;text-align: center;padding-top: 75px;line-height: 25px;font-size: 15px;\">';\n\t\thtml += '<div style=\"\">' + message + '</div>';\n\t\thtml += '</div>';\n\t\tloading_dialog.fields_dict.show_dialog.$wrapper.html(html);\n\t\tloading_dialog.show();\n\t}\n\n\tfunction unexpectedDisconnect() {\n\t\tfrappe.msgprint(\"Error: Stripe terminal unexpectedly disconnected. Please reload page\")\n\t}\n\n\tfunction connect_to_stripe_terminal(payment, is_online) {\n\t\tfrappe.dom.freeze();\n\t\tfrappe.call({\n\t\t\tmethod: \"pasigono.pasigono.api.get_stripe_terminal_settings\",\n\t\t\tfreeze: true,\n\t\t\theaders: {\n\t\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\tvar isSimulated = false;\n\t\t\t\tvar testCardNumber = \"\";\n\t\t\t\tvar testCardtype = \"\";\n\t\t\t\tif (r.message != undefined) {\n\t\t\t\t\tif (r.message.enable_test_mode == 1) {\n\t\t\t\t\t\tisSimulated = true;\n\t\t\t\t\t\ttestCardNumber = r.message.card_number;\n\t\t\t\t\t\ttestCardtype = r.message.card_type;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar config = {\n\t\t\t\t\tsimulated: isSimulated\n\t\t\t\t};\n\t\t\t\tterminal.discoverReaders(config).then(function (discoverResult) {\n\t\t\t\t\tif (discoverResult.error) {\n\t\t\t\t\t\tconnecting_dialog.hide();\n\t\t\t\t\t\tshow_error_dialog('No Stripe readers found.');\n\t\t\t\t\t} else if (discoverResult.discoveredReaders.length === 0) {\n\t\t\t\t\t\tconnecting_dialog.hide();\n\t\t\t\t\t\tshow_error_dialog('No Stripe readers found.');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar devices = '';\n\t\t\t\t\t\tfor(let x in discoverResult.discoveredReaders){\n\t\t\t\t\t\t\tdevices = devices + '\\n' + discoverResult.discoveredReaders[x].label;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\t\t\t\t'fields': [\n\t\t\t\t\t\t\t\t{'fieldname': 'stripe_readers', 'fieldtype': 'Select', 'reqd': 1, 'label': 'Stripe Reader', 'options': devices }\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tprimary_action: function(){\n\t\t\t\t\t\t\t\tvar selected = d.get_values().stripe_readers;\n\t\t\t\t\t\t\t\tvar selectedReader;\n\t\t\t\t\t\t\t\tfor(let x in discoverResult.discoveredReaders){\n\t\t\t\t\t\t\t\t\tif(discoverResult.discoveredReaders[x].label == selected){\n\t\t\t\t\t\t\t\t\t\tselectedReader = discoverResult.discoveredReaders[x];\n\t\t\t\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tterminal.connectReader(selectedReader).then(function (connectResult) {\n\t\t\t\t\t\t\t\t\tif (connectResult.error) {\n\t\t\t\t\t\t\t\t\t\tconnecting_dialog.hide();\n\t\t\t\t\t\t\t\t\t\tshow_error_dialog('Failed to connect.' + connectResult.error.message);\n\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tif (r.message.enable_test_mode == 1 && testCardNumber != \"\" && testCardtype != \"\") {\n\t\t\t\t\t\t\t\t\t\t\tterminal.setSimulatorConfiguration({\n\t\t\t\t\t\t\t\t\t\t\t\t'testCardNumber': testCardNumber,\n\t\t\t\t\t\t\t\t\t\t\t\t'testPaymentMethod': testCardtype\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tloading_dialog.hide();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsecondary_action: function(){\n\t\t\t\t\t\t\t\tfrappe.msgprint('Please disable Stripe Terminal in the POS Profile.');\n\t\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsecondary_action_label: 'Cancel',\n\t\t\t\t\t\t\ttitle: 'Select a Stripe Terminal device'\n\t\t\t\t\t\t});\n\t\t\t\t\t\td.show();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\t\n\t\n\tthis.display_details = async function(payment){\n\t\tvar frm = payment.frm.doc;\n\t\tvar items = [];\n\t\tvar taxes = Math.round(payment.frm.doc.total_taxes_and_charges*100);\n\t\tvar total = Math.round(payment.frm.doc.grand_total*100);\n\t\tvar currency = payment.frm.doc.currency;\n\t\tfrm.items.forEach(function(row){\n\t\t\tvar amount = row.amount*100;\n\t\t\tvar item = {\n\t\t\t\t\"description\": row.item_name,\n\t\t\t\t\"quantity\": Math.round(row.qty),\n\t\t\t\t\"amount\": Math.round(amount)\n\t\t\t};\n\t\t\titems.push(item);\n\t\t});\n\t\tawait terminal.clearReaderDisplay();\n\t\tterminal.setReaderDisplay({\n\t\t\ttype: 'cart',\n\t\t\tcart: {\n\t\t\t\tline_items: items,\n\t\t\t\ttax: taxes,\n\t\t\t\ttotal: total,\n\t\t\t\tcurrency: currency\n\t\t\t}\n\t\t});\n\t}\n\n\tthis.collecting_payments = function(payment, is_online) {\n\t\tif(payment.frm.doc.is_return == 1){\n\t\t\tconfirm_dialog = new frappe.ui.Dialog({\n\t\t\t\ttitle: 'Confirm, refund through Stripe',\n\t\t\t\tfields: [{\n\t\t\t\t\t\tlabel: '',\n\t\t\t\t\t\tfieldname: 'show_dialog',\n\t\t\t\t\t\tfieldtype: 'HTML'\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tprimary_action_label: \"Confirm\",\n\t\t\t\tprimary_action(values) {\n\t\t\t\t\tconfirm_dialog.hide();\n\t\t\t\t\trefund_payment(payment, is_online);\n\t\t\t\t},\n\t\t\t\tsecondary_action_label: \"Cancel\",\n\t\t\t\tsecondary_action(values) {\n\t\t\t\t\tconfirm_dialog.hide();\n\t\t\t\t}\n\t\t\t});\n\t\t\tvar html = '<div style=\"text-align: center;\">Please confirm. Refund of ' + payment.frm.doc.currency.toUpperCase() + ' ';\n\t\t\thtml += payment.frm.doc.grand_total * -1 + ' through stripe.</div>';\n\t\t\tconfirm_dialog.fields_dict.show_dialog.$wrapper.html(html);\n\t\t\tconfirm_dialog.show();\n\t\t}\n\t\telse{\n\t\t\tcreate_payment(payment, is_online);\n\t\t}\n\t}\n\t\n\t\n\tfunction refund_payment(payment, is_online){\n\t\tshow_loading_modal('Refunding Payments', 'Please Wait<br>Refunding Payments');\n\t\tfrappe.dom.freeze();\n\t\tvar payments = payment.frm.doc.payments;\n\t\tpayments.forEach(function(row){\n\t\t\tif(row.mode_of_payment == window.stripe_mode_of_payment){\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"pasigono.pasigono.api.refund_payment\",\n\t\t\t\t\tfreeze: true,\n\t\t\t\t\targs: {\n\t\t\t\t\t\t\"payment_intent_id\": row.card_payment_intent,\n\t\t\t\t\t\t\"amount\": row.base_amount.toFixed(2)*-100\n\t\t\t\t\t},\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(result){\n\t\t\t\t\t\tloading_dialog.hide();\n\t\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t\t\tif (is_online) {\n\t\t\t\t\t\t\tpayment.frm.savesubmit()\n\t\t\t\t\t\t\t\t.then((sales_invoice) => {\n\t\t\t\t\t\t\t\t\tif (sales_invoice && sales_invoice.doc) {\n\t\t\t\t\t\t\t\t\t\tpayment.frm.doc.docstatus = sales_invoice.doc.docstatus;\n\t\t\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\t\t\tindicator: 'green',\n\t\t\t\t\t\t\t\t\t\t\tmessage: __(`POS invoice ${sales_invoice.doc.name} created succesfully`)\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tpayment.toggle_components(false);\n\t\t\t\t\t\t\t\t\t\tpayment.order_summary.toggle_component(true);\n\t\t\t\t\t\t\t\t\t\tpayment.order_summary.load_summary_of(payment.frm.doc, true);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpayment.payment.events.submit_invoice();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\t\n\t\n\tfunction create_payment(payment, is_online){\n\t\tshow_loading_modal('Collecting Payments', 'Please Wait<br>Collecting Payments');\n\t\tfrappe.dom.freeze();\n\t\tfrappe.call({\n\t\t\tmethod: \"pasigono.pasigono.api.payment_intent_creation\",\n\t\t\tfreeze: true,\n\t\t\targs: {\n\t\t\t\t\"sales_invoice\": payment.frm.doc\n\t\t\t},\n\t\t\theaders: {\n\t\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tterminal.collectPaymentMethod(r.message.client_secret).then(function (result) {\n\t\t\t\t\tif (result.error) {\n\t\t\t\t\t\tloading_dialog.hide();\n\t\t\t\t\t\tshow_payment_error_dialog(result.error.message);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tterminal.processPayment(result.paymentIntent).then(function (result) {\n\t\t\t\t\t\t\tif (result.error) {\n\t\t\t\t\t\t\t\tloading_dialog.hide();\n\t\t\t\t\t\t\t\tshow_payment_error_dialog(result.error.message);\n\t\t\t\t\t\t\t} else if (result.paymentIntent) {\n\t\t\t\t\t\t\t\tloading_dialog.hide();\n\t\t\t\t\t\t\t\tconfirm_dialog = new frappe.ui.Dialog({\n\t\t\t\t\t\t\t\t\ttitle: 'Confirm Stripe Payment',\n\t\t\t\t\t\t\t\t\tfields: [{\n\t\t\t\t\t\t\t\t\t\t\tlabel: '',\n\t\t\t\t\t\t\t\t\t\t\tfieldname: 'show_dialog',\n\t\t\t\t\t\t\t\t\t\t\tfieldtype: 'HTML'\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tprimary_action_label: \"Confirm\",\n\t\t\t\t\t\t\t\t\tprimary_action(values) {\n\t\t\t\t\t\t\t\t\t\tcapture_payment(payment, is_online, result.paymentIntent);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tsecondary_action_label: \"Cancel\",\n\t\t\t\t\t\t\t\t\tsecondary_action(values) {\n\t\t\t\t\t\t\t\t\t\tcancel_payment(payment, is_online, result.paymentIntent);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tvar html = '<div style=\"text-align: center;\">Please confirm. Payment of ' + result.paymentIntent.currency.toUpperCase() + ' ';\n\t\t\t\t\t\t\t\thtml += result.paymentIntent.amount/100 + ' through stripe.</div>';\n\t\t\t\t\t\t\t\tconfirm_dialog.fields_dict.show_dialog.$wrapper.html(html);\n\t\t\t\t\t\t\t\tconfirm_dialog.show();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t}\n\t\t})\n\t}\n\t\n\t\n\tfunction cancel_payment(payment, is_online, payment_intent){\n\t\tconfirm_dialog.hide();\n\t\t\n\t\tvar canceling_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Canceling Stripe Terminal',\n\t\t\tfields: [{\n\t\t\t\t\tlabel: '',\n\t\t\t\t\tfieldname: 'show_dialog',\n\t\t\t\t\tfieldtype: 'HTML'\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\tvar html = '<div style=\"min-height:200px;position: relative;text-align: center;padding-top: 75px;line-height: 25px;font-size: 15px;\">';\n\t\thtml += '<div style=\"\">Please Wait<br>Canceling Stripe Terminal</div>';\n\t\thtml += '</div>';\n\t\tcanceling_dialog.fields_dict.show_dialog.$wrapper.html(html);\n\t\tcanceling_dialog.show();\n\t\tfrappe.call({\n\t\t\tmethod: \"pasigono.pasigono.api.cancel_payment_intent\",\n\t\t\tfreeze: true,\n\t\t\targs: {\n\t\t\t\t\"payment_intent_id\": payment_intent.id,\n\t\t\t\t\"sales_invoice_id\": payment.frm.doc.name\n\t\t\t},\n\t\t\theaders: {\n\t\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\n\t\t\t},\n\t\t\tcallback: function (intent_result) {\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\tcanceling_dialog.hide();\n\t\t\t\tfrappe.msgprint(\"Stripe payment cancelled.\");\n\t\t\t}\n\t\t})\n\t}\n\t\n\t\n\tfunction capture_payment(payment, is_online, payment_intent){\n\t\tconfirm_dialog.hide();\n\t\tshow_loading_modal('COllecting Payments', 'Please Wait<br>Collecting Payments');\n\t\tfrappe.call({\n\t\t\tmethod: \"pasigono.pasigono.api.capture_payment_intent\",\n\t\t\tfreeze: true,\n\t\t\targs: {\n\t\t\t\t\"payment_intent_id\": payment_intent.id,\n\t\t\t\t\"sales_invoice_id\": payment.frm.doc.name\n\t\t\t},\n\t\t\theaders: {\n\t\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\n\t\t\t},\n\t\t\tcallback: function (intent_result) {\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\tloading_dialog.hide();\n\t\t\t\tvar payments = payment.frm.doc.payments;\n\t\t\t\tpayments.forEach(function(row){\n\t\t\t\t\tif(row.mode_of_payment == window.stripe_mode_of_payment){\n\t\t\t\t\t\tvar card_info = intent_result.message.charges.data[0].payment_method_details.card_present;\n\t\t\t\t\t\trow.card_brand = card_info.brand;\n\t\t\t\t\t\trow.card_last4 = card_info.last4;\n\t\t\t\t\t\trow.card_account_type = card_info.receipt.account_type;\n\t\t\t\t\t\trow.card_application_preferred_name = card_info.receipt.application_preferred_name;\n\t\t\t\t\t\trow.card_dedicated_file_name = card_info.receipt.dedicated_file_name;\n\t\t\t\t\t\trow.card_authorization_response_code = card_info.receipt.authorization_response_code;\n\t\t\t\t\t\trow.card_application_cryptogram = card_info.receipt.application_cryptogram;\n\t\t\t\t\t\trow.card_terminal_verification_results = card_info.receipt.terminal_verification_results;\n\t\t\t\t\t\trow.card_transaction_status_information = card_info.receipt.transaction_status_information;\n\t\t\t\t\t\trow.card_authorization_code = card_info.receipt.authorization_code;\n\t\t\t\t\t\trow.card_charge_id = intent_result.message.charges.data[0].id;\n\t\t\t\t\t\trow.card_payment_intent = intent_result.message.charges.data[0].payment_intent;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (is_online) {\n\t\t\t\t\tpayment.frm.savesubmit()\n\t\t\t\t\t\t.then((sales_invoice) => {\n\t\t\t\t\t\t\t//For raw printing\n\t\t\t\t\t\t\tif(window.open_cash_drawer_automatically == 1){\n\t\t\t\t\t\t\t\tpayment.payment.events.open_cash_drawer();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif(window.automatically_print == 1){\n\t\t\t\t\t\t\t\tpayment.payment.events.raw_print(this.frm);\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (sales_invoice && sales_invoice.doc) {\n\t\t\t\t\t\t\t\tpayment.frm.doc.docstatus = sales_invoice.doc.docstatus;\n\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\tindicator: 'green',\n\t\t\t\t\t\t\t\t\tmessage: __(`POS invoice ${sales_invoice.doc.name} created succesfully`)\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\t\tmethod: \"pasigono.pasigono.api.update_payment_intent\",\n\t\t\t\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\t\t\"payment_intent_id\": payment_intent.id,\n\t\t\t\t\t\t\t\t\t\t\"sales_invoice_id\": sales_invoice.doc.name\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tcallback: function (intent_result) {\n\t\t\t\t\t\t\t\t\t\tpayment.toggle_components(false);\n\t\t\t\t\t\t\t\t\t\tpayment.order_summary.toggle_component(true);\n\t\t\t\t\t\t\t\t\t\tpayment.order_summary.load_summary_of(payment.frm.doc, true);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t} else {\n\t\t\t\t\tpayment.payment.events.submit_invoice();\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\t\n\tfunction retry_stripe_terminal(me, payment_object, is_online)\n\t{\n\t\tmessage_dilaog.hide();\n\t\tme.collecting_payments(payment_object, is_online);\n\t\t//assign_stripe_connection_token\n\t\t//me.assign_stripe_connection_token(payment_object, is_online);\n\t}\n\tfunction change_payment_method()\n\t{\n\t\tmessage_dilaog.hide();\n\t\t$(\".num-col.brand-primary\").click();\n\t\t\n\t}\n\t\n\tfunction show_error_dialog(message) {\n\t\tmessage_dilaog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Message',\n\t\t\tfields: [{\n\t\t\t\t\tlabel: '',\n\t\t\t\t\tfieldname: 'show_dialog',\n\t\t\t\t\tfieldtype: 'HTML'\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action_label: \"Retry\",\n\t\t\tprimary_action(values) {\n\t\t\t\tretry_stripe_terminal(me);\n\t\t\t\tmessage_dilaog.hide();\n\t\t\t}\n\t\t});\n\t\tvar html = \"<p>\" + message + \"</p>\";\n\t\tmessage_dilaog.fields_dict.show_dialog.$wrapper.html(html);\n\t\tmessage_dilaog.show();\n\t}\n\t\n\tfunction show_payment_error_dialog(message) {\n\t\tmessage_dilaog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Message',\n\t\t\tfields: [{\n\t\t\t\t\tlabel: '',\n\t\t\t\t\tfieldname: 'show_dialog',\n\t\t\t\t\tfieldtype: 'HTML'\n\n\t\t\t\t},\n\n\t\t\t],\n\t\t\tprimary_action_label: \"Retry\",\n\t\t\tsecondary_action_label: \"Change Payment Mode\",\n\t\t\tprimary_action(values) {\n\t\t\t\tretry_stripe_terminal(me, payment_object, is_online);\n\t\t\t\t//me.collecting_payments(payment_object, is_online);\n\t\t\t},\n\t\t\tsecondary_action(values) {\n\t\t\t\tchange_payment_method();\n\t\t\t}\n\t\t});\n\t\tvar html = \"<p>\" + message + \"</p>\";\n\t\tmessage_dilaog.fields_dict.show_dialog.$wrapper.html(html);\n\t\tmessage_dilaog.show();\n\t}\n}\n", "import onScan from 'onscan.js';\n\nerpnext.PointOfSale.ItemSelector = class {\n\t// eslint-disable-next-line no-unused-vars\n\tconstructor({ frm, wrapper, events, pos_profile, settings }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.pos_profile = pos_profile;\n\t\tthis.hide_images = settings.hide_images;\n\t\tthis.auto_add_item = settings.auto_add_item_to_cart;\n\n\t\tthis.inti_component();\n\t}\n\n\tinti_component() {\n\t\tthis.prepare_dom();\n\t\tthis.make_search_bar();\n\t\tthis.load_items_data();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"items-selector\">\n\t\t\t\t<div class=\"filter-section\">\n\t\t\t\t\t<div class=\"label\">${__('All Items')}</div>\n\t\t\t\t\t<div class=\"search-field\"></div>\n\t\t\t\t\t<div class=\"item-group-field\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"items-container\"></div>\n\t\t\t</section>`\n\t\t);\n\n\t\tthis.$component = this.wrapper.find('.items-selector');\n\t\tthis.$items_container = this.$component.find('.items-container');\n\t}\n\n\tasync load_items_data() {\n\t\tif (!this.item_group) {\n\t\t\tconst res = await frappe.db.get_value(\"Item Group\", {lft: 1, is_group: 1}, \"name\");\n\t\t\tthis.parent_item_group = res.message.name;\n\t\t}\n\t\tif (!this.price_list) {\n\t\t\tconst res = await frappe.db.get_value(\"POS Profile\", this.pos_profile, \"selling_price_list\");\n\t\t\tthis.price_list = res.message.selling_price_list;\n\t\t}\n\n\t\tthis.get_items({}).then(({message}) => {\n\t\t\tthis.render_item_list(message.items);\n\t\t});\n\t}\n\n\tget_items({start = 0, page_length = 40, search_term=''}) {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst price_list = (doc && doc.selling_price_list) || this.price_list;\n\t\tlet { item_group, pos_profile } = this;\n\t\tconsole.log({'this': this});\n\t\tconsole.log({\"item_group\": item_group, \"pos_profile\": pos_profile});\n\t\t!item_group && (item_group = this.parent_item_group);\n\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.selling.page.point_of_sale.point_of_sale.get_items\",\n\t\t\tfreeze: true,\n\t\t\targs: { start, page_length, price_list, item_group, search_term, pos_profile },\n\t\t});\n\t}\n\n\n\trender_item_list(items) {\n\t\tthis.$items_container.html('');\n\n\t\titems.forEach(item => {\n\t\t\tconst item_html = this.get_item_html(item);\n\t\t\tthis.$items_container.append(item_html);\n\t\t});\n\t}\n\n\tget_item_html(item) {\n\t\tconst me = this;\n\t\t// eslint-disable-next-line no-unused-vars\n\t\tconst { item_image, serial_no, batch_no, barcode, actual_qty, stock_uom, price_list_rate } = item;\n\t\tconst precision = flt(price_list_rate, 2) % 1 != 0 ? 2 : 0;\n\t\tlet indicator_color;\n\t\tlet qty_to_display = actual_qty;\n\n\t\tif (item.is_stock_item) {\n\t\t\tindicator_color = (actual_qty > 10 ? \"green\" : actual_qty <= 0 ? \"red\" : \"orange\");\n\n\t\t\tif (Math.round(qty_to_display) > 999) {\n\t\t\t\tqty_to_display = Math.round(qty_to_display)/1000;\n\t\t\t\tqty_to_display = qty_to_display.toFixed(1) + 'K';\n\t\t\t}\n\t\t} else {\n\t\t\tindicator_color = '';\n\t\t\tqty_to_display = '';\n\t\t}\n\n\t\tfunction get_item_image_html() {\n\t\t\tif (!me.hide_images && item_image) {\n\t\t\t\treturn `<div class=\"item-qty-pill\">\n\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color}\">${qty_to_display}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"flex items-center justify-center h-32 border-b-grey text-6xl text-grey-100\">\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tonerror=\"cur_pos.item_selector.handle_broken_image(this)\"\n\t\t\t\t\t\t\t\tclass=\"h-full\" src=\"${item_image}\"\n\t\t\t\t\t\t\t\talt=\"${frappe.get_abbr(item.item_name)}\"\n\t\t\t\t\t\t\t\tstyle=\"object-fit: cover;\">\n\t\t\t\t\t\t</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"item-qty-pill\">\n\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color}\">${qty_to_display}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"item-display abbr\">${frappe.get_abbr(item.item_name)}</div>`;\n\t\t\t}\n\t\t}\n\n\t\treturn (\n\t\t\t`<div class=\"item-wrapper\"\n\t\t\t\tdata-item-code=\"${escape(item.item_code)}\" data-serial-no=\"${escape(serial_no)}\"\n\t\t\t\tdata-batch-no=\"${escape(batch_no)}\" data-uom=\"${escape(stock_uom)}\"\n\t\t\t\tdata-rate=\"${escape(price_list_rate || 0)}\"\n\t\t\t\ttitle=\"${item.item_name}\">\n\n\t\t\t\t${get_item_image_html()}\n\n\t\t\t\t<div class=\"item-detail\">\n\t\t\t\t\t<div class=\"item-name\">\n\t\t\t\t\t\t${frappe.ellipsis(item.item_name, 18)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"item-rate\">${format_currency(price_list_rate, item.currency, precision) || 0}</div>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t);\n\t}\n\n\thandle_broken_image($img) {\n\t\tconst item_abbr = $($img).attr('alt');\n\t\t$($img).parent().replaceWith(`<div class=\"item-display abbr\">${item_abbr}</div>`);\n\t}\n\n\tmake_search_bar() {\n\t\tconst me = this;\n\t\tconst doc = me.events.get_frm().doc;\n\t\tthis.$component.find('.search-field').html('');\n\t\tthis.$component.find('.item-group-field').html('');\n\n\t\tthis.search_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Search'),\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tplaceholder: __('Search by item code, serial number or barcode')\n\t\t\t},\n\t\t\tparent: this.$component.find('.search-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.item_group_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Item Group'),\n\t\t\t\tfieldtype: 'Link',\n\t\t\t\toptions: 'Item Group',\n\t\t\t\tplaceholder: __('Select item group'),\n\t\t\t\tonchange: function() {\n\t\t\t\t\tme.item_group = this.value;\n\t\t\t\t\t!me.item_group && (me.item_group = me.parent_item_group);\n\t\t\t\t\tme.filter_items();\n\t\t\t\t},\n\t\t\t\tget_query: function () {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tquery: 'erpnext.selling.page.point_of_sale.point_of_sale.item_group_query',\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\tpos_profile: doc ? doc.pos_profile : ''\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.$component.find('.item-group-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.search_field.toggle_label(false);\n\t\tthis.item_group_field.toggle_label(false);\n\n\t\tthis.attach_clear_btn();\n\t}\n\n\tattach_clear_btn() {\n\t\tthis.search_field.$wrapper.find('.control-input').append(\n\t\t\t`<span class=\"link-btn\" style=\"top: 2px;\">\n\t\t\t\t<a class=\"btn-open no-decoration\" title=\"${__(\"Clear\")}\">\n\t\t\t\t\t${frappe.utils.icon('close', 'sm')}\n\t\t\t\t</a>\n\t\t\t</span>`\n\t\t);\n\n\t\tthis.$clear_search_btn = this.search_field.$wrapper.find('.link-btn');\n\n\t\tthis.$clear_search_btn.on('click', 'a', () => {\n\t\t\tthis.set_search_value('');\n\t\t\tthis.search_field.set_focus();\n\t\t});\n\t}\n\n\tset_search_value(value) {\n\t\t$(this.search_field.$input[0]).val(value).trigger(\"input\");\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\t\twindow.onScan = onScan;\n\n\t\tonScan.decodeKeyEvent = function (oEvent) {\n\t\t\tvar iCode = this._getNormalizedKeyNum(oEvent);\n\t\t\tswitch (true) {\n\t\t\t\tcase iCode >= 48 && iCode <= 90: // numbers and letters\n\t\t\t\tcase iCode >= 106 && iCode <= 111: // operations on numeric keypad (+, -, etc.)\n\t\t\t\tcase (iCode >= 160 && iCode <= 164) || iCode == 170: // ^ ! # $ *\n\t\t\t\tcase iCode >= 186 && iCode <= 194: // (; = , - . / `)\n\t\t\t\tcase iCode >= 219 && iCode <= 222: // ([ \\ ] ')\n\t\t\t\tcase iCode == 32: // spacebar\n\t\t\t\t\tif (oEvent.key !== undefined && oEvent.key !== '') {\n\t\t\t\t\t\treturn oEvent.key;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar sDecoded = String.fromCharCode(iCode);\n\t\t\t\t\tswitch (oEvent.shiftKey) {\n\t\t\t\t\t\tcase false: sDecoded = sDecoded.toLowerCase(); break;\n\t\t\t\t\t\tcase true: sDecoded = sDecoded.toUpperCase(); break;\n\t\t\t\t\t}\n\t\t\t\t\treturn sDecoded;\n\t\t\t\tcase iCode >= 96 && iCode <= 105: // numbers on numeric keypad\n\t\t\t\t\treturn 0 + (iCode - 96);\n\t\t\t}\n\t\t\treturn '';\n\t\t};\n\n\t\tonScan.attachTo(document, {\n\t\t\tonScan: (sScancode) => {\n\t\t\t\tif (this.search_field && this.$component.is(':visible')) {\n\t\t\t\t\tthis.search_field.set_focus();\n\t\t\t\t\tthis.set_search_value(sScancode);\n\t\t\t\t\tthis.barcode_scanned = true;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.$component.on('click', '.item-wrapper', function() {\n\t\t\tconst $item = $(this);\n\t\t\tconst item_code = unescape($item.attr('data-item-code'));\n\t\t\tlet batch_no = unescape($item.attr('data-batch-no'));\n\t\t\tlet serial_no = unescape($item.attr('data-serial-no'));\n\t\t\tlet uom = unescape($item.attr('data-uom'));\n\t\t\tlet rate = unescape($item.attr('data-rate'));\n\n\t\t\t// escape(undefined) returns \"undefined\" then unescape returns \"undefined\"\n\t\t\tbatch_no = batch_no === \"undefined\" ? undefined : batch_no;\n\t\t\tserial_no = serial_no === \"undefined\" ? undefined : serial_no;\n\t\t\tuom = uom === \"undefined\" ? undefined : uom;\n\t\t\trate = rate === \"undefined\" ? undefined : rate;\n\n\t\t\tme.events.item_selected({\n\t\t\t\tfield: 'qty',\n\t\t\t\tvalue: \"+1\",\n\t\t\t\titem: { item_code, batch_no, serial_no, uom, rate }\n\t\t\t});\n\t\t\tme.search_field.set_focus();\n\t\t});\n\n\t\tthis.search_field.$input.on('input', (e) => {\n\t\t\tclearTimeout(this.last_search);\n\t\t\tthis.last_search = setTimeout(() => {\n\t\t\t\tconst search_term = e.target.value;\n\t\t\t\tthis.filter_items({ search_term });\n\t\t\t}, 300);\n\n\t\t\tthis.$clear_search_btn.toggle(\n\t\t\t\tBoolean(this.search_field.$input.val())\n\t\t\t);\n\t\t});\n\n\t\tthis.search_field.$input.on('focus', () => {\n\t\t\tthis.$clear_search_btn.toggle(\n\t\t\t\tBoolean(this.search_field.$input.val())\n\t\t\t);\n\t\t});\n\t}\n\n\tattach_shortcuts() {\n\t\tconst ctrl_label = frappe.utils.is_mac() ? '\u2318' : 'Ctrl';\n\t\tthis.search_field.parent.attr(\"title\", `${ctrl_label}+I`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+i\",\n\t\t\taction: () => this.search_field.set_focus(),\n\t\t\tcondition: () => this.$component.is(':visible'),\n\t\t\tdescription: __(\"Focus on search input\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t\tthis.item_group_field.parent.attr(\"title\", `${ctrl_label}+G`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+g\",\n\t\t\taction: () => this.item_group_field.set_focus(),\n\t\t\tcondition: () => this.$component.is(':visible'),\n\t\t\tdescription: __(\"Focus on Item Group filter\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\n\t\t// for selecting the last filtered item on search\n\t\tfrappe.ui.keys.on(\"enter\", () => {\n\t\t\tconst selector_is_visible = this.$component.is(':visible');\n\t\t\tif (!selector_is_visible || this.search_field.get_value() === \"\") return;\n\n\t\t\tif (this.items.length == 1) {\n\t\t\t\tthis.$items_container.find(\".item-wrapper\").click();\n\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\tthis.set_search_value('');\n\t\t\t} else if (this.items.length == 0 && this.barcode_scanned) {\n\t\t\t\t// only show alert of barcode is scanned and enter is pressed\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __(\"No items found. Scan barcode again.\"),\n\t\t\t\t\tindicator: 'orange'\n\t\t\t\t});\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\tthis.barcode_scanned = false;\n\t\t\t\tthis.set_search_value('');\n\t\t\t}\n\t\t});\n\t}\n\n\tfilter_items({ search_term='' }={}) {\n\t\tif (search_term) {\n\t\t\tsearch_term = search_term.toLowerCase();\n\n\t\t\t// memoize\n\t\t\tthis.search_index = this.search_index || {};\n\t\t\tif (this.search_index[search_term]) {\n\t\t\t\tconst items = this.search_index[search_term];\n\t\t\t\tthis.items = items;\n\t\t\t\tthis.render_item_list(items);\n\t\t\t\tthis.auto_add_item && this.items.length == 1 && this.add_filtered_item_to_cart();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.get_items({ search_term })\n\t\t\t.then(({ message }) => {\n\t\t\t\t// eslint-disable-next-line no-unused-vars\n\t\t\t\tconst { items, serial_no, batch_no, barcode } = message;\n\t\t\t\tif (search_term && !barcode) {\n\t\t\t\t\tthis.search_index[search_term] = items;\n\t\t\t\t}\n\t\t\t\tthis.items = items;\n\t\t\t\tthis.render_item_list(items);\n\t\t\t\tthis.auto_add_item && this.items.length == 1 && this.add_filtered_item_to_cart();\n\t\t\t});\n\t}\n\n\tadd_filtered_item_to_cart() {\n\t\tthis.$items_container.find(\".item-wrapper\").click();\n\t\tthis.set_search_value('');\n\t}\n\n\tresize_selector(minimize) {\n\t\tminimize ?\n\t\t\tthis.$component.find('.filter-section').css('grid-template-columns', 'repeat(1, minmax(0, 1fr))') :\n\t\t\tthis.$component.find('.filter-section').css('grid-template-columns', 'repeat(12, minmax(0, 1fr))');\n\n\t\tminimize ?\n\t\t\tthis.$component.find('.search-field').css('margin', 'var(--margin-sm) 0px') :\n\t\t\tthis.$component.find('.search-field').css('margin', '0px var(--margin-sm)');\n\n\t\tminimize ?\n\t\t\tthis.$component.css('grid-column', 'span 2 / span 2') :\n\t\t\tthis.$component.css('grid-column', 'span 6 / span 6');\n\n\t\tminimize ?\n\t\t\tthis.$items_container.css('grid-template-columns', 'repeat(1, minmax(0, 1fr))') :\n\t\t\tthis.$items_container.css('grid-template-columns', 'repeat(4, minmax(0, 1fr))');\n\t}\n\n\ttoggle_component(show) {\n\t\tthis.set_search_value('');\n\t\tthis.$component.css('display', show ? 'flex': 'none');\n\t}\n};\n", "erpnext.PointOfSale.ItemCart = class {\n\tconstructor({ wrapper, events, settings }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.customer_info = undefined;\n\t\tthis.hide_images = settings.hide_images;\n\t\tthis.allowed_customer_groups = settings.customer_groups;\n\t\tthis.allow_rate_change = settings.allow_rate_change;\n\t\tthis.allow_discount_change = settings.allow_discount_change;\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.init_child_components();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"customer-cart-container\"></section>`\n\t\t)\n\n\t\tthis.$component = this.wrapper.find('.customer-cart-container');\n\t}\n\n\tinit_child_components() {\n\t\tthis.init_customer_selector();\n\t\tthis.init_cart_components();\n\t}\n\n\tinit_customer_selector() {\n\t\tthis.$component.append(\n\t\t\t`<div class=\"customer-section\"></div>`\n\t\t)\n\t\tthis.$customer_section = this.$component.find('.customer-section');\n\t\tthis.make_customer_selector();\n\t}\n\n\treset_customer_selector() {\n\t\tconst frm = this.events.get_frm();\n\t\tfrm.set_value('customer', '');\n\t\tthis.make_customer_selector();\n\t\tthis.customer_field.set_focus();\n\t}\n\n\tinit_cart_components() {\n\t\tthis.$component.append(\n\t\t\t`<div class=\"cart-container\">\n\t\t\t\t<div class=\"abs-cart-container\">\n\t\t\t\t\t<div class=\"cart-label\">${__('Item Cart')}</div>\n\t\t\t\t\t<div class=\"cart-header\">\n\t\t\t\t\t\t<div class=\"name-header\">${__('Item')}</div>\n\t\t\t\t\t\t<div class=\"qty-header\">${__('Quantity')}</div>\n\t\t\t\t\t\t<div class=\"rate-amount-header\">${__('Amount')}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"cart-items-section\"></div>\n\t\t\t\t\t<div class=\"cart-totals-section\"></div>\n\t\t\t\t\t<div class=\"numpad-section\"></div>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t);\n\t\tthis.$cart_container = this.$component.find('.cart-container');\n\n\t\tthis.make_cart_totals_section();\n\t\tthis.make_cart_items_section();\n\t\tthis.make_cart_numpad();\n\t}\n\n\tmake_cart_items_section() {\n\t\tthis.$cart_header = this.$component.find('.cart-header');\n\t\tthis.$cart_items_wrapper = this.$component.find('.cart-items-section');\n\n\t\tthis.make_no_items_placeholder();\n\t}\n\n\tmake_no_items_placeholder() {\n\t\tthis.$cart_header.css('display', 'none');\n\t\tthis.$cart_items_wrapper.html(\n\t\t\t`<div class=\"no-item-wrapper\">${__('No items in cart')}</div>`\n\t\t);\n\t}\n\n\tget_discount_icon() {\n\t\treturn (\n\t\t\t`<svg class=\"discount-icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t<path d=\"M19 15.6213C19 15.2235 19.158 14.842 19.4393 14.5607L20.9393 13.0607C21.5251 12.4749 21.5251 11.5251 20.9393 10.9393L19.4393 9.43934C19.158 9.15804 19 8.7765 19 8.37868V6.5C19 5.67157 18.3284 5 17.5 5H15.6213C15.2235 5 14.842 4.84196 14.5607 4.56066L13.0607 3.06066C12.4749 2.47487 11.5251 2.47487 10.9393 3.06066L9.43934 4.56066C9.15804 4.84196 8.7765 5 8.37868 5H6.5C5.67157 5 5 5.67157 5 6.5V8.37868C5 8.7765 4.84196 9.15804 4.56066 9.43934L3.06066 10.9393C2.47487 11.5251 2.47487 12.4749 3.06066 13.0607L4.56066 14.5607C4.84196 14.842 5 15.2235 5 15.6213V17.5C5 18.3284 5.67157 19 6.5 19H8.37868C8.7765 19 9.15804 19.158 9.43934 19.4393L10.9393 20.9393C11.5251 21.5251 12.4749 21.5251 13.0607 20.9393L14.5607 19.4393C14.842 19.158 15.2235 19 15.6213 19H17.5C18.3284 19 19 18.3284 19 17.5V15.6213Z\" stroke-miterlimit=\"10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M15 9L9 15\" stroke-miterlimit=\"10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M10.5 9.5C10.5 10.0523 10.0523 10.5 9.5 10.5C8.94772 10.5 8.5 10.0523 8.5 9.5C8.5 8.94772 8.94772 8.5 9.5 8.5C10.0523 8.5 10.5 8.94772 10.5 9.5Z\" fill=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M15.5 14.5C15.5 15.0523 15.0523 15.5 14.5 15.5C13.9477 15.5 13.5 15.0523 13.5 14.5C13.5 13.9477 13.9477 13.5 14.5 13.5C15.0523 13.5 15.5 13.9477 15.5 14.5Z\" fill=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t</svg>`\n\t\t);\n\t}\n\n\tmake_cart_totals_section() {\n\t\tthis.$totals_section = this.$component.find('.cart-totals-section');\n\n\t\tthis.$totals_section.append(\n\t\t\t`<div class=\"add-discount-wrapper\">\n\t\t\t\t${this.get_discount_icon()} ${__('Add Discount')}\n\t\t\t</div>\n\t\t\t<div class=\"item-qty-total-container\">\n\t\t\t\t<div class=\"item-qty-total-label\">${__('Total Items')}</div>\n\t\t\t\t<div class=\"item-qty-total-value\">0.00</div>\n\t\t\t</div>\n\t\t\t<div class=\"net-total-container\">\n\t\t\t\t<div class=\"net-total-label\">${__(\"Net Total\")}</div>\n\t\t\t\t<div class=\"net-total-value\">0.00</div>\n\t\t\t</div>\n\t\t\t<div class=\"taxes-container\"></div>\n\t\t\t<div class=\"grand-total-container\">\n\t\t\t\t<div>${__('Grand Total')}</div>\n\t\t\t\t<div>0.00</div>\n\t\t\t</div>\n\t\t\t<div class=\"checkout-btn\">${__('Checkout')}</div>\n\t\t\t<div class=\"edit-cart-btn\">${__('Edit Cart')}</div>`\n\t\t)\n\n\t\tthis.$add_discount_elem = this.$component.find(\".add-discount-wrapper\");\n\t}\n\n\tmake_cart_numpad() {\n\t\tthis.$numpad_section = this.$component.find('.numpad-section');\n\n\t\tthis.number_pad = new erpnext.PointOfSale.NumberPad({\n\t\t\twrapper: this.$numpad_section,\n\t\t\tevents: {\n\t\t\t\tnumpad_event: this.on_numpad_event.bind(this)\n\t\t\t},\n\t\t\tcols: 5,\n\t\t\tkeys: [\n\t\t\t\t[ 1, 2, 3, 'Quantity' ],\n\t\t\t\t[ 4, 5, 6, 'Discount' ],\n\t\t\t\t[ 7, 8, 9, 'Rate' ],\n\t\t\t\t[ '.', 0, 'Delete', 'Remove' ]\n\t\t\t],\n\t\t\tcss_classes: [\n\t\t\t\t[ '', '', '', 'col-span-2' ],\n\t\t\t\t[ '', '', '', 'col-span-2' ],\n\t\t\t\t[ '', '', '', 'col-span-2' ],\n\t\t\t\t[ '', '', '', 'col-span-2 remove-btn' ]\n\t\t\t],\n\t\t\tfieldnames_map: { 'Quantity': 'qty', 'Discount': 'discount_percentage' }\n\t\t})\n\n\t\tthis.$numpad_section.prepend(\n\t\t\t`<div class=\"numpad-totals\">\n\t\t\t<span class=\"numpad-item-qty-total\"></span>\n\t\t\t\t<span class=\"numpad-net-total\"></span>\n\t\t\t\t<span class=\"numpad-grand-total\"></span>\n\t\t\t</div>`\n\t\t)\n\n\t\tthis.$numpad_section.append(\n\t\t\t`<div class=\"numpad-btn checkout-btn\" data-button-value=\"checkout\">${__('Checkout')}</div>`\n\t\t)\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\t\tthis.$customer_section.on('click', '.reset-customer-btn', function () {\n\t\t\tme.reset_customer_selector();\n\t\t});\n\n\t\tthis.$customer_section.on('click', '.close-details-btn', function () {\n\t\t\tme.toggle_customer_info(false);\n\t\t});\n\n\t\tthis.$customer_section.on('click', '.customer-display', function(e) {\n\t\t\tif ($(e.target).closest('.reset-customer-btn').length) return;\n\n\t\t\tconst show = me.$cart_container.is(':visible');\n\t\t\tme.toggle_customer_info(show);\n\t\t});\n\n\t\tthis.$cart_items_wrapper.on('click', '.cart-item-wrapper', function() {\n\t\t\tconst $cart_item = $(this);\n\n\t\t\tme.toggle_item_highlight(this);\n\n\t\t\tconst payment_section_hidden = !me.$totals_section.find('.edit-cart-btn').is(':visible');\n\t\t\tif (!payment_section_hidden) {\n\t\t\t\t// payment section is visible\n\t\t\t\t// edit cart first and then open item details section\n\t\t\t\tme.$totals_section.find(\".edit-cart-btn\").click();\n\t\t\t}\n\n\t\t\tconst item_row_name = unescape($cart_item.attr('data-row-name'));\n\t\t\tme.events.cart_item_clicked({ name: item_row_name });\n\t\t\tthis.numpad_value = '';\n\t\t});\n\n\t\tthis.$component.on('click', '.checkout-btn', async function() {\n\t\t\tif ($(this).attr('style').indexOf('--blue-500') == -1) return;\n\n\t\t\tawait me.events.checkout();\n\t\t\tme.toggle_checkout_btn(false);\n\n\t\t\tme.allow_discount_change && me.$add_discount_elem.removeClass(\"d-none\");\n\t\t});\n\n\t\tthis.$totals_section.on('click', '.edit-cart-btn', () => {\n\t\t\tthis.events.edit_cart();\n\t\t\tthis.toggle_checkout_btn(true);\n\t\t});\n\n\t\tthis.$component.on('click', '.add-discount-wrapper', () => {\n\t\t\tconst can_edit_discount = this.$add_discount_elem.find('.edit-discount-btn').length;\n\n\t\t\tif(!this.discount_field || can_edit_discount) this.show_discount_control();\n\t\t});\n\n\t\tfrappe.ui.form.on(\"POS Invoice\", \"paid_amount\", frm => {\n\t\t\t// called when discount is applied\n\t\t\tthis.update_totals_section(frm);\n\t\t});\n\t}\n\n\tattach_shortcuts() {\n\t\tfor (let row of this.number_pad.keys) {\n\t\t\tfor (let btn of row) {\n\t\t\t\tif (typeof btn !== 'string') continue; // do not make shortcuts for numbers\n\n\t\t\t\tlet shortcut_key = `ctrl+${frappe.scrub(String(btn))[0]}`;\n\t\t\t\tif (btn === 'Delete') shortcut_key = 'ctrl+backspace';\n\t\t\t\tif (btn === 'Remove') shortcut_key = 'shift+ctrl+backspace'\n\t\t\t\tif (btn === '.') shortcut_key = 'ctrl+>';\n\n\t\t\t\t// to account for fieldname map\n\t\t\t\tconst fieldname = this.number_pad.fieldnames[btn] ? this.number_pad.fieldnames[btn] :\n\t\t\t\t\ttypeof btn === 'string' ? frappe.scrub(btn) : btn;\n\n\t\t\t\tlet shortcut_label = shortcut_key.split('+').map(frappe.utils.to_title_case).join('+');\n\t\t\t\tshortcut_label = frappe.utils.is_mac() ? shortcut_label.replace('Ctrl', '\u2318') : shortcut_label;\n\t\t\t\tthis.$numpad_section.find(`.numpad-btn[data-button-value=\"${fieldname}\"]`).attr(\"title\", shortcut_label);\n\n\t\t\t\tfrappe.ui.keys.on(`${shortcut_key}`, () => {\n\t\t\t\t\tconst cart_is_visible = this.$component.is(\":visible\");\n\t\t\t\t\tif (cart_is_visible && this.item_is_selected && this.$numpad_section.is(\":visible\")) {\n\t\t\t\t\t\tthis.$numpad_section.find(`.numpad-btn[data-button-value=\"${fieldname}\"]`).click();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\tconst ctrl_label = frappe.utils.is_mac() ? '\u2318' : 'Ctrl';\n\t\tthis.$component.find(\".checkout-btn\").attr(\"title\", `${ctrl_label}+Enter`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+enter\",\n\t\t\taction: () => this.$component.find(\".checkout-btn\").click(),\n\t\t\tcondition: () => this.$component.is(\":visible\") && !this.$totals_section.find('.edit-cart-btn').is(':visible'),\n\t\t\tdescription: __(\"Checkout Order / Submit Order / New Order\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t\tthis.$component.find(\".edit-cart-btn\").attr(\"title\", `${ctrl_label}+E`);\n\t\tfrappe.ui.keys.on(\"ctrl+e\", () => {\n\t\t\tconst item_cart_visible = this.$component.is(\":visible\");\n\t\t\tconst checkout_btn_invisible = !this.$totals_section.find('.checkout-btn').is('visible');\n\t\t\tif (item_cart_visible && checkout_btn_invisible) {\n\t\t\t\tthis.$component.find(\".edit-cart-btn\").click();\n\t\t\t}\n\t\t});\n\t\tthis.$component.find(\".add-discount-wrapper\").attr(\"title\", `${ctrl_label}+D`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+d\",\n\t\t\taction: () => this.$component.find(\".add-discount-wrapper\").click(),\n\t\t\tcondition: () => this.$add_discount_elem.is(\":visible\"),\n\t\t\tdescription: __(\"Add Order Discount\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t\tfrappe.ui.keys.on(\"escape\", () => {\n\t\t\tconst item_cart_visible = this.$component.is(\":visible\");\n\t\t\tif (item_cart_visible && this.discount_field && this.discount_field.parent.is(\":visible\")) {\n\t\t\t\tthis.discount_field.set_value(0);\n\t\t\t}\n\t\t});\n\t}\n\n\ttoggle_item_highlight(item) {\n\t\tconst $cart_item = $(item);\n\t\tconst item_is_highlighted = $cart_item.attr(\"style\") == \"background-color:var(--gray-50);\";\n\n\t\tif (!item || item_is_highlighted) {\n\t\t\tthis.item_is_selected = false;\n\t\t\tthis.$cart_container.find('.cart-item-wrapper').css(\"background-color\", \"\");\n\t\t} else {\n\t\t\t$cart_item.css(\"background-color\", \"var(--gray-50)\");\n\t\t\tthis.item_is_selected = true;\n\t\t\tthis.$cart_container.find('.cart-item-wrapper').not(item).css(\"background-color\", \"\");\n\t\t}\n\t}\n\n\tmake_customer_selector() {\n\t\tthis.$customer_section.html(`\n\t\t\t<div class=\"customer-field\"></div>\n\t\t`);\n\t\tconst me = this;\n\t\tconst query = { query: 'erpnext.controllers.queries.customer_query' };\n\t\tconst allowed_customer_group = this.allowed_customer_groups || [];\n\t\tif (allowed_customer_group.length) {\n\t\t\tquery.filters = {\n\t\t\t\tcustomer_group: ['in', allowed_customer_group]\n\t\t\t}\n\t\t}\n\t\tthis.customer_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Customer'),\n\t\t\t\tfieldtype: 'Link',\n\t\t\t\toptions: 'Customer',\n\t\t\t\tplaceholder: __('Search by customer name, phone, email.'),\n\t\t\t\tget_query: () => query,\n\t\t\t\tonchange: function() {\n\t\t\t\t\tif (this.value) {\n\t\t\t\t\t\tconst frm = me.events.get_frm();\n\t\t\t\t\t\tfrappe.dom.freeze();\n\t\t\t\t\t\tfrappe.model.set_value(frm.doc.doctype, frm.doc.name, 'customer', this.value);\n\t\t\t\t\t\tfrm.script_manager.trigger('customer', frm.doc.doctype, frm.doc.name).then(() => {\n\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t() => me.fetch_customer_details(this.value),\n\t\t\t\t\t\t\t\t() => me.events.customer_details_updated(me.customer_info),\n\t\t\t\t\t\t\t\t() => me.update_customer_section(),\n\t\t\t\t\t\t\t\t() => me.update_totals_section(),\n\t\t\t\t\t\t\t\t() => frappe.dom.unfreeze()\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.$customer_section.find('.customer-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.customer_field.toggle_label(false);\n\t}\n\n\tfetch_customer_details(customer) {\n\t\tif (customer) {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tfrappe.db.get_value('Customer', customer, [\"email_id\", \"mobile_no\", \"image\", \"loyalty_program\"]).then(({ message }) => {\n\t\t\t\t\tconst { loyalty_program } = message;\n\t\t\t\t\t// if loyalty program then fetch loyalty points too\n\t\t\t\t\tif (loyalty_program) {\n\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\tmethod: \"erpnext.accounts.doctype.loyalty_program.loyalty_program.get_loyalty_program_details_with_points\",\n\t\t\t\t\t\t\targs: { customer, loyalty_program, \"silent\": true },\n\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\tconst { loyalty_points, conversion_factor } = r.message;\n\t\t\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t\t\tthis.customer_info = { ...message, customer, loyalty_points, conversion_factor };\n\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.customer_info = { ...message, customer };\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tthis.customer_info = {}\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\t}\n\n\tshow_discount_control() {\n\t\tthis.$add_discount_elem.css({ 'padding': '0px', 'border': 'none' });\n\t\tthis.$add_discount_elem.html(\n\t\t\t`<div class=\"add-discount-field\"></div>`\n\t\t);\n\t\tconst me = this;\n\t\tconst frm = me.events.get_frm();\n\t\tlet discount = frm.doc.additional_discount_percentage;\n\n\t\tthis.discount_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Discount'),\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tplaceholder: ( discount ? discount + '%' :  __('Enter discount percentage.') ),\n\t\t\t\tinput_class: 'input-xs',\n\t\t\t\tonchange: function() {\n\t\t\t\t\tif (flt(this.value) != 0) {\n\t\t\t\t\t\tfrappe.model.set_value(frm.doc.doctype, frm.doc.name, 'additional_discount_percentage', flt(this.value));\n\t\t\t\t\t\tme.hide_discount_control(this.value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.model.set_value(frm.doc.doctype, frm.doc.name, 'additional_discount_percentage', 0);\n\t\t\t\t\t\tme.$add_discount_elem.css({\n\t\t\t\t\t\t\t'border': '1px dashed var(--gray-500)',\n\t\t\t\t\t\t\t'padding': 'var(--padding-sm) var(--padding-md)'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tme.$add_discount_elem.html(`${me.get_discount_icon()} ${__('Add Discount')}`);\n\t\t\t\t\t\tme.discount_field = undefined;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.$add_discount_elem.find('.add-discount-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.discount_field.toggle_label(false);\n\t\tthis.discount_field.set_focus();\n\t}\n\n\thide_discount_control(discount) {\n\t\tif (!discount) {\n\t\t\tthis.$add_discount_elem.css({ 'padding': '0px', 'border': 'none' });\n\t\t\tthis.$add_discount_elem.html(\n\t\t\t\t`<div class=\"add-discount-field\"></div>`\n\t\t\t);\n\t\t} else {\n\t\t\tthis.$add_discount_elem.css({\n\t\t\t\t'border': '1px dashed var(--dark-green-500)',\n\t\t\t\t'padding': 'var(--padding-sm) var(--padding-md)'\n\t\t\t});\n\t\t\tthis.$add_discount_elem.html(\n\t\t\t\t`<div class=\"edit-discount-btn\">\n\t\t\t\t\t${this.get_discount_icon()} ${__(\"Additional\")}&nbsp;${String(discount).bold()}% ${__(\"discount applied\")}\n\t\t\t\t</div>`\n\t\t\t);\n\t\t}\n\t}\n\n\tupdate_customer_section() {\n\t\tconst me = this;\n\t\tconst { customer, email_id='', mobile_no='', image } = this.customer_info || {};\n\n\t\tif (customer) {\n\t\t\tthis.$customer_section.html(\n\t\t\t\t`<div class=\"customer-details\">\n\t\t\t\t\t<div class=\"customer-display\">\n\t\t\t\t\t\t${this.get_customer_image()}\n\t\t\t\t\t\t<div class=\"customer-name-desc\">\n\t\t\t\t\t\t\t<div class=\"customer-name\">${customer}</div>\n\t\t\t\t\t\t\t${get_customer_description()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"reset-customer-btn\" data-customer=\"${escape(customer)}\">\n\t\t\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n\t\t\t);\n\t\t} else {\n\t\t\t// reset customer selector\n\t\t\tthis.reset_customer_selector();\n\t\t}\n\n\t\tfunction get_customer_description() {\n\t\t\tif (!email_id && !mobile_no) {\n\t\t\t\treturn `<div class=\"customer-desc\">${__('Click to add email / phone')}</div>`;\n\t\t\t} else if (email_id && !mobile_no) {\n\t\t\t\treturn `<div class=\"customer-desc\">${email_id}</div>`;\n\t\t\t} else if (mobile_no && !email_id) {\n\t\t\t\treturn `<div class=\"customer-desc\">${mobile_no}</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"customer-desc\">${email_id} - ${mobile_no}</div>`;\n\t\t\t}\n\t\t}\n\n\t}\n\n\tget_customer_image() {\n\t\tconst { customer, image } = this.customer_info || {};\n\t\tif (image) {\n\t\t\treturn `<div class=\"customer-image\"><img src=\"${image}\" alt=\"${image}\"\"></div>`;\n\t\t} else {\n\t\t\treturn `<div class=\"customer-image customer-abbr\">${frappe.get_abbr(customer)}</div>`;\n\t\t}\n\t}\n\n\tupdate_totals_section(frm) {\n\t\tif (!frm) frm = this.events.get_frm();\n\n\t\tthis.render_net_total(frm.doc.net_total);\n\t\tthis.render_total_item_qty(frm.doc.items);\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? frm.doc.grand_total : frm.doc.rounded_total;\n\t\tthis.render_grand_total(grand_total);\n\n\t\tthis.render_taxes(frm.doc.taxes);\n\t}\n\n\trender_net_total(value) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tthis.$totals_section.find('.net-total-container').html(\n\t\t\t`<div>${__('Net Total')}</div><div>${format_currency(value, currency)}</div>`\n\t\t)\n\n\t\tthis.$numpad_section.find('.numpad-net-total').html(\n\t\t\t`<div>${__('Net Total')}: <span>${format_currency(value, currency)}</span></div>`\n\t\t);\n\t}\n\n\trender_total_item_qty(items) {\n\t\tvar total_item_qty = 0;\n\t\titems.map((item) => {\n\t\t\ttotal_item_qty = total_item_qty + item.qty;\n\t\t});\n\n\t\tthis.$totals_section.find('.item-qty-total-container').html(\n\t\t\t`<div>${__('Total Quantity')}</div><div>${total_item_qty}</div>`\n\t\t);\n\n\t\tthis.$numpad_section.find('.numpad-item-qty-total').html(\n\t\t\t`<div>${__('Total Quantity')}: <span>${total_item_qty}</span></div>`\n\t\t);\n\t}\n\n\trender_grand_total(value) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tthis.$totals_section.find('.grand-total-container').html(\n\t\t\t`<div>${__('Grand Total')}</div><div>${format_currency(value, currency)}</div>`\n\t\t)\n\n\t\tthis.$numpad_section.find('.numpad-grand-total').html(\n\t\t\t`<div>${__('Grand Total')}: <span>${format_currency(value, currency)}</span></div>`\n\t\t);\n\t}\n\n\trender_taxes(taxes) {\n\t\tif (taxes.length) {\n\t\t\tconst currency = this.events.get_frm().doc.currency;\n\t\t\tconst taxes_html = taxes.map(t => {\n\t\t\t\tif (t.tax_amount_after_discount_amount == 0.0) return;\n\t\t\t\tconst description = /[0-9]+/.test(t.description) ? t.description : `${t.description} @ ${t.rate}%`;\n\t\t\t\treturn `<div class=\"tax-row\">\n\t\t\t\t\t<div class=\"tax-label\">${description}</div>\n\t\t\t\t\t<div class=\"tax-value\">${format_currency(t.tax_amount_after_discount_amount, currency)}</div>\n\t\t\t\t</div>`;\n\t\t\t}).join('');\n\t\t\tthis.$totals_section.find('.taxes-container').css('display', 'flex').html(taxes_html);\n\t\t} else {\n\t\t\tthis.$totals_section.find('.taxes-container').css('display', 'none').html('');\n\t\t}\n\t}\n\n\tget_cart_item({ name }) {\n\t\tconst item_selector = `.cart-item-wrapper[data-row-name=\"${escape(name)}\"]`;\n\t\treturn this.$cart_items_wrapper.find(item_selector);\n\t}\n\n\tget_item_from_frm(item) {\n\t\tconst doc = this.events.get_frm().doc;\n\t\treturn doc.items.find(i => i.name == item.name);\n\t}\n\n\tupdate_item_html(item, remove_item) {\n\t\tconst $item = this.get_cart_item(item);\n\n\t\tif (remove_item) {\n\t\t\t$item && $item.next().remove() && $item.remove();\n\t\t} else {\n\t\t\tconst item_row = this.get_item_from_frm(item);\n\t\t\tthis.render_cart_item(item_row, $item);\n\t\t}\n\n\t\tconst no_of_cart_items = this.$cart_items_wrapper.find('.cart-item-wrapper').length;\n\t\tthis.highlight_checkout_btn(no_of_cart_items > 0);\n\n\t\tthis.update_empty_cart_section(no_of_cart_items);\n\t}\n\n\trender_cart_item(item_data, $item_to_update) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tconst me = this;\n\n\t\tif (!$item_to_update.length) {\n\t\t\tthis.$cart_items_wrapper.append(\n\t\t\t\t`<div class=\"cart-item-wrapper\" data-row-name=\"${escape(item_data.name)}\"></div>\n\t\t\t\t<div class=\"seperator\"></div>`\n\t\t\t)\n\t\t\t$item_to_update = this.get_cart_item(item_data);\n\t\t}\n\n\t\t$item_to_update.html(\n\t\t\t`${get_item_image_html()}\n\t\t\t<div class=\"item-name-desc\">\n\t\t\t\t<div class=\"item-name\">\n\t\t\t\t\t${item_data.item_name}\n\t\t\t\t</div>\n\t\t\t\t${get_description_html()}\n\t\t\t</div>\n\t\t\t${get_rate_discount_html()}`\n\t\t)\n\n\t\tset_dynamic_rate_header_width();\n\n\t\tfunction set_dynamic_rate_header_width() {\n\t\t\tconst rate_cols = Array.from(me.$cart_items_wrapper.find(\".item-rate-amount\"));\n\t\t\tme.$cart_header.find(\".rate-amount-header\").css(\"width\", \"\");\n\t\t\tme.$cart_items_wrapper.find(\".item-rate-amount\").css(\"width\", \"\");\n\t\t\tlet max_width = rate_cols.reduce((max_width, elm) => {\n\t\t\t\tif ($(elm).width() > max_width)\n\t\t\t\t\tmax_width = $(elm).width();\n\t\t\t\treturn max_width;\n\t\t\t}, 0);\n\n\t\t\tmax_width += 1;\n\t\t\tif (max_width == 1) max_width = \"\";\n\n\t\t\tme.$cart_header.find(\".rate-amount-header\").css(\"width\", max_width);\n\t\t\tme.$cart_items_wrapper.find(\".item-rate-amount\").css(\"width\", max_width);\n\t\t}\n\n\t\tfunction get_rate_discount_html() {\n\t\t\tif (item_data.rate && item_data.amount && item_data.rate !== item_data.amount) {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"item-qty-rate\">\n\t\t\t\t\t\t<div class=\"item-qty\"><span>${item_data.qty || 0}</span></div>\n\t\t\t\t\t\t<div class=\"item-rate-amount\">\n\t\t\t\t\t\t\t<div class=\"item-rate\">${format_currency(item_data.amount, currency)}</div>\n\t\t\t\t\t\t\t<div class=\"item-amount\">${format_currency(item_data.rate, currency)}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`\n\t\t\t} else {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"item-qty-rate\">\n\t\t\t\t\t\t<div class=\"item-qty\"><span>${item_data.qty || 0}</span></div>\n\t\t\t\t\t\t<div class=\"item-rate-amount\">\n\t\t\t\t\t\t\t<div class=\"item-rate\">${format_currency(item_data.rate, currency)}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`\n\t\t\t}\n\t\t}\n\n\t\tfunction get_description_html() {\n\t\t\tif (item_data.description) {\n\t\t\t\tif (item_data.description.indexOf('<div>') != -1) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\titem_data.description = $(item_data.description).text();\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\titem_data.description = item_data.description.replace(/<div>/g, ' ').replace(/<\\/div>/g, ' ').replace(/ +/g, ' ');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\titem_data.description = frappe.ellipsis(item_data.description, 45);\n\t\t\t\treturn `<div class=\"item-desc\">${item_data.description}</div>`;\n\t\t\t}\n\t\t\treturn ``;\n\t\t}\n\n\t\tfunction get_item_image_html() {\n\t\t\tconst { image, item_name } = item_data;\n\t\t\tif (!me.hide_images && image) {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"item-image\">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tonerror=\"cur_pos.cart.handle_broken_image(this)\"\n\t\t\t\t\t\t\tsrc=\"${image}\" alt=\"${frappe.get_abbr(item_name)}\"\">\n\t\t\t\t\t</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"item-image item-abbr\">${frappe.get_abbr(item_name)}</div>`;\n\t\t\t}\n\t\t}\n\t}\n\n\thandle_broken_image($img) {\n\t\tconst item_abbr = $($img).attr('alt');\n\t\t$($img).parent().replaceWith(`<div class=\"item-image item-abbr\">${item_abbr}</div>`);\n\t}\n\n\tupdate_selector_value_in_cart_item(selector, value, item) {\n\t\tconst $item_to_update = this.get_cart_item(item);\n\t\t$item_to_update.attr(`data-${selector}`, escape(value));\n\t}\n\n\ttoggle_checkout_btn(show_checkout) {\n\t\tif (show_checkout) {\n\t\t\tthis.$totals_section.find('.checkout-btn').css('display', 'flex');\n\t\t\tthis.$totals_section.find('.edit-cart-btn').css('display', 'none');\n\t\t} else {\n\t\t\tthis.$totals_section.find('.checkout-btn').css('display', 'none');\n\t\t\tthis.$totals_section.find('.edit-cart-btn').css('display', 'flex');\n\t\t}\n\t}\n\n\thighlight_checkout_btn(toggle) {\n\t\tif (toggle) {\n\t\t\tthis.$add_discount_elem.css('display', 'flex');\n\t\t\tthis.$cart_container.find('.checkout-btn').css({\n\t\t\t\t'background-color': 'var(--blue-500)'\n\t\t\t});\n\t\t} else {\n\t\t\tthis.$add_discount_elem.css('display', 'none');\n\t\t\tthis.$cart_container.find('.checkout-btn').css({\n\t\t\t\t'background-color': 'var(--blue-200)'\n\t\t\t});\n\t\t}\n\t}\n\n\tupdate_empty_cart_section(no_of_cart_items) {\n\t\tconst $no_item_element = this.$cart_items_wrapper.find('.no-item-wrapper');\n\n\t\t// if cart has items and no item is present\n\t\tno_of_cart_items > 0 && $no_item_element && $no_item_element.remove() && this.$cart_header.css('display', 'flex');\n\n\t\tno_of_cart_items === 0 && !$no_item_element.length && this.make_no_items_placeholder();\n\t}\n\n\ton_numpad_event($btn) {\n\t\tconst current_action = $btn.attr('data-button-value');\n\t\tconst action_is_field_edit = ['qty', 'discount_percentage', 'rate'].includes(current_action);\n\t\tconst action_is_allowed = action_is_field_edit ? (\n\t\t\t(current_action == 'rate' && this.allow_rate_change) ||\n\t\t\t(current_action == 'discount_percentage' && this.allow_discount_change) ||\n\t\t\t(current_action == 'qty')) : true;\n\n\t\tconst action_is_pressed_twice = this.prev_action === current_action;\n\t\tconst first_click_event = !this.prev_action;\n\t\tconst field_to_edit_changed = this.prev_action && this.prev_action != current_action;\n\n\t\tif (action_is_field_edit) {\n\t\t\tif (!action_is_allowed) {\n\t\t\t\tconst label = current_action == 'rate' ? 'Rate'.bold() : 'Discount'.bold();\n\t\t\t\tconst message = __('Editing {0} is not allowed as per POS Profile settings', [label]);\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tindicator: 'red',\n\t\t\t\t\tmessage: message\n\t\t\t\t});\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (first_click_event || field_to_edit_changed) {\n\t\t\t\tthis.prev_action = current_action;\n\t\t\t} else if (action_is_pressed_twice) {\n\t\t\t\tthis.prev_action = undefined;\n\t\t\t}\n\t\t\tthis.numpad_value = '';\n\n\t\t} else if (current_action === 'checkout') {\n\t\t\tthis.prev_action = undefined;\n\t\t\tthis.toggle_item_highlight();\n\t\t\tthis.events.numpad_event(undefined, current_action);\n\t\t\treturn;\n\t\t} else if (current_action === 'remove') {\n\t\t\tthis.prev_action = undefined;\n\t\t\tthis.toggle_item_highlight();\n\t\t\tthis.events.numpad_event(undefined, current_action);\n\t\t\treturn;\n\t\t} else {\n\t\t\tthis.numpad_value = current_action === 'delete' ? this.numpad_value.slice(0, -1) : this.numpad_value + current_action;\n\t\t\tthis.numpad_value = this.numpad_value || 0;\n\t\t}\n\n\t\tconst first_click_event_is_not_field_edit = !action_is_field_edit && first_click_event;\n\n\t\tif (first_click_event_is_not_field_edit) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tindicator: 'red',\n\t\t\t\tmessage: __('Please select a field to edit from numpad')\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (flt(this.numpad_value) > 100 && this.prev_action === 'discount_percentage') {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __('Discount cannot be greater than 100%'),\n\t\t\t\tindicator: 'orange'\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\tthis.numpad_value = current_action;\n\t\t}\n\n\t\tthis.highlight_numpad_btn($btn, current_action);\n\t\tthis.events.numpad_event(this.numpad_value, this.prev_action);\n\t}\n\n\thighlight_numpad_btn($btn, curr_action) {\n\t\tconst curr_action_is_highlighted = $btn.hasClass('highlighted-numpad-btn');\n\t\tconst curr_action_is_action = ['qty', 'discount_percentage', 'rate', 'done'].includes(curr_action);\n\n\t\tif (!curr_action_is_highlighted) {\n\t\t\t$btn.addClass('highlighted-numpad-btn');\n\t\t}\n\t\tif (this.prev_action === curr_action && curr_action_is_highlighted) {\n\t\t\t// if Qty is pressed twice\n\t\t\t$btn.removeClass('highlighted-numpad-btn');\n\t\t}\n\t\tif (this.prev_action && this.prev_action !== curr_action && curr_action_is_action) {\n\t\t\t// Order: Qty -> Rate then remove Qty highlight\n\t\t\tconst prev_btn = $(`[data-button-value='${this.prev_action}']`);\n\t\t\tprev_btn.removeClass('highlighted-numpad-btn');\n\t\t}\n\t\tif (!curr_action_is_action || curr_action === 'done') {\n\t\t\t// if numbers are clicked\n\t\t\tsetTimeout(() => {\n\t\t\t\t$btn.removeClass('highlighted-numpad-btn');\n\t\t\t}, 200);\n\t\t}\n\t}\n\n\ttoggle_numpad(show) {\n\t\tif (show) {\n\t\t\tthis.$totals_section.css('display', 'none');\n\t\t\tthis.$numpad_section.css('display', 'flex');\n\t\t} else {\n\t\t\tthis.$totals_section.css('display', 'flex');\n\t\t\tthis.$numpad_section.css('display', 'none');\n\t\t}\n\t\tthis.reset_numpad();\n\t}\n\n\treset_numpad() {\n\t\tthis.numpad_value = '';\n\t\tthis.prev_action = undefined;\n\t\tthis.$numpad_section.find('.highlighted-numpad-btn').removeClass('highlighted-numpad-btn');\n\t}\n\n\ttoggle_numpad_field_edit(fieldname) {\n\t\tif (['qty', 'discount_percentage', 'rate'].includes(fieldname)) {\n\t\t\tthis.$numpad_section.find(`[data-button-value=\"${fieldname}\"]`).click();\n\t\t}\n\t}\n\n\ttoggle_customer_info(show) {\n\t\tif (show) {\n\t\t\tconst { customer } = this.customer_info || {};\n\n\t\t\tthis.$cart_container.css('display', 'none');\n\t\t\tthis.$customer_section.css({\n\t\t\t\t'height': '100%',\n\t\t\t\t'padding-top': '0px'\n\t\t\t});\n\t\t\tthis.$customer_section.find('.customer-details').html(\n\t\t\t\t`<div class=\"header\">\n\t\t\t\t\t<div class=\"label\">Contact Details</div>\n\t\t\t\t\t<div class=\"close-details-btn\">\n\t\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"customer-display\">\n\t\t\t\t\t${this.get_customer_image()}\n\t\t\t\t\t<div class=\"customer-name-desc\">\n\t\t\t\t\t\t<div class=\"customer-name\">${customer}</div>\n\t\t\t\t\t\t<div class=\"customer-desc\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"customer-fields-container\">\n\t\t\t\t\t<div class=\"email_id-field\"></div>\n\t\t\t\t\t<div class=\"mobile_no-field\"></div>\n\t\t\t\t\t<div class=\"loyalty_program-field\"></div>\n\t\t\t\t\t<div class=\"loyalty_points-field\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"transactions-label\">Recent Transactions</div>`\n\t\t\t);\n\t\t\t// transactions need to be in diff div from sticky elem for scrolling\n\t\t\tthis.$customer_section.append(`<div class=\"customer-transactions\"></div>`);\n\n\t\t\tthis.render_customer_fields();\n\t\t\tthis.fetch_customer_transactions();\n\n\t\t} else {\n\t\t\tthis.$cart_container.css('display', 'flex');\n\t\t\tthis.$customer_section.css({\n\t\t\t\t'height': '',\n\t\t\t\t'padding-top': ''\n\t\t\t});\n\n\t\t\tthis.update_customer_section();\n\t\t}\n\t}\n\n\trender_customer_fields() {\n\t\tconst $customer_form = this.$customer_section.find('.customer-fields-container');\n\n\t\tconst dfs = [{\n\t\t\tfieldname: 'email_id',\n\t\t\tlabel: __('Email'),\n\t\t\tfieldtype: 'Data',\n\t\t\toptions: 'email',\n\t\t\tplaceholder: __(\"Enter customer's email\")\n\t\t},{\n\t\t\tfieldname: 'mobile_no',\n\t\t\tlabel: __('Phone Number'),\n\t\t\tfieldtype: 'Data',\n\t\t\tplaceholder: __(\"Enter customer's phone number\")\n\t\t},{\n\t\t\tfieldname: 'loyalty_program',\n\t\t\tlabel: __('Loyalty Program'),\n\t\t\tfieldtype: 'Link',\n\t\t\toptions: 'Loyalty Program',\n\t\t\tplaceholder: __(\"Select Loyalty Program\")\n\t\t},{\n\t\t\tfieldname: 'loyalty_points',\n\t\t\tlabel: __('Loyalty Points'),\n\t\t\tfieldtype: 'Data',\n\t\t\tread_only: 1\n\t\t}];\n\n\t\tconst me = this;\n\t\tdfs.forEach(df => {\n\t\t\tthis[`customer_${df.fieldname}_field`] = frappe.ui.form.make_control({\n\t\t\t\tdf: { ...df,\n\t\t\t\t\tonchange: handle_customer_field_change,\n\t\t\t\t},\n\t\t\t\tparent: $customer_form.find(`.${df.fieldname}-field`),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t\tthis[`customer_${df.fieldname}_field`].set_value(this.customer_info[df.fieldname]);\n\t\t})\n\n\t\tfunction handle_customer_field_change() {\n\t\t\tconst current_value = me.customer_info[this.df.fieldname];\n\t\t\tconst current_customer = me.customer_info.customer;\n\n\t\t\tif (this.value && current_value != this.value && this.df.fieldname != 'loyalty_points') {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: 'erpnext.selling.page.point_of_sale.point_of_sale.set_customer_info',\n\t\t\t\t\targs: {\n\t\t\t\t\t\tfieldname: this.df.fieldname,\n\t\t\t\t\t\tcustomer: current_customer,\n\t\t\t\t\t\tvalue: this.value\n\t\t\t\t\t},\n\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\t\tme.customer_info[this.df.fieldname] = this.value;\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __(\"Customer contact updated successfully.\"),\n\t\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tfetch_customer_transactions() {\n\t\tfrappe.db.get_list('POS Invoice', {\n\t\t\tfilters: { customer: this.customer_info.customer, docstatus: 1 },\n\t\t\tfields: ['name', 'grand_total', 'status', 'posting_date', 'posting_time', 'currency'],\n\t\t\tlimit: 20\n\t\t}).then((res) => {\n\t\t\tconst transaction_container = this.$customer_section.find('.customer-transactions');\n\n\t\t\tif (!res.length) {\n\t\t\t\ttransaction_container.html(\n\t\t\t\t\t`<div class=\"no-transactions-placeholder\">No recent transactions found</div>`\n\t\t\t\t)\n\t\t\t\treturn;\n\t\t\t};\n\n\t\t\tconst elapsed_time = moment(res[0].posting_date+\" \"+res[0].posting_time).fromNow();\n\t\t\tthis.$customer_section.find('.customer-desc').html(`Last transacted ${elapsed_time}`);\n\n\t\t\tres.forEach(invoice => {\n\t\t\t\tconst posting_datetime = moment(invoice.posting_date+\" \"+invoice.posting_time).format(\"Do MMMM, h:mma\");\n\t\t\t\tlet indicator_color = {\n\t\t\t\t\t'Paid': 'green',\n\t\t\t\t\t'Draft': 'red',\n\t\t\t\t\t'Return': 'gray',\n\t\t\t\t\t'Consolidated': 'blue'\n\t\t\t\t};\n\n\t\t\t\ttransaction_container.append(\n\t\t\t\t\t`<div class=\"invoice-wrapper\" data-invoice-name=\"${escape(invoice.name)}\">\n\t\t\t\t\t\t<div class=\"invoice-name-date\">\n\t\t\t\t\t\t\t<div class=\"invoice-name\">${invoice.name}</div>\n\t\t\t\t\t\t\t<div class=\"invoice-date\">${posting_datetime}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"invoice-total-status\">\n\t\t\t\t\t\t\t<div class=\"invoice-total\">\n\t\t\t\t\t\t\t\t${format_currency(invoice.grand_total, invoice.currency, 0) || 0}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"invoice-status\">\n\t\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color[invoice.status]}\">\n\t\t\t\t\t\t\t\t\t<span>${invoice.status}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"seperator\"></div>`\n\t\t\t\t)\n\t\t\t});\n\t\t});\n\t}\n\n\tattach_refresh_field_event(frm) {\n\t\t$(frm.wrapper).off('refresh-fields');\n\t\t$(frm.wrapper).on('refresh-fields', () => {\n\t\t\tif (frm.doc.items.length) {\n\t\t\t\tthis.$cart_items_wrapper.html('');\n\t\t\t\tfrm.doc.items.forEach(item => {\n\t\t\t\t\tthis.update_item_html(item);\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.update_totals_section(frm);\n\t\t});\n\t}\n\n\tload_invoice() {\n\t\tconst frm = this.events.get_frm();\n\n\t\tthis.attach_refresh_field_event(frm);\n\n\t\tthis.fetch_customer_details(frm.doc.customer).then(() => {\n\t\t\tthis.events.customer_details_updated(this.customer_info);\n\t\t\tthis.update_customer_section();\n\t\t});\n\n\t\tthis.$cart_items_wrapper.html('');\n\t\tif (frm.doc.items.length) {\n\t\t\tfrm.doc.items.forEach(item => {\n\t\t\t\tthis.update_item_html(item);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.make_no_items_placeholder();\n\t\t\tthis.highlight_checkout_btn(false);\n\t\t}\n\n\t\tthis.update_totals_section(frm);\n\n\t\tif(frm.doc.docstatus === 1) {\n\t\t\tthis.$totals_section.find('.checkout-btn').css('display', 'none');\n\t\t\tthis.$totals_section.find('.edit-cart-btn').css('display', 'none');\n\t\t} else {\n\t\t\tthis.$totals_section.find('.checkout-btn').css('display', 'flex');\n\t\t\tthis.$totals_section.find('.edit-cart-btn').css('display', 'none');\n\t\t}\n\n\t\tthis.toggle_component(true);\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') : this.$component.css('display', 'none');\n\t}\n\n}\n", "erpnext.PointOfSale.ItemDetails = class {\n\tconstructor({ wrapper, events, settings }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.hide_images = settings.hide_images;\n\t\tthis.allow_rate_change = settings.allow_rate_change;\n\t\tthis.allow_discount_change = settings.allow_discount_change;\n\t\tthis.current_item = {};\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.init_child_components();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"item-details-container\"></section>`\n\t\t)\n\n\t\tthis.$component = this.wrapper.find('.item-details-container');\n\t}\n\n\tinit_child_components() {\n\t\tthis.$component.html(\n\t\t\t`<div class=\"item-details-header\">\n\t\t\t\t<div class=\"label\">${__('Item Details')}</div>\n\t\t\t\t<div class=\"close-btn\">\n\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"item-display\">\n\t\t\t\t<div class=\"item-name-desc-price\">\n\t\t\t\t\t<div class=\"item-name\"></div>\n\t\t\t\t\t<div class=\"item-desc\"></div>\n\t\t\t\t\t<div class=\"item-price\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"item-image\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"discount-section\"></div>\n\t\t\t<div class=\"form-container\"></div>`\n\t\t)\n\n\t\tthis.$item_name = this.$component.find('.item-name');\n\t\tthis.$item_description = this.$component.find('.item-desc');\n\t\tthis.$item_price = this.$component.find('.item-price');\n\t\tthis.$item_image = this.$component.find('.item-image');\n\t\tthis.$form_container = this.$component.find('.form-container');\n\t\tthis.$dicount_section = this.$component.find('.discount-section');\n\t}\n\n\tcompare_with_current_item(item) {\n\t\t// returns true if `item` is currently being edited\n\t\treturn item && item.name == this.current_item.name;\n\t}\n\n\tasync toggle_item_details_section(item) {\n\t\tconst current_item_changed = !this.compare_with_current_item(item);\n\n\t\t// if item is null or highlighted cart item is clicked twice\n\t\tconst hide_item_details = !Boolean(item) || !current_item_changed;\n\n\t\tif ((!hide_item_details && current_item_changed) || hide_item_details) {\n\t\t\t// if item details is being closed OR if item details is opened but item is changed\n\t\t\t// in both cases, if the current item is a serialized item, then validate and remove the item\n\t\t\tawait this.validate_serial_batch_item();\n\t\t}\n\n\t\tthis.events.toggle_item_selector(!hide_item_details);\n\t\tthis.toggle_component(!hide_item_details);\n\n\t\tif (item && current_item_changed) {\n\t\t\tthis.doctype = item.doctype;\n\t\t\tthis.item_meta = frappe.get_meta(this.doctype);\n\t\t\tthis.name = item.name;\n\t\t\tthis.item_row = item;\n\t\t\tthis.currency = this.events.get_frm().doc.currency;\n\n\t\t\tthis.current_item = item;\n\n\t\t\tthis.render_dom(item);\n\t\t\tthis.render_discount_dom(item);\n\t\t\tthis.render_form(item);\n\t\t\tthis.events.highlight_cart_item(item);\n\t\t} else {\n\t\t\tthis.current_item = {};\n\t\t}\n\t}\n\n\tvalidate_serial_batch_item() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst item_row = doc.items.find(item => item.name === this.name);\n\n\t\tif (!item_row) return;\n\n\t\tconst serialized = item_row.has_serial_no;\n\t\tconst batched = item_row.has_batch_no;\n\t\tconst no_serial_selected = !item_row.serial_no;\n\t\tconst no_batch_selected = !item_row.batch_no;\n\n\t\tif ((serialized && no_serial_selected) || (batched && no_batch_selected) ||\n\t\t\t(serialized && batched && (no_batch_selected || no_serial_selected))) {\n\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"Item is removed since no serial / batch no selected.\"),\n\t\t\t\tindicator: 'orange'\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"cancel\");\n\t\t\treturn this.events.remove_item_from_cart();\n\t\t}\n\t}\n\n\trender_dom(item) {\n\t\tlet { item_name, description, image, price_list_rate } = item;\n\n\t\tfunction get_description_html() {\n\t\t\tif (description) {\n\t\t\t\tdescription = description.indexOf('...') === -1 && description.length > 140 ? description.substr(0, 139) + '...' : description;\n\t\t\t\treturn description;\n\t\t\t}\n\t\t\treturn ``;\n\t\t}\n\n\t\tthis.$item_name.html(item_name);\n\t\tthis.$item_description.html(get_description_html());\n\t\tthis.$item_price.html(format_currency(price_list_rate, this.currency));\n\t\tif (!this.hide_images && image) {\n\t\t\tthis.$item_image.html(\n\t\t\t\t`<img\n\t\t\t\t\tonerror=\"cur_pos.item_details.handle_broken_image(this)\"\n\t\t\t\t\tclass=\"h-full\" src=\"${image}\"\n\t\t\t\t\talt=\"${frappe.get_abbr(item_name)}\"\n\t\t\t\t\tstyle=\"object-fit: cover;\">`\n\t\t\t);\n\t\t} else {\n\t\t\tthis.$item_image.html(`<div class=\"item-abbr\">${frappe.get_abbr(item_name)}</div>`);\n\t\t}\n\n\t}\n\n\thandle_broken_image($img) {\n\t\tconst item_abbr = $($img).attr('alt');\n\t\t$($img).replaceWith(`<div class=\"item-abbr\">${item_abbr}</div>`);\n\t}\n\n\trender_discount_dom(item) {\n\t\tif (item.discount_percentage) {\n\t\t\tthis.$dicount_section.html(\n\t\t\t\t`<div class=\"item-rate\">${format_currency(item.price_list_rate, this.currency)}</div>\n\t\t\t\t<div class=\"item-discount\">${item.discount_percentage}% off</div>`\n\t\t\t)\n\t\t\tthis.$item_price.html(format_currency(item.rate, this.currency));\n\t\t} else {\n\t\t\tthis.$dicount_section.html(``)\n\t\t}\n\t}\n\n\trender_form(item) {\n\t\tconst fields_to_display = this.get_form_fields(item);\n\t\tthis.$form_container.html('');\n\n\t\tfields_to_display.forEach((fieldname, idx) => {\n\t\t\tthis.$form_container.append(\n\t\t\t\t`<div class=\"${fieldname}-control\" data-fieldname=\"${fieldname}\"></div>`\n\t\t\t)\n\n\t\t\tconst field_meta = this.item_meta.fields.find(df => df.fieldname === fieldname);\n\t\t\tfieldname === 'discount_percentage' ? (field_meta.label = __('Discount (%)')) : '';\n\t\t\tconst me = this;\n\n\t\t\tthis[`${fieldname}_control`] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\t...field_meta,\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tme.events.form_updated(me.current_item, fieldname, this.value);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tparent: this.$form_container.find(`.${fieldname}-control`),\n\t\t\t\trender_input: true,\n\t\t\t})\n\t\t\tthis[`${fieldname}_control`].set_value(item[fieldname]);\n\t\t});\n\n\t\tthis.make_auto_serial_selection_btn(item);\n\n\t\tthis.bind_custom_control_change_event();\n\t}\n\n\tget_form_fields(item) {\n\t\tconst fields = ['qty', 'uom', 'rate', 'conversion_factor', 'discount_percentage', 'warehouse', 'actual_qty', 'price_list_rate'];\n\t\tif (item.has_serial_no) fields.push('serial_no');\n\t\tif (item.has_batch_no) fields.push('batch_no');\n\t\treturn fields;\n\t}\n\n\tmake_auto_serial_selection_btn(item) {\n\t\tif (item.has_serial_no) {\n\t\t\tif (!item.has_batch_no) {\n\t\t\t\tthis.$form_container.append(\n\t\t\t\t\t`<div class=\"grid-filler no-select\"></div>`\n\t\t\t\t);\n\t\t\t}\n\t\t\tconst label = __('Auto Fetch Serial Numbers');\n\t\t\tthis.$form_container.append(\n\t\t\t\t`<div class=\"btn btn-sm btn-secondary auto-fetch-btn\">${label}</div>`\n\t\t\t);\n\t\t\tthis.$form_container.find('.serial_no-control').find('textarea').css('height', '6rem');\n\t\t}\n\t}\n\n\tbind_custom_control_change_event() {\n\t\tconst me = this;\n\t\tif (this.rate_control) {\n\t\t\tthis.rate_control.df.onchange = function() {\n\t\t\t\tif (this.value || flt(this.value) === 0) {\n\t\t\t\t\tme.events.form_updated(me.current_item, 'rate', this.value).then(() => {\n\t\t\t\t\t\tconst item_row = frappe.get_doc(me.doctype, me.name);\n\t\t\t\t\t\tconst doc = me.events.get_frm().doc;\n\t\t\t\t\t\tme.$item_price.html(format_currency(item_row.rate, doc.currency));\n\t\t\t\t\t\tme.render_discount_dom(item_row);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.rate_control.df.read_only = !this.allow_rate_change;\n\t\t\tthis.rate_control.refresh();\n\t\t}\n\n\t\tif (this.discount_percentage_control && !this.allow_discount_change) {\n\t\t\tthis.discount_percentage_control.df.read_only = 1;\n\t\t\tthis.discount_percentage_control.refresh();\n\t\t}\n\n\t\tif (this.warehouse_control) {\n\t\t\tthis.warehouse_control.df.reqd = 1;\n\t\t\tthis.warehouse_control.df.onchange = function() {\n\t\t\t\tif (this.value) {\n\t\t\t\t\tme.events.form_updated(me.current_item, 'warehouse', this.value).then(() => {\n\t\t\t\t\t\tme.item_stock_map = me.events.get_item_stock_map();\n\t\t\t\t\t\tconst available_qty = me.item_stock_map[me.item_row.item_code] && me.item_stock_map[me.item_row.item_code][this.value];\n\t\t\t\t\t\tif (available_qty === undefined) {\n\t\t\t\t\t\t\tme.events.get_available_stock(me.item_row.item_code, this.value).then(() => {\n\t\t\t\t\t\t\t\t// item stock map is updated now reset warehouse\n\t\t\t\t\t\t\t\tme.warehouse_control.set_value(this.value);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t} else if (available_qty === 0) {\n\t\t\t\t\t\t\tme.warehouse_control.set_value('');\n\t\t\t\t\t\t\tconst bold_item_code = me.item_row.item_code.bold();\n\t\t\t\t\t\t\tconst bold_warehouse = this.value.bold();\n\t\t\t\t\t\t\tfrappe.throw(\n\t\t\t\t\t\t\t\t__('Item Code: {0} is not available under warehouse {1}.', [bold_item_code, bold_warehouse])\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tme.actual_qty_control.set_value(available_qty);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.warehouse_control.df.get_query = () => {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: { company: this.events.get_frm().doc.company }\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.warehouse_control.refresh();\n\t\t}\n\n\t\tif (this.serial_no_control) {\n\t\t\tthis.serial_no_control.df.reqd = 1;\n\t\t\tthis.serial_no_control.df.onchange = async function() {\n\t\t\t\t!me.current_item.batch_no && await me.auto_update_batch_no();\n\t\t\t\tme.events.form_updated(me.current_item, 'serial_no', this.value);\n\t\t\t}\n\t\t\tthis.serial_no_control.refresh();\n\t\t}\n\n\t\tif (this.batch_no_control) {\n\t\t\tthis.batch_no_control.df.reqd = 1;\n\t\t\tthis.batch_no_control.df.get_query = () => {\n\t\t\t\treturn {\n\t\t\t\t\tquery: 'erpnext.controllers.queries.get_batch_no',\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\titem_code: me.item_row.item_code,\n\t\t\t\t\t\twarehouse: me.item_row.warehouse,\n\t\t\t\t\t\tposting_date: me.events.get_frm().doc.posting_date\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.batch_no_control.refresh();\n\t\t}\n\n\t\tif (this.uom_control) {\n\t\t\tthis.uom_control.df.onchange = function() {\n\t\t\t\tme.events.form_updated(me.current_item, 'uom', this.value);\n\n\t\t\t\tconst item_row = frappe.get_doc(me.doctype, me.name);\n\t\t\t\tme.conversion_factor_control.df.read_only = (item_row.stock_uom == this.value);\n\t\t\t\tme.conversion_factor_control.refresh();\n\t\t\t}\n\t\t}\n\n\t\tfrappe.model.on(\"POS Invoice Item\", \"*\", (fieldname, value, item_row) => {\n\t\t\tconst field_control = this[`${fieldname}_control`];\n\t\t\tconst item_row_is_being_edited = this.compare_with_current_item(item_row);\n\n\t\t\tif (item_row_is_being_edited && field_control && field_control.get_value() !== value) {\n\t\t\t\tfield_control.set_value(value);\n\t\t\t\tcur_pos.update_cart_html(item_row);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync auto_update_batch_no() {\n\t\tif (this.serial_no_control && this.batch_no_control) {\n\t\t\tconst selected_serial_nos = this.serial_no_control.get_value().split(`\\n`).filter(s => s);\n\t\t\tif (!selected_serial_nos.length) return;\n\n\t\t\t// find batch nos of the selected serial no\n\t\t\tconst serials_with_batch_no = await frappe.db.get_list(\"Serial No\", {\n\t\t\t\tfilters: { 'name': [\"in\", selected_serial_nos]},\n\t\t\t\tfields: [\"batch_no\", \"name\"]\n\t\t\t});\n\t\t\tconst batch_serial_map = serials_with_batch_no.reduce((acc, r) => {\n\t\t\t\tif (!acc[r.batch_no]) {\n\t\t\t\t\tacc[r.batch_no] = [];\n\t\t\t\t}\n\t\t\t\tacc[r.batch_no] = [...acc[r.batch_no], r.name];\n\t\t\t\treturn acc;\n\t\t\t}, {});\n\t\t\t// set current item's batch no and serial no\n\t\t\tconst batch_no = Object.keys(batch_serial_map)[0];\n\t\t\tconst batch_serial_nos = batch_serial_map[batch_no].join(`\\n`);\n\t\t\t// eg. 10 selected serial no. -> 5 belongs to first batch other 5 belongs to second batch\n\t\t\tconst serial_nos_belongs_to_other_batch = selected_serial_nos.length !== batch_serial_map[batch_no].length;\n\n\t\t\tconst current_batch_no = this.batch_no_control.get_value();\n\t\t\tcurrent_batch_no != batch_no && await this.batch_no_control.set_value(batch_no);\n\n\t\t\tif (serial_nos_belongs_to_other_batch) {\n\t\t\t\tthis.serial_no_control.set_value(batch_serial_nos);\n\t\t\t\tthis.qty_control.set_value(batch_serial_map[batch_no].length);\n\n\t\t\t\tdelete batch_serial_map[batch_no];\n\t\t\t\tthis.events.clone_new_batch_item_in_frm(batch_serial_map, this.current_item);\n\t\t\t}\n\t\t}\n\t}\n\n\tbind_events() {\n\t\tthis.bind_auto_serial_fetch_event();\n\t\tthis.bind_fields_to_numpad_fields();\n\n\t\tthis.$component.on('click', '.close-btn', () => {\n\t\t\tthis.events.close_item_details();\n\t\t});\n\t}\n\n\tattach_shortcuts() {\n\t\tthis.wrapper.find('.close-btn').attr(\"title\", \"Esc\");\n\t\tfrappe.ui.keys.on(\"escape\", () => {\n\t\t\tconst item_details_visible = this.$component.is(\":visible\");\n\t\t\tif (item_details_visible) {\n\t\t\t\tthis.events.close_item_details();\n\t\t\t}\n\t\t});\n\t}\n\n\tbind_fields_to_numpad_fields() {\n\t\tconst me = this;\n\t\tthis.$form_container.on('click', '.input-with-feedback', function() {\n\t\t\tconst fieldname = $(this).attr('data-fieldname');\n\t\t\tif (this.last_field_focused != fieldname) {\n\t\t\t\tme.events.item_field_focused(fieldname);\n\t\t\t\tthis.last_field_focused = fieldname;\n\t\t\t}\n\t\t});\n\t}\n\n\tbind_auto_serial_fetch_event() {\n\t\tthis.$form_container.on('click', '.auto-fetch-btn', () => {\n\t\t\tthis.batch_no_control && this.batch_no_control.set_value('');\n\t\t\tlet qty = this.qty_control.get_value();\n\t\t\tlet conversion_factor = this.conversion_factor_control.get_value();\n\t\t\tlet expiry_date = this.item_row.has_batch_no ? this.events.get_frm().doc.posting_date : \"\";\n\n\t\t\tlet numbers = frappe.call({\n\t\t\t\tmethod: \"erpnext.stock.doctype.serial_no.serial_no.auto_fetch_serial_number\",\n\t\t\t\targs: {\n\t\t\t\t\tqty: qty * conversion_factor,\n\t\t\t\t\titem_code: this.current_item.item_code,\n\t\t\t\t\twarehouse: this.warehouse_control.get_value() || '',\n\t\t\t\t\tbatch_nos: this.current_item.batch_no || '',\n\t\t\t\t\tposting_date: expiry_date,\n\t\t\t\t\tfor_doctype: 'POS Invoice'\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tnumbers.then((data) => {\n\t\t\t\tlet auto_fetched_serial_numbers = data.message;\n\t\t\t\tlet records_length = auto_fetched_serial_numbers.length;\n\t\t\t\tif (!records_length) {\n\t\t\t\t\tconst warehouse = this.warehouse_control.get_value().bold();\n\t\t\t\t\tconst item_code = this.current_item.item_code.bold();\n\t\t\t\t\tfrappe.msgprint(\n\t\t\t\t\t\t__('Serial numbers unavailable for Item {0} under warehouse {1}. Please try changing warehouse.', [item_code, warehouse])\n\t\t\t\t\t);\n\t\t\t\t} else if (records_length < qty) {\n\t\t\t\t\tfrappe.msgprint(\n\t\t\t\t\t\t__('Fetched only {0} available serial numbers.', [records_length])\n\t\t\t\t\t);\n\t\t\t\t\tthis.qty_control.set_value(records_length);\n\t\t\t\t}\n\t\t\t\tnumbers = auto_fetched_serial_numbers.join(`\\n`);\n\t\t\t\tthis.serial_no_control.set_value(numbers);\n\t\t\t});\n\t\t})\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') : this.$component.css('display', 'none');\n\t}\n}\n", "erpnext.PointOfSale.ItemDetails = class extends erpnext.PointOfSale.ItemDetails {\n\tasync init_child_components(){\n\t\tthis.$component.html(\n\t\t\t`<div class=\"item-details-header\">\n\t\t\t\t<div class=\"label\">Item Details</div>\n\t\t\t\t<div class=\"close-btn\">\n\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"item-display\">\n\t\t\t\t<div class=\"item-name-desc-price\">\n\t\t\t\t\t<div class=\"item-name\"></div>\n\t\t\t\t\t<div class=\"item-desc\"></div>\n\t\t\t\t\t<div class=\"item-price\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"item-image\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"discount-section\"></div>\n\t\t\t<div class=\"form-container\"></div>\n\t\t\t<div>\n\t\t\t\t<div class=\"btn\" id=\"sendData\" style=\"display: none;\">Get Weight</div>\n\t\t\t</div>`\n\t\t)\n\t\t\n\t\tthis.$item_name = this.$component.find('.item-name');\n\t\tthis.$item_description = this.$component.find('.item-desc');\n\t\tthis.$item_price = this.$component.find('.item-price');\n\t\tthis.$item_image = this.$component.find('.item-image');\n\t\tthis.$form_container = this.$component.find('.form-container');\n\t\tthis.$dicount_section = this.$component.find('.discount-section');\n\t\t\n\t\t//Initialize connection with serial device\n\t\tif(window.enable_weigh_scale == 1){\n\t\t\t//Check if the browser supports serial device connection\n\t\t\twindow.checkPort(false);\n\t\t\tif(typeof(window.mettlerWorker) == \"undefined\"){\n\t\t\t\tvar me = this;\n\t\t\t\twindow.mettlerWorker = new Worker(\"/assets/js/pos-mettler-toledo.min.js\");\n\t\t\t\twindow.mettlerWorker.onmessage = function(e){\n\t\t\t\t\tif(e.data.message == \"No Port\"){\n\t\t\t\t\t\twindow.checkPort(true);\n\t\t\t\t\t}\n\t\t\t\t\telse if(e.data.message == \"weight\" && window.is_item_details_open){\n\t\t\t\t\t\twindow.weight = e.data.weight;\n\t\t\t\t\t\t//Wait for 300ms before changing value as a hack to circumvent a bug(?)\n\t\t\t\t\t\t//where the device sends incorrect weight\n\t\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\t\tme.qty_control.set_value(window.weight);\n\t\t\t\t\t\t}, 300);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\twindow.mettlerWorker.postMessage({\"command\": \"connect\"});\n\t\t\t}\n\t\t\t\n\t\t\tthis.$component.on('click', '#sendData', () => {\n\t\t\t\t//window.sendData();\n\t\t\t});\n\t\t\t//$('#sendData').show();\n\t\t}\n\t}\n\t\n\tasync toggle_item_details_section(item) {\n\t\twindow.is_item_details_open = true;\n\t\tconst current_item_changed = !this.compare_with_current_item(item);\n\n\t\t// if item is null or highlighted cart item is clicked twice\n\t\tconst hide_item_details = !Boolean(item) || !current_item_changed;\n\n\t\tthis.events.toggle_item_selector(!hide_item_details);\n\t\tthis.toggle_component(!hide_item_details);\n\t\t\n\t\tif ((!hide_item_details && current_item_changed) || hide_item_details) {\n\t\t\t// if item details is being closed OR if item details is opened but item is changed\n\t\t\t// in both cases, if the current item is a serialized item, then validate and remove the item\n\t\t\tawait this.validate_serial_batch_item();\n        } \n\n\t\tif (item && current_item_changed) {\n\t\t\tthis.doctype = item.doctype;\n\t\t\tthis.item_meta = frappe.get_meta(this.doctype);\n\t\t\tthis.name = item.name;\n\t\t\tthis.item_row = item;\n\t\t\tthis.currency = this.events.get_frm().doc.currency;\n\n\t\t\tthis.current_item = item;\n\n\t\t\tthis.render_dom(item);\n\t\t\tthis.render_discount_dom(item);\n\t\t\tthis.render_form(item);\n\t\t\tthis.events.highlight_cart_item(item);\n\t\t\t\n\t\t\t//Set initial weight for weigh scale\n\t\t\twindow.old_weight = 0;\t\t\t\n\t\t} else {\n\t\t\tthis.current_item = {};\n\t\t}\n\t\tif(window.enable_weigh_scale == 1){\n\t\t\twindow.mettlerWorker.postMessage({\"command\": \"start\"});\n\t\t}\n\t}\n}\n", "erpnext.PointOfSale.NumberPad = class {\n\tconstructor({ wrapper, events, cols, keys, css_classes, fieldnames_map }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.cols = cols;\n\t\tthis.keys = keys;\n\t\tthis.css_classes = css_classes || [];\n\t\tthis.fieldnames = fieldnames_map || {};\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.bind_events();\n\t}\n\n\tprepare_dom() {\n\t\tconst { cols, keys, css_classes, fieldnames } = this;\n\n\t\tfunction get_keys() {\n\t\t\treturn keys.reduce((a, row, i) => {\n\t\t\t\treturn a + row.reduce((a2, number, j) => {\n\t\t\t\t\tconst class_to_append = css_classes && css_classes[i] ? css_classes[i][j] : '';\n\t\t\t\t\tconst fieldname = fieldnames && fieldnames[number] ?\n\t\t\t\t\t\tfieldnames[number] : typeof number === 'string' ? frappe.scrub(number) : number;\n\n\t\t\t\t\treturn a2 + `<div class=\"numpad-btn ${class_to_append}\" data-button-value=\"${fieldname}\">${__(number)}</div>`;\n\t\t\t\t}, '');\n\t\t\t}, '');\n\t\t}\n\n\t\tthis.wrapper.html(\n\t\t\t`<div class=\"numpad-container\">\n\t\t\t\t${get_keys()}\n\t\t\t</div>`\n\t\t)\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\t\tthis.wrapper.on('click', '.numpad-btn', function() {\n\t\t\tconst $btn = $(this);\n\t\t\tme.events.numpad_event($btn);\n\t\t});\n\t}\n}\n", "/* eslint-disable no-unused-vars */\nerpnext.PointOfSale.Payment = class {\n\tconstructor({ events, wrapper }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.initialize_numpad();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"payment-container\">\n\t\t\t\t<div class=\"section-label payment-section\">${__('Payment Method')}</div>\n\t\t\t\t<div class=\"payment-modes\"></div>\n\t\t\t\t<div class=\"fields-numpad-container\">\n\t\t\t\t\t<div class=\"fields-section\">\n\t\t\t\t\t\t<div class=\"section-label\">${__('Additional Information')}</div>\n\t\t\t\t\t\t<div class=\"invoice-fields\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"number-pad\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"totals-section\">\n\t\t\t\t\t<div class=\"totals\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"submit-order-btn\">${__(\"Complete Order\")}</div>\n\t\t\t</section>`\n\t\t);\n\t\tthis.$component = this.wrapper.find('.payment-container');\n\t\tthis.$payment_modes = this.$component.find('.payment-modes');\n\t\tthis.$totals_section = this.$component.find('.totals-section');\n\t\tthis.$totals = this.$component.find('.totals');\n\t\tthis.$numpad = this.$component.find('.number-pad');\n\t\tthis.$invoice_fields_section = this.$component.find('.fields-section');\n\t}\n\n\tmake_invoice_fields_control() {\n\t\tfrappe.db.get_doc(\"POS Settings\", undefined).then((doc) => {\n\t\t\tconst fields = doc.invoice_fields;\n\t\t\tif (!fields.length) return;\n\n\t\t\tthis.$invoice_fields = this.$invoice_fields_section.find('.invoice-fields');\n\t\t\tthis.$invoice_fields.html('');\n\t\t\tconst frm = this.events.get_frm();\n\n\t\t\tfields.forEach(df => {\n\t\t\t\tthis.$invoice_fields.append(\n\t\t\t\t\t`<div class=\"invoice_detail_field ${df.fieldname}-field\" data-fieldname=\"${df.fieldname}\"></div>`\n\t\t\t\t);\n\t\t\t\tlet df_events = {\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tfrm.set_value(this.df.fieldname, this.get_value());\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tif (df.fieldtype == \"Button\") {\n\t\t\t\t\tdf_events = {\n\t\t\t\t\t\tclick: function() {\n\t\t\t\t\t\t\tif (frm.script_manager.has_handlers(df.fieldname, frm.doc.doctype)) {\n\t\t\t\t\t\t\t\tfrm.script_manager.trigger(df.fieldname, frm.doc.doctype, frm.doc.docname);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tthis[`${df.fieldname}_field`] = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\t...df,\n\t\t\t\t\t\t...df_events\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$invoice_fields.find(`.${df.fieldname}-field`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tthis[`${df.fieldname}_field`].set_value(frm.doc[df.fieldname]);\n\t\t\t});\n\t\t});\n\t}\n\n\tinitialize_numpad() {\n\t\tconst me = this;\n\t\tthis.number_pad = new erpnext.PointOfSale.NumberPad({\n\t\t\twrapper: this.$numpad,\n\t\t\tevents: {\n\t\t\t\tnumpad_event: function($btn) {\n\t\t\t\t\tme.on_numpad_clicked($btn);\n\t\t\t\t}\n\t\t\t},\n\t\t\tcols: 3,\n\t\t\tkeys: [\n\t\t\t\t[ 1, 2, 3 ],\n\t\t\t\t[ 4, 5, 6 ],\n\t\t\t\t[ 7, 8, 9 ],\n\t\t\t\t[ '.', 0, 'Delete' ]\n\t\t\t],\n\t\t});\n\n\t\tthis.numpad_value = '';\n\t}\n\n\ton_numpad_clicked($btn) {\n\t\tconst button_value = $btn.attr('data-button-value');\n\n\t\thighlight_numpad_btn($btn);\n\t\tthis.numpad_value = button_value === 'delete' ? this.numpad_value.slice(0, -1) : this.numpad_value + button_value;\n\t\tthis.selected_mode.$input.get(0).focus();\n\t\tthis.selected_mode.set_value(this.numpad_value);\n\n\t\tfunction highlight_numpad_btn($btn) {\n\t\t\t$btn.addClass('shadow-base-inner bg-selected');\n\t\t\tsetTimeout(() => {\n\t\t\t\t$btn.removeClass('shadow-base-inner bg-selected');\n\t\t\t}, 100);\n\t\t}\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\n\t\tthis.$payment_modes.on('click', '.mode-of-payment', function(e) {\n\t\t\tconst mode_clicked = $(this);\n\t\t\t// if clicked element doesn't have .mode-of-payment class then return\n\t\t\tif (!$(e.target).is(mode_clicked)) return;\n\n\t\t\tconst scrollLeft = mode_clicked.offset().left - me.$payment_modes.offset().left + me.$payment_modes.scrollLeft();\n\t\t\tme.$payment_modes.animate({ scrollLeft });\n\n\t\t\tconst mode = mode_clicked.attr('data-mode');\n\n\t\t\t// hide all control fields and shortcuts\n\t\t\t$(`.mode-of-payment-control`).css('display', 'none');\n\t\t\t$(`.cash-shortcuts`).css('display', 'none');\n\t\t\tme.$payment_modes.find(`.pay-amount`).css('display', 'inline');\n\t\t\tme.$payment_modes.find(`.loyalty-amount-name`).css('display', 'none');\n\n\t\t\t// remove highlight from all mode-of-payments\n\t\t\t$('.mode-of-payment').removeClass('border-primary');\n\n\t\t\tif (mode_clicked.hasClass('border-primary')) {\n\t\t\t\t// clicked one is selected then unselect it\n\t\t\t\tmode_clicked.removeClass('border-primary');\n\t\t\t\tme.selected_mode = '';\n\t\t\t} else {\n\t\t\t\t// clicked one is not selected then select it\n\t\t\t\tmode_clicked.addClass('border-primary');\n\t\t\t\tmode_clicked.find('.mode-of-payment-control').css('display', 'flex');\n\t\t\t\tmode_clicked.find('.cash-shortcuts').css('display', 'grid');\n\t\t\t\tme.$payment_modes.find(`.${mode}-amount`).css('display', 'none');\n\t\t\t\tme.$payment_modes.find(`.${mode}-name`).css('display', 'inline');\n\n\t\t\t\tme.selected_mode = me[`${mode}_control`];\n\t\t\t\tme.selected_mode && me.selected_mode.$input.get(0).focus();\n\t\t\t\tme.auto_set_remaining_amount();\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'contact_mobile', (frm) => {\n\t\t\tconst contact = frm.doc.contact_mobile;\n\t\t\tconst request_button = $(this.request_for_payment_field?.$input[0]);\n\t\t\tif (contact) {\n\t\t\t\trequest_button.removeClass('btn-default').addClass('btn-primary');\n\t\t\t} else {\n\t\t\t\trequest_button.removeClass('btn-primary').addClass('btn-default');\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'coupon_code', (frm) => {\n\t\t\tif (frm.doc.coupon_code && !frm.applying_pos_coupon_code) {\n\t\t\t\tif (!frm.doc.ignore_pricing_rule) {\n\t\t\t\t\tfrm.applying_pos_coupon_code = true;\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => frm.doc.ignore_pricing_rule=1,\n\t\t\t\t\t\t() => frm.trigger('ignore_pricing_rule'),\n\t\t\t\t\t\t() => frm.doc.ignore_pricing_rule=0,\n\t\t\t\t\t\t() => frm.trigger('apply_pricing_rule'),\n\t\t\t\t\t\t() => frm.save(),\n\t\t\t\t\t\t() => this.update_totals_section(frm.doc),\n\t\t\t\t\t\t() => (frm.applying_pos_coupon_code = false)\n\t\t\t\t\t]);\n\t\t\t\t} else if (frm.doc.ignore_pricing_rule) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"Ignore Pricing Rule is enabled. Cannot apply coupon code.\"),\n\t\t\t\t\t\tindicator: \"orange\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.setup_listener_for_payments();\n\n\t\tthis.$payment_modes.on('click', '.shortcut', function() {\n\t\t\tconst value = $(this).attr('data-value');\n\t\t\tme.selected_mode.set_value(value);\n\t\t});\n\n\t\tthis.$component.on('click', '.submit-order-btn', () => {\n\t\t\tconst doc = this.events.get_frm().doc;\n\t\t\tconst paid_amount = doc.paid_amount;\n\t\t\tconst items = doc.items;\n\n\t\t\tif (paid_amount == 0 || !items.length) {\n\t\t\t\tconst message = items.length ? __(\"You cannot submit the order without payment.\") : __(\"You cannot submit empty order.\");\n\t\t\t\tfrappe.show_alert({ message, indicator: \"orange\" });\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.events.submit_invoice();\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'paid_amount', (frm) => {\n\t\t\tthis.update_totals_section(frm.doc);\n\n\t\t\t// need to re calculate cash shortcuts after discount is applied\n\t\t\tconst is_cash_shortcuts_invisible = !this.$payment_modes.find('.cash-shortcuts').is(':visible');\n\t\t\tthis.attach_cash_shortcuts(frm.doc);\n\t\t\t!is_cash_shortcuts_invisible && this.$payment_modes.find('.cash-shortcuts').css('display', 'grid');\n\t\t\tthis.render_payment_mode_dom();\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'loyalty_amount', (frm) => {\n\t\t\tconst formatted_currency = format_currency(frm.doc.loyalty_amount, frm.doc.currency);\n\t\t\tthis.$payment_modes.find(`.loyalty-amount-amount`).html(formatted_currency);\n\t\t});\n\n\t\tfrappe.ui.form.on(\"Sales Invoice Payment\", \"amount\", (frm, cdt, cdn) => {\n\t\t\t// for setting correct amount after loyalty points are redeemed\n\t\t\tconst default_mop = locals[cdt][cdn];\n\t\t\tconst mode = default_mop.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\tif (this[`${mode}_control`] && this[`${mode}_control`].get_value() != default_mop.amount) {\n\t\t\t\tthis[`${mode}_control`].set_value(default_mop.amount);\n\t\t\t}\n\t\t});\n\t}\n\n\tsetup_listener_for_payments() {\n\t\tfrappe.realtime.on(\"process_phone_payment\", (data) => {\n\t\t\tconst doc = this.events.get_frm().doc;\n\t\t\tconst { response, amount, success, failure_message } = data;\n\t\t\tlet message, title;\n\n\t\t\tif (success) {\n\t\t\t\ttitle = __(\"Payment Received\");\n\t\t\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? doc.grand_total : doc.rounded_total;\n\t\t\t\tif (amount >= grand_total) {\n\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t\tmessage = __(\"Payment of {0} received successfully.\", [format_currency(amount, doc.currency, 0)]);\n\t\t\t\t\tthis.events.submit_invoice();\n\t\t\t\t\tcur_frm.reload_doc();\n\n\t\t\t\t} else {\n\t\t\t\t\tmessage = __(\"Payment of {0} received successfully. Waiting for other requests to complete...\", [format_currency(amount, doc.currency, 0)]);\n\t\t\t\t}\n\t\t\t} else if (failure_message) {\n\t\t\t\tmessage = failure_message;\n\t\t\t\ttitle = __(\"Payment Failed\");\n\t\t\t}\n\n\t\t\tfrappe.msgprint({ \"message\": message, \"title\": title });\n\t\t});\n\t}\n\n\tauto_set_remaining_amount() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? doc.grand_total : doc.rounded_total;\n\t\tconst remaining_amount = grand_total - doc.paid_amount;\n\t\tconst current_value = this.selected_mode ? this.selected_mode.get_value() : undefined;\n\t\tif (!current_value && remaining_amount > 0 && this.selected_mode) {\n\t\t\tthis.selected_mode.set_value(remaining_amount);\n\t\t}\n\t}\n\n\tattach_shortcuts() {\n\t\tconst ctrl_label = frappe.utils.is_mac() ? '\u2318' : 'Ctrl';\n\t\tthis.$component.find('.submit-order-btn').attr(\"title\", `${ctrl_label}+Enter`);\n\t\tfrappe.ui.keys.on(\"ctrl+enter\", () => {\n\t\t\tconst payment_is_visible = this.$component.is(\":visible\");\n\t\t\tconst active_mode = this.$payment_modes.find(\".border-primary\");\n\t\t\tif (payment_is_visible && active_mode.length) {\n\t\t\t\tthis.$component.find('.submit-order-btn').click();\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"tab\",\n\t\t\taction: () => {\n\t\t\t\tconst payment_is_visible = this.$component.is(\":visible\");\n\t\t\t\tlet active_mode = this.$payment_modes.find(\".border-primary\");\n\t\t\t\tactive_mode = active_mode.length ? active_mode.attr(\"data-mode\") : undefined;\n\n\t\t\t\tif (!active_mode) return;\n\n\t\t\t\tconst mode_of_payments = Array.from(this.$payment_modes.find(\".mode-of-payment\")).map(m => $(m).attr(\"data-mode\"));\n\t\t\t\tconst mode_index = mode_of_payments.indexOf(active_mode);\n\t\t\t\tconst next_mode_index = (mode_index + 1) % mode_of_payments.length;\n\t\t\t\tconst next_mode_to_be_clicked = this.$payment_modes.find(`.mode-of-payment[data-mode=\"${mode_of_payments[next_mode_index]}\"]`);\n\n\t\t\t\tif (payment_is_visible && mode_index != next_mode_index) {\n\t\t\t\t\tnext_mode_to_be_clicked.click();\n\t\t\t\t}\n\t\t\t},\n\t\t\tcondition: () => this.$component.is(':visible') && this.$payment_modes.find(\".border-primary\").length,\n\t\t\tdescription: __(\"Switch Between Payment Modes\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t}\n\n\ttoggle_numpad() {\n\t\t// pass\n\t}\n\n\trender_payment_section() {\n\t\tthis.render_payment_mode_dom();\n\t\tthis.make_invoice_fields_control();\n\t\tthis.update_totals_section();\n\t\tthis.focus_on_default_mop();\n\t}\n\n\tedit_cart() {\n\t\tthis.events.toggle_other_sections(false);\n\t\tthis.toggle_component(false);\n\t}\n\n\tcheckout() {\n\t\tthis.events.toggle_other_sections(true);\n\t\tthis.toggle_component(true);\n\n\t\tthis.render_payment_section();\n\t}\n\n\ttoggle_remarks_control() {\n\t\tif (this.$remarks.find('.frappe-control').length) {\n\t\t\tthis.$remarks.html('+ Add Remark');\n\t\t} else {\n\t\t\tthis.$remarks.html('');\n\t\t\tthis[`remark_control`] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: __('Remark'),\n\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\tonchange: function() {}\n\t\t\t\t},\n\t\t\t\tparent: this.$totals_section.find(`.remarks`),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t\tthis[`remark_control`].set_value('');\n\t\t}\n\t}\n\n\trender_payment_mode_dom() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst payments = doc.payments;\n\t\tconst currency = doc.currency;\n\n\t\tthis.$payment_modes.html(`${\n\t\t\tpayments.map((p, i) => {\n\t\t\t\tconst mode = p.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\t\tconst payment_type = p.type;\n\t\t\t\tconst margin = i % 2 === 0 ? 'pr-2' : 'pl-2';\n\t\t\t\tconst amount = p.amount > 0 ? format_currency(p.amount, currency) : '';\n\n\t\t\t\treturn (`\n\t\t\t\t\t<div class=\"payment-mode-wrapper\">\n\t\t\t\t\t\t<div class=\"mode-of-payment\" data-mode=\"${mode}\" data-payment-type=\"${payment_type}\">\n\t\t\t\t\t\t\t${p.mode_of_payment}\n\t\t\t\t\t\t\t<div class=\"${mode}-amount pay-amount\">${amount}</div>\n\t\t\t\t\t\t\t<div class=\"${mode} mode-of-payment-control\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`);\n\t\t\t}).join('')\n\t\t}`);\n\n\t\tpayments.forEach(p => {\n\t\t\tconst mode = p.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\tconst me = this;\n\t\t\tthis[`${mode}_control`] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: p.mode_of_payment,\n\t\t\t\t\tfieldtype: 'Currency',\n\t\t\t\t\tplaceholder: __('Enter {0} amount.', [p.mode_of_payment]),\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tconst current_value = frappe.model.get_value(p.doctype, p.name, 'amount');\n\t\t\t\t\t\tif (current_value != this.value) {\n\t\t\t\t\t\t\tfrappe.model\n\t\t\t\t\t\t\t\t.set_value(p.doctype, p.name, 'amount', flt(this.value))\n\t\t\t\t\t\t\t\t.then(() => me.update_totals_section())\n\n\t\t\t\t\t\t\tconst formatted_currency = format_currency(this.value, currency);\n\t\t\t\t\t\t\tme.$payment_modes.find(`.${mode}-amount`).html(formatted_currency);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tparent: this.$payment_modes.find(`.${mode}.mode-of-payment-control`),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t\tthis[`${mode}_control`].toggle_label(false);\n\t\t\tthis[`${mode}_control`].set_value(p.amount);\n\t\t});\n\n\t\tthis.render_loyalty_points_payment_mode();\n\n\t\tthis.attach_cash_shortcuts(doc);\n\t}\n\n\tfocus_on_default_mop() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst payments = doc.payments;\n\t\tpayments.forEach(p => {\n\t\t\tconst mode = p.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\tif (p.default) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.$payment_modes.find(`.${mode}.mode-of-payment-control`).parent().click();\n\t\t\t\t}, 500);\n\t\t\t}\n\t\t});\n\t}\n\n\tattach_cash_shortcuts(doc) {\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? doc.grand_total : doc.rounded_total;\n\t\tconst currency = doc.currency;\n\n\t\tconst shortcuts = this.get_cash_shortcuts(flt(grand_total));\n\n\t\tthis.$payment_modes.find('.cash-shortcuts').remove();\n\t\tlet shortcuts_html = shortcuts.map(s => {\n\t\t\treturn `<div class=\"shortcut\" data-value=\"${s}\">${format_currency(s, currency, 0)}</div>`;\n\t\t}).join('');\n\n\t\tthis.$payment_modes.find('[data-payment-type=\"Cash\"]').find('.mode-of-payment-control')\n\t\t\t.after(`<div class=\"cash-shortcuts\">${shortcuts_html}</div>`);\n\t}\n\n\tget_cash_shortcuts(grand_total) {\n\t\tlet steps = [1, 5, 10];\n\t\tconst digits = String(Math.round(grand_total)).length;\n\n\t\tsteps = steps.map(x => x * (10 ** (digits - 2)));\n\n\t\tconst get_nearest = (amount, x) => {\n\t\t\tlet nearest_x = Math.ceil((amount / x)) * x;\n\t\t\treturn nearest_x === amount ? nearest_x + x : nearest_x;\n\t\t};\n\n\t\treturn steps.reduce((finalArr, x) => {\n\t\t\tlet nearest_x = get_nearest(grand_total, x);\n\t\t\tnearest_x = finalArr.indexOf(nearest_x) != -1 ? nearest_x + x : nearest_x;\n\t\t\treturn [...finalArr, nearest_x];\n\t\t}, []);\n\t}\n\n\trender_loyalty_points_payment_mode() {\n\t\tconst me = this;\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst { loyalty_program, loyalty_points, conversion_factor } = this.events.get_customer_details();\n\n\t\tthis.$payment_modes.find(`.mode-of-payment[data-mode=\"loyalty-amount\"]`).parent().remove();\n\n\t\tif (!loyalty_program) return;\n\n\t\tlet description, read_only, max_redeemable_amount;\n\t\tif (!loyalty_points) {\n\t\t\tdescription = __(\"You don't have enough points to redeem.\");\n\t\t\tread_only = true;\n\t\t} else {\n\t\t\tmax_redeemable_amount = flt(flt(loyalty_points) * flt(conversion_factor), precision(\"loyalty_amount\", doc));\n\t\t\tdescription = __(\"You can redeem upto {0}.\", [format_currency(max_redeemable_amount)]);\n\t\t\tread_only = false;\n\t\t}\n\n\t\tconst margin = this.$payment_modes.children().length % 2 === 0 ? 'pr-2' : 'pl-2';\n\t\tconst amount = doc.loyalty_amount > 0 ? format_currency(doc.loyalty_amount, doc.currency) : '';\n\t\tthis.$payment_modes.append(\n\t\t\t`<div class=\"payment-mode-wrapper\">\n\t\t\t\t<div class=\"mode-of-payment loyalty-card\" data-mode=\"loyalty-amount\" data-payment-type=\"loyalty-amount\">\n\t\t\t\t\tRedeem Loyalty Points\n\t\t\t\t\t<div class=\"loyalty-amount-amount pay-amount\">${amount}</div>\n\t\t\t\t\t<div class=\"loyalty-amount-name\">${loyalty_program}</div>\n\t\t\t\t\t<div class=\"loyalty-amount mode-of-payment-control\"></div>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t);\n\n\t\tthis['loyalty-amount_control'] = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __(\"Redeem Loyalty Points\"),\n\t\t\t\tfieldtype: 'Currency',\n\t\t\t\tplaceholder: __(\"Enter amount to be redeemed.\"),\n\t\t\t\toptions: 'company:currency',\n\t\t\t\tread_only,\n\t\t\t\tonchange: async function() {\n\t\t\t\t\tif (!loyalty_points) return;\n\n\t\t\t\t\tif (this.value > max_redeemable_amount) {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"You cannot redeem more than {0}.\", [format_currency(max_redeemable_amount)]),\n\t\t\t\t\t\t\tindicator: \"red\"\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t\t\tme['loyalty-amount_control'].set_value(0);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst redeem_loyalty_points = this.value > 0 ? 1 : 0;\n\t\t\t\t\tawait frappe.model.set_value(doc.doctype, doc.name, 'redeem_loyalty_points', redeem_loyalty_points);\n\t\t\t\t\tfrappe.model.set_value(doc.doctype, doc.name, 'loyalty_points', parseInt(this.value / conversion_factor));\n\t\t\t\t},\n\t\t\t\tdescription\n\t\t\t},\n\t\t\tparent: this.$payment_modes.find(`.loyalty-amount.mode-of-payment-control`),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis['loyalty-amount_control'].toggle_label(false);\n\n\t\t// this.render_add_payment_method_dom();\n\t}\n\n\trender_add_payment_method_dom() {\n\t\tconst docstatus = this.events.get_frm().doc.docstatus;\n\t\tif (docstatus === 0)\n\t\t\tthis.$payment_modes.append(\n\t\t\t\t`<div class=\"w-full pr-2\">\n\t\t\t\t\t<div class=\"add-mode-of-payment w-half text-grey mb-4 no-select pointer\">+ Add Payment Method</div>\n\t\t\t\t</div>`\n\t\t\t);\n\t}\n\n\tupdate_totals_section(doc) {\n\t\tif (!doc) doc = this.events.get_frm().doc;\n\t\tconst paid_amount = doc.paid_amount;\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? doc.grand_total : doc.rounded_total;\n\t\tconst remaining = grand_total - doc.paid_amount;\n\t\tconst change = doc.change_amount || remaining <= 0 ? -1 * remaining : undefined;\n\t\tconst currency = doc.currency;\n\t\tconst label = change ? __('Change') : __('To Be Paid');\n\n\t\tthis.$totals.html(\n\t\t\t`<div class=\"col\">\n\t\t\t\t<div class=\"total-label\">${__('Grand Total')}</div>\n\t\t\t\t<div class=\"value\">${format_currency(grand_total, currency)}</div>\n\t\t\t</div>\n\t\t\t<div class=\"seperator-y\"></div>\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"total-label\">${__('Paid Amount')}</div>\n\t\t\t\t<div class=\"value\">${format_currency(paid_amount, currency)}</div>\n\t\t\t</div>\n\t\t\t<div class=\"seperator-y\"></div>\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"total-label\">${label}</div>\n\t\t\t\t<div class=\"value\">${format_currency(change || remaining, currency)}</div>\n\t\t\t</div>`\n\t\t);\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') : this.$component.css('display', 'none');\n\t}\n};\n", "erpnext.PointOfSale.Payment = class extends erpnext.PointOfSale.Payment {\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"payment-container\">\n\t\t\t\t<div class=\"section-label payment-section\">Payment Method</div>\n\t\t\t\t<div class=\"payment-modes\"></div>\n\t\t\t\t<div class=\"fields-numpad-container\">\n\t\t\t\t\t<div class=\"fields-section\">\n\t\t\t\t\t\t<div class=\"section-label\">Additional Information</div>\n\t\t\t\t\t\t<div class=\"invoice-fields\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"number-pad\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"totals-section\">\n\t\t\t\t\t<div class=\"totals\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"submit-order-btn\">Complete Order</div>\n\t\t\t</section>`\n\t\t);\n\t\tthis.$component = this.wrapper.find('.payment-container');\n\t\tthis.$payment_modes = this.$component.find('.payment-modes');\n\t\tthis.$totals_section = this.$component.find('.totals-section');\n\t\tthis.$totals = this.$component.find('.totals');\n\t\tthis.$numpad = this.$component.find('.number-pad');\n\t\tthis.$invoice_fields_section = this.$component.find('.fields-section');\n\t}\n\t\n\tmake_invoice_fields_control() {\n\t\tfrappe.db.get_doc(\"POS Settings\", undefined).then((doc) => {\n\t\t\tconst fields = doc.invoice_fields;\n\t\t\tif (!fields.length) return;\n\n\t\t\tthis.$invoice_fields = this.$invoice_fields_section.find('.invoice-fields');\n\t\t\tthis.$invoice_fields.html('');\n\t\t\tconst frm = this.events.get_frm();\n\n\t\t\tfields.forEach(df => {\n\t\t\t\tthis.$invoice_fields.append(\n\t\t\t\t\t`<div class=\"invoice_detail_field ${df.fieldname}-field\" data-fieldname=\"${df.fieldname}\"></div>`\n\t\t\t\t);\n\t\t\t\tlet df_events = {\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tfrm.set_value(this.df.fieldname, this.get_value());\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tif (df.fieldtype == \"Button\") {\n\t\t\t\t\tdf_events = {\n\t\t\t\t\t\tclick: function() {\n\t\t\t\t\t\t\tif (frm.script_manager.has_handlers(df.fieldname, frm.doc.doctype)) {\n\t\t\t\t\t\t\t\tfrm.script_manager.trigger(df.fieldname, frm.doc.doctype, frm.doc.docname);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tthis[`${df.fieldname}_field`] = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\t...df,\n\t\t\t\t\t\t...df_events\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$invoice_fields.find(`.${df.fieldname}-field`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tthis[`${df.fieldname}_field`].set_value(frm.doc[df.fieldname]);\n\t\t\t});\n\t\t});\n\t\t\n\t\t//For raw printing buttons\n\t\tif(window.enable_raw_print == 1){\n\t\t\tthis.$invoice_fields_section.find('.invoice-fields').append(\n\t\t\t\t`<div style=\"position: absolute; bottom: 0; width: 100%; margin-bottom: 10px;\" class=\"summary-btn btn btn-default cash-drawer-btn\">\n\t\t\t\t\tOpen Cash Drawer\n\t\t\t\t</div>`\n\t\t\t);\n\t\t}\n\t}\n\t\n\tbind_events() {\n\t\tconst me = this;\n\n\t\tthis.$payment_modes.on('click', '.mode-of-payment', function(e) {\n\t\t\tconst mode_clicked = $(this);\n\t\t\t// if clicked element doesn't have .mode-of-payment class then return\n\t\t\tif (!$(e.target).is(mode_clicked)) return;\n\n\t\t\tconst scrollLeft = mode_clicked.offset().left - me.$payment_modes.offset().left + me.$payment_modes.scrollLeft();\n\t\t\tme.$payment_modes.animate({ scrollLeft });\n\n\t\t\tconst mode = mode_clicked.attr('data-mode');\n\n\t\t\t// hide all control fields and shortcuts\n\t\t\t$(`.mode-of-payment-control`).css('display', 'none');\n\t\t\t$(`.cash-shortcuts`).css('display', 'none');\n\t\t\tme.$payment_modes.find(`.pay-amount`).css('display', 'inline');\n\t\t\tme.$payment_modes.find(`.loyalty-amount-name`).css('display', 'none');\n\n\t\t\t// remove highlight from all mode-of-payments\n\t\t\t$('.mode-of-payment').removeClass('border-primary');\n\n\t\t\tif (mode_clicked.hasClass('border-primary')) {\n\t\t\t\t// clicked one is selected then unselect it\n\t\t\t\tmode_clicked.removeClass('border-primary');\n\t\t\t\tme.selected_mode = '';\n\t\t\t} else {\n\t\t\t\t// clicked one is not selected then select it\n\t\t\t\tmode_clicked.addClass('border-primary');\n\t\t\t\tmode_clicked.find('.mode-of-payment-control').css('display', 'flex');\n\t\t\t\tmode_clicked.find('.cash-shortcuts').css('display', 'grid');\n\t\t\t\tme.$payment_modes.find(`.${mode}-amount`).css('display', 'none');\n\t\t\t\tme.$payment_modes.find(`.${mode}-name`).css('display', 'inline');\n\n\t\t\t\tme.selected_mode = me[`${mode}_control`];\n\t\t\t\tme.selected_mode && me.selected_mode.$input.get(0).focus();\n\t\t\t\tme.auto_set_remaining_amount();\n\t\t\t}\n\t\t});\n\t\t\n\t\tfrappe.ui.form.on('POS Invoice', 'contact_mobile', (frm) => {\n\t\t\tconst contact = frm.doc.contact_mobile;\n\t\t\tconst request_button = $(this.request_for_payment_field.$input[0]);\n\t\t\tif (contact) {\n\t\t\t\trequest_button.removeClass('btn-default').addClass('btn-primary');\n\t\t\t} else {\n\t\t\t\trequest_button.removeClass('btn-primary').addClass('btn-default');\n\t\t\t}\n\t\t});\n\t\t\n\t\tfrappe.ui.form.on('POS Invoice', 'coupon_code', (frm) => {\n\t\t\tif (frm.doc.coupon_code && !frm.applying_pos_coupon_code) {\n\t\t\t\tif (!frm.doc.ignore_pricing_rule) {\n\t\t\t\t\tfrm.applying_pos_coupon_code = true;\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => frm.doc.ignore_pricing_rule=1,\n\t\t\t\t\t\t() => frm.trigger('ignore_pricing_rule'),\n\t\t\t\t\t\t() => frm.doc.ignore_pricing_rule=0,\n\t\t\t\t\t\t() => frm.trigger('apply_pricing_rule'),\n\t\t\t\t\t\t() => frm.save(),\n\t\t\t\t\t\t() => this.update_totals_section(frm.doc),\n\t\t\t\t\t\t() => (frm.applying_pos_coupon_code = false)\n\t\t\t\t\t]);\n\t\t\t\t} else if (frm.doc.ignore_pricing_rule) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"Ignore Pricing Rule is enabled. Cannot apply coupon code.\"),\n\t\t\t\t\t\tindicator: \"orange\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.setup_listener_for_payments();\n\n\t\tthis.$payment_modes.on('click', '.shortcut', function() {\n\t\t\tconst value = $(this).attr('data-value');\n\t\t\tme.selected_mode.set_value(value);\n\t\t});\n\n\t\tthis.$component.on('click', '.submit-order-btn', () => {\n\t\t\tconst doc = this.events.get_frm().doc;\n\t\t\tconst paid_amount = doc.paid_amount;\n\t\t\tconst items = doc.items;\n\n\t\t\tif (paid_amount == 0 || !items.length) {\n\t\t\t\tconst message = items.length ? __(\"You cannot submit the order without payment.\") : __(\"You cannot submit empty order.\");\n\t\t\t\tfrappe.show_alert({ message, indicator: \"orange\" });\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.events.submit_invoice();\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'paid_amount', (frm) => {\n\t\t\tthis.update_totals_section(frm.doc);\n\n\t\t\t// need to re calculate cash shortcuts after discount is applied\n\t\t\tconst is_cash_shortcuts_invisible = !this.$payment_modes.find('.cash-shortcuts').is(':visible');\n\t\t\tthis.attach_cash_shortcuts(frm.doc);\n\t\t\t!is_cash_shortcuts_invisible && this.$payment_modes.find('.cash-shortcuts').css('display', 'grid');\n\t\t\tthis.render_payment_mode_dom();\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'loyalty_amount', (frm) => {\n\t\t\tconst formatted_currency = format_currency(frm.doc.loyalty_amount, frm.doc.currency);\n\t\t\tthis.$payment_modes.find(`.loyalty-amount-amount`).html(formatted_currency);\n\t\t});\n\n\t\tfrappe.ui.form.on(\"Sales Invoice Payment\", \"amount\", (frm, cdt, cdn) => {\n\t\t\t// for setting correct amount after loyalty points are redeemed\n\t\t\tconst default_mop = locals[cdt][cdn];\n\t\t\tconst mode = default_mop.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\tif (this[`${mode}_control`] && this[`${mode}_control`].get_value() != default_mop.amount) {\n\t\t\t\tthis[`${mode}_control`].set_value(default_mop.amount);\n\t\t\t}\n\t\t});\n\t\t//For raw printing buttons\n\t\tthis.$component.on('click', '.cash-drawer-btn', () => {\n\t\t\tthis.events.open_cash_drawer();\n\t\t});\n\t}\n\t\n\tcheckout() {\n\t\tthis.events.toggle_other_sections(true);\n\t\tthis.toggle_component(true);\n\n\t\tthis.render_payment_section();\n\t\t\n\t\t//For weigh scale\n\t\tif(window.enable_weigh_scale == 1){\n\t\t\tif(typeof(window.mettlerWorker) != \"undefined\"){\n\t\t\t\twindow.mettlerWorker.postMessage({\"command\": \"stop\"});\n\t\t\t}\n\t\t}\n\t}\n}\n", "erpnext.PointOfSale.PastOrderList = class {\n\tconstructor({ wrapper, events }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.make_filter_section();\n\t\tthis.bind_events();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"past-order-list\">\n\t\t\t\t<div class=\"filter-section\">\n\t\t\t\t\t<div class=\"label\">${__('Recent Orders')}</div>\n\t\t\t\t\t<div class=\"search-field\"></div>\n\t\t\t\t\t<div class=\"status-field\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoices-container\"></div>\n\t\t\t</section>`\n\t\t);\n\n\t\tthis.$component = this.wrapper.find('.past-order-list');\n\t\tthis.$invoices_container = this.$component.find('.invoices-container');\n\t}\n\n\tbind_events() {\n\t\tthis.search_field.$input.on('input', (e) => {\n\t\t\tclearTimeout(this.last_search);\n\t\t\tthis.last_search = setTimeout(() => {\n\t\t\t\tconst search_term = e.target.value;\n\t\t\t\tthis.refresh_list(search_term, this.status_field.get_value());\n\t\t\t}, 300);\n\t\t});\n\t\tconst me = this;\n\t\tthis.$invoices_container.on('click', '.invoice-wrapper', function() {\n\t\t\tconst invoice_name = unescape($(this).attr('data-invoice-name'));\n\n\t\t\tme.events.open_invoice_data(invoice_name);\n\t\t});\n\t}\n\n\tmake_filter_section() {\n\t\tconst me = this;\n\t\tthis.search_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Search'),\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tplaceholder: __('Search by invoice id or customer name')\n\t\t\t},\n\t\t\tparent: this.$component.find('.search-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.status_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Invoice Status'),\n\t\t\t\tfieldtype: 'Select',\n\t\t\t\toptions: `Draft\\nPaid\\nConsolidated\\nReturn`,\n\t\t\t\tplaceholder: __('Filter by invoice status'),\n\t\t\t\tonchange: function() {\n\t\t\t\t\tif (me.$component.is(':visible')) me.refresh_list();\n\t\t\t\t}\n\t\t\t},\n\t\t\tparent: this.$component.find('.status-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.search_field.toggle_label(false);\n\t\tthis.status_field.toggle_label(false);\n\t\tthis.status_field.set_value('Draft');\n\t}\n\n\trefresh_list() {\n\t\tfrappe.dom.freeze();\n\t\tthis.events.reset_summary();\n\t\tconst search_term = this.search_field.get_value();\n\t\tconst status = this.status_field.get_value();\n\n\t\tthis.$invoices_container.html('');\n\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.selling.page.point_of_sale.point_of_sale.get_past_order_list\",\n\t\t\tfreeze: true,\n\t\t\targs: { search_term, status },\n\t\t\tcallback: (response) => {\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\tresponse.message.forEach(invoice => {\n\t\t\t\t\tconst invoice_html = this.get_invoice_html(invoice);\n\t\t\t\t\tthis.$invoices_container.append(invoice_html);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tget_invoice_html(invoice) {\n\t\tconst posting_datetime = moment(invoice.posting_date+\" \"+invoice.posting_time).format(\"Do MMMM, h:mma\");\n\t\treturn (\n\t\t\t`<div class=\"invoice-wrapper\" data-invoice-name=\"${escape(invoice.name)}\">\n\t\t\t\t<div class=\"invoice-name-date\">\n\t\t\t\t\t<div class=\"invoice-name\">${invoice.name}</div>\n\t\t\t\t\t<div class=\"invoice-date\">\n\t\t\t\t\t\t<svg class=\"mr-2\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n\t\t\t\t\t\t\t<path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"/><circle cx=\"12\" cy=\"7\" r=\"4\"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t${frappe.ellipsis(invoice.customer, 20)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoice-total-status\">\n\t\t\t\t\t<div class=\"invoice-total\">${format_currency(invoice.grand_total, invoice.currency, 0) || 0}</div>\n\t\t\t\t\t<div class=\"invoice-date\">${posting_datetime}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"seperator\"></div>`\n\t\t);\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') && this.refresh_list() : this.$component.css('display', 'none');\n\t}\n};\n", "erpnext.PointOfSale.PastOrderSummary = class {\n\tconstructor({ wrapper, events }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.init_email_print_dialog();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"past-order-summary\">\n\t\t\t\t<div class=\"no-summary-placeholder\">\n\t\t\t\t\t${__('Select an invoice to load summary data')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoice-summary-wrapper\">\n\t\t\t\t\t<div class=\"abs-container\">\n\t\t\t\t\t\t<div class=\"upper-section\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__('Items')}</div>\n\t\t\t\t\t\t<div class=\"items-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__('Totals')}</div>\n\t\t\t\t\t\t<div class=\"totals-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__('Payments')}</div>\n\t\t\t\t\t\t<div class=\"payments-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"summary-btns\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</section>`\n\t\t);\n\n\t\tthis.$component = this.wrapper.find('.past-order-summary');\n\t\tthis.$summary_wrapper = this.$component.find('.invoice-summary-wrapper');\n\t\tthis.$summary_container = this.$component.find('.abs-container');\n\t\tthis.$upper_section = this.$summary_container.find('.upper-section');\n\t\tthis.$items_container = this.$summary_container.find('.items-container');\n\t\tthis.$totals_container = this.$summary_container.find('.totals-container');\n\t\tthis.$payment_container = this.$summary_container.find('.payments-container');\n\t\tthis.$summary_btns = this.$summary_container.find('.summary-btns');\n\t}\n\n\tinit_email_print_dialog() {\n\t\tconst email_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Email Receipt',\n\t\t\tfields: [\n\t\t\t\t{fieldname: 'email_id', fieldtype: 'Data', options: 'Email', label: 'Email ID'},\n\t\t\t\t// {fieldname:'remarks', fieldtype:'Text', label:'Remarks (if any)'}\n\t\t\t],\n\t\t\tprimary_action: () => {\n\t\t\t\tthis.send_email();\n\t\t\t},\n\t\t\tprimary_action_label: __('Send'),\n\t\t});\n\t\tthis.email_dialog = email_dialog;\n\n\t\tconst print_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Print Receipt',\n\t\t\tfields: [\n\t\t\t\t{fieldname: 'print', fieldtype: 'Data', label: 'Print Preview'}\n\t\t\t],\n\t\t\tprimary_action: () => {\n\t\t\t\tthis.print_receipt();\n\t\t\t},\n\t\t\tprimary_action_label: __('Print'),\n\t\t});\n\t\tthis.print_dialog = print_dialog;\n\t}\n\n\tget_upper_section_html(doc) {\n\t\tconst { status } = doc;\n\t\tlet indicator_color = '';\n\n\t\tin_list(['Paid', 'Consolidated'], status) && (indicator_color = 'green');\n\t\tstatus === 'Draft' && (indicator_color = 'red');\n\t\tstatus === 'Return' && (indicator_color = 'grey');\n\n\t\treturn `<div class=\"left-section\">\n\t\t\t\t\t<div class=\"customer-name\">${doc.customer}</div>\n\t\t\t\t\t<div class=\"customer-email\">${this.customer_email}</div>\n\t\t\t\t\t<div class=\"cashier\">${__('Sold by')}: ${doc.owner}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"right-section\">\n\t\t\t\t\t<div class=\"paid-amount\">${format_currency(doc.paid_amount, doc.currency)}</div>\n\t\t\t\t\t<div class=\"invoice-name\">${doc.name}</div>\n\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color}\"><span>${doc.status}</span></span>\n\t\t\t\t</div>`;\n\t}\n\n\tget_item_html(doc, item_data) {\n\t\treturn `<div class=\"item-row-wrapper\">\n\t\t\t\t\t<div class=\"item-name\">${item_data.item_name}</div>\n\t\t\t\t\t<div class=\"item-qty\">${item_data.qty || 0}</div>\n\t\t\t\t\t<div class=\"item-rate-disc\">${get_rate_discount_html()}</div>\n\t\t\t\t</div>`;\n\n\t\tfunction get_rate_discount_html() {\n\t\t\tif (item_data.rate && item_data.price_list_rate && item_data.rate !== item_data.price_list_rate) {\n\t\t\t\treturn `<span class=\"item-disc\">(${item_data.discount_percentage}% off)</span>\n\t\t\t\t\t\t<div class=\"item-rate\">${format_currency(item_data.rate, doc.currency)}</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"item-rate\">${format_currency(item_data.price_list_rate || item_data.rate, doc.currency)}</div>`;\n\t\t\t}\n\t\t}\n\t}\n\n\tget_discount_html(doc) {\n\t\tif (doc.discount_amount) {\n\t\t\treturn `<div class=\"summary-row-wrapper\">\n\t\t\t\t\t\t<div>Discount (${doc.additional_discount_percentage} %)</div>\n\t\t\t\t\t\t<div>${format_currency(doc.discount_amount, doc.currency)}</div>\n\t\t\t\t\t</div>`;\n\t\t} else {\n\t\t\treturn ``;\n\t\t}\n\t}\n\n\tget_net_total_html(doc) {\n\t\treturn `<div class=\"summary-row-wrapper\">\n\t\t\t\t\t<div>${__('Net Total')}</div>\n\t\t\t\t\t<div>${format_currency(doc.net_total, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tget_taxes_html(doc) {\n\t\tif (!doc.taxes.length) return '';\n\n\t\tlet taxes_html = doc.taxes.map(t => {\n\t\t\tconst description = /[0-9]+/.test(t.description) ? t.description : `${t.description} @ ${t.rate}%`;\n\t\t\treturn `\n\t\t\t\t<div class=\"tax-row\">\n\t\t\t\t\t<div class=\"tax-label\">${description}</div>\n\t\t\t\t\t<div class=\"tax-value\">${format_currency(t.tax_amount_after_discount_amount, doc.currency)}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}).join('');\n\n\t\treturn `<div class=\"taxes-wrapper\">${taxes_html}</div>`;\n\t}\n\n\tget_grand_total_html(doc) {\n\t\treturn `<div class=\"summary-row-wrapper grand-total\">\n\t\t\t\t\t<div>${__('Grand Total')}</div>\n\t\t\t\t\t<div>${format_currency(doc.grand_total, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tget_payment_html(doc, payment) {\n\t\treturn `<div class=\"summary-row-wrapper payments\">\n\t\t\t\t\t<div>${__(payment.mode_of_payment)}</div>\n\t\t\t\t\t<div>${format_currency(payment.amount, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tbind_events() {\n\t\tthis.$summary_container.on('click', '.return-btn', () => {\n\t\t\tthis.events.process_return(this.doc.name);\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.edit-btn', () => {\n\t\t\tthis.events.edit_order(this.doc.name);\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.delete-btn', () => {\n\t\t\tthis.events.delete_order(this.doc.name);\n\t\t\tthis.show_summary_placeholder();\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.delete-btn', () => {\n\t\t\tthis.events.delete_order(this.doc.name);\n\t\t\tthis.show_summary_placeholder();\n\t\t\t// this.toggle_component(false);\n\t\t\t// this.$component.find('.no-summary-placeholder').removeClass('d-none');\n\t\t\t// this.$summary_wrapper.addClass('d-none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.new-btn', () => {\n\t\t\tthis.events.new_order();\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.email-btn', () => {\n\t\t\tthis.email_dialog.fields_dict.email_id.set_value(this.customer_email);\n\t\t\tthis.email_dialog.show();\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.print-btn', () => {\n\t\t\tthis.print_receipt();\n\t\t});\n\t}\n\n\tprint_receipt() {\n\t\tconst frm = this.events.get_frm();\n\t\tfrappe.utils.print(\n\t\t\tthis.doc.doctype,\n\t\t\tthis.doc.name,\n\t\t\tfrm.pos_print_format,\n\t\t\tthis.doc.letter_head,\n\t\t\tthis.doc.language || frappe.boot.lang\n\t\t);\n\t}\n\n\tattach_shortcuts() {\n\t\tconst ctrl_label = frappe.utils.is_mac() ? '\u2318' : 'Ctrl';\n\t\tthis.$summary_container.find('.print-btn').attr(\"title\", `${ctrl_label}+P`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+p\",\n\t\t\taction: () => this.$summary_container.find('.print-btn').click(),\n\t\t\tcondition: () => this.$component.is(':visible') && this.$summary_container.find('.print-btn').is(\":visible\"),\n\t\t\tdescription: __(\"Print Receipt\"),\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t\tthis.$summary_container.find('.new-btn').attr(\"title\", `${ctrl_label}+Enter`);\n\t\tfrappe.ui.keys.on(\"ctrl+enter\", () => {\n\t\t\tconst summary_is_visible = this.$component.is(\":visible\");\n\t\t\tif (summary_is_visible && this.$summary_container.find('.new-btn').is(\":visible\")) {\n\t\t\t\tthis.$summary_container.find('.new-btn').click();\n\t\t\t}\n\t\t});\n\t\tthis.$summary_container.find('.edit-btn').attr(\"title\", `${ctrl_label}+E`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+e\",\n\t\t\taction: () => this.$summary_container.find('.edit-btn').click(),\n\t\t\tcondition: () => this.$component.is(':visible') && this.$summary_container.find('.edit-btn').is(\":visible\"),\n\t\t\tdescription: __(\"Edit Receipt\"),\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t}\n\n\tsend_email() {\n\t\tconst frm = this.events.get_frm();\n\t\tconst recipients = this.email_dialog.get_values().email_id;\n\t\tconst doc = this.doc || frm.doc;\n\t\tconst print_format = frm.pos_print_format;\n\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.core.doctype.communication.email.make\",\n\t\t\targs: {\n\t\t\t\trecipients: recipients,\n\t\t\t\tsubject: __(frm.meta.name) + ': ' + doc.name,\n\t\t\t\tdoctype: doc.doctype,\n\t\t\t\tname: doc.name,\n\t\t\t\tsend_email: 1,\n\t\t\t\tprint_format,\n\t\t\t\tsender_full_name: frappe.user.full_name(),\n\t\t\t\t_lang: doc.language\n\t\t\t},\n\t\t\tcallback: r => {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tfrappe.utils.play_sound(\"email\");\n\t\t\t\t\tif (r.message[\"emails_not_sent_to\"]) {\n\t\t\t\t\t\tfrappe.msgprint(__(\n\t\t\t\t\t\t\t\"Email not sent to {0} (unsubscribed / disabled)\",\n\t\t\t\t\t\t\t[ frappe.utils.escape_html(r.message[\"emails_not_sent_to\"]) ]\n\t\t\t\t\t\t));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __('Email sent successfully.'),\n\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.email_dialog.hide();\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.msgprint(__(\"There were errors while sending email. Please try again.\"));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tadd_summary_btns(map) {\n\t\tthis.$summary_btns.html('');\n\t\tmap.forEach(m => {\n\t\t\tif (m.condition) {\n\t\t\t\tm.visible_btns.forEach(b => {\n\t\t\t\t\tconst class_name = b.split(' ')[0].toLowerCase();\n\t\t\t\t\tconst btn = __(b);\n\t\t\t\t\tthis.$summary_btns.append(\n\t\t\t\t\t\t`<div class=\"summary-btn btn btn-default ${class_name}-btn\">${btn}</div>`\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tthis.$summary_btns.children().last().removeClass('mr-4');\n\t}\n\n\ttoggle_summary_placeholder(show) {\n\t\tif (show) {\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t} else {\n\t\t\tthis.$summary_wrapper.css('display', 'flex');\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'none');\n\t\t}\n\t}\n\n\tget_condition_btn_map(after_submission) {\n\t\tif (after_submission)\n\t\t\treturn [{ condition: true, visible_btns: ['Print Receipt', 'Email Receipt', 'New Order'] }];\n\n\t\treturn [\n\t\t\t{ condition: this.doc.docstatus === 0, visible_btns: ['Edit Order', 'Delete Order'] },\n\t\t\t{ condition: !this.doc.is_return && this.doc.docstatus === 1, visible_btns: ['Print Receipt', 'Email Receipt', 'Return']},\n\t\t\t{ condition: this.doc.is_return && this.doc.docstatus === 1, visible_btns: ['Print Receipt', 'Email Receipt']}\n\t\t];\n\t}\n\n\tload_summary_of(doc, after_submission=false) {\n\t\tafter_submission ?\n\t\t\tthis.$component.css('grid-column', 'span 10 / span 10') :\n\t\t\tthis.$component.css('grid-column', 'span 6 / span 6');\n\n\t\tthis.toggle_summary_placeholder(false);\n\n\t\tthis.doc = doc;\n\n\t\tthis.attach_document_info(doc);\n\n\t\tthis.attach_items_info(doc);\n\n\t\tthis.attach_totals_info(doc);\n\n\t\tthis.attach_payments_info(doc);\n\n\t\tconst condition_btns_map = this.get_condition_btn_map(after_submission);\n\n\t\tthis.add_summary_btns(condition_btns_map);\n\t}\n\n\tattach_document_info(doc) {\n\t\tfrappe.db.get_value('Customer', this.doc.customer, 'email_id').then(({ message }) => {\n\t\t\tthis.customer_email = message.email_id || '';\n\t\t\tconst upper_section_dom = this.get_upper_section_html(doc);\n\t\t\tthis.$upper_section.html(upper_section_dom);\n\t\t});\n\t}\n\n\tattach_items_info(doc) {\n\t\tthis.$items_container.html('');\n\t\tdoc.items.forEach(item => {\n\t\t\tconst item_dom = this.get_item_html(doc, item);\n\t\t\tthis.$items_container.append(item_dom);\n\t\t\tthis.set_dynamic_rate_header_width();\n\t\t});\n\t}\n\n\tset_dynamic_rate_header_width() {\n\t\tconst rate_cols = Array.from(this.$items_container.find(\".item-rate-disc\"));\n\t\tthis.$items_container.find(\".item-rate-disc\").css(\"width\", \"\");\n\t\tlet max_width = rate_cols.reduce((max_width, elm) => {\n\t\t\tif ($(elm).width() > max_width)\n\t\t\t\tmax_width = $(elm).width();\n\t\t\treturn max_width;\n\t\t}, 0);\n\n\t\tmax_width += 1;\n\t\tif (max_width == 1) max_width = \"\";\n\n\t\tthis.$items_container.find(\".item-rate-disc\").css(\"width\", max_width);\n\t}\n\n\tattach_payments_info(doc) {\n\t\tthis.$payment_container.html('');\n\t\tdoc.payments.forEach(p => {\n\t\t\tif (p.amount) {\n\t\t\t\tconst payment_dom = this.get_payment_html(doc, p);\n\t\t\t\tthis.$payment_container.append(payment_dom);\n\t\t\t}\n\t\t});\n\t\tif (doc.redeem_loyalty_points && doc.loyalty_amount) {\n\t\t\tconst payment_dom = this.get_payment_html(doc, {\n\t\t\t\tmode_of_payment: 'Loyalty Points',\n\t\t\t\tamount: doc.loyalty_amount,\n\t\t\t});\n\t\t\tthis.$payment_container.append(payment_dom);\n\t\t}\n\t}\n\n\tattach_totals_info(doc) {\n\t\tthis.$totals_container.html('');\n\n\t\tconst net_total_dom = this.get_net_total_html(doc);\n\t\tconst taxes_dom = this.get_taxes_html(doc);\n\t\tconst discount_dom = this.get_discount_html(doc);\n\t\tconst grand_total_dom = this.get_grand_total_html(doc);\n\t\tthis.$totals_container.append(net_total_dom);\n\t\tthis.$totals_container.append(taxes_dom);\n\t\tthis.$totals_container.append(discount_dom);\n\t\tthis.$totals_container.append(grand_total_dom);\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') : this.$component.css('display', 'none');\n\t}\n};\n", "erpnext.PointOfSale.PastOrderSummary = class extends erpnext.PointOfSale.PastOrderSummary{\n\tbind_events() {\n\t\tthis.$summary_container.on('click', '.return-btn', () => {\n\t\t\tthis.events.process_return(this.doc.name);\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.edit-btn', () => {\n\t\t\tthis.events.edit_order(this.doc.name);\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.delete-btn', () => {\n\t\t\tthis.events.delete_order(this.doc.name);\n\t\t\tthis.show_summary_placeholder();\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.delete-btn', () => {\n\t\t\tthis.events.delete_order(this.doc.name);\n\t\t\tthis.show_summary_placeholder();\n\t\t\t// this.toggle_component(false);\n\t\t\t// this.$component.find('.no-summary-placeholder').removeClass('d-none');\n\t\t\t// this.$summary_wrapper.addClass('d-none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.new-btn', () => {\n\t\t\tthis.events.new_order();\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.email-btn', () => {\n\t\t\tthis.email_dialog.fields_dict.email_id.set_value(this.customer_email);\n\t\t\tthis.email_dialog.show();\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.print-btn', () => {\n\t\t\tthis.print_receipt();\n\t\t});\n\t\t\n\t\t//For raw print\n\t\tthis.$summary_container.on('click', '.direct-print-btn', () => {\n\t\t\tthis.events.raw_print();\n\t\t});\n\t\t\n\t\tthis.$summary_container.on('click', '.cash-drawer-btn', () => {\n\t\t\tthis.events.open_cash_drawer();\n\t\t});\n\t}\n\t\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"past-order-summary\">\n\t\t\t\t<div class=\"no-summary-placeholder\">\n\t\t\t\t\t${__('Select an invoice to load summary data')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoice-summary-wrapper\">\n\t\t\t\t\t<div class=\"abs-container\">\n\t\t\t\t\t\t<div class=\"upper-section\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__('Items')}</div>\n\t\t\t\t\t\t<div class=\"items-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__('Totals')}</div>\n\t\t\t\t\t\t<div class=\"totals-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__('Payments')}</div>\n\t\t\t\t\t\t<div class=\"payments-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"summary-btns\"></div>\n\t\t\t\t\t\t<div class=\"raw-btns summary-container\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</section>`\n\t\t);\n\n\t\tthis.$component = this.wrapper.find('.past-order-summary');\n\t\tthis.$summary_wrapper = this.$component.find('.invoice-summary-wrapper');\n\t\tthis.$summary_container = this.$component.find('.abs-container');\n\t\tthis.$upper_section = this.$summary_container.find('.upper-section');\n\t\tthis.$items_container = this.$summary_container.find('.items-container');\n\t\tthis.$totals_container = this.$summary_container.find('.totals-container');\n\t\tthis.$payment_container = this.$summary_container.find('.payments-container');\n\t\tthis.$summary_btns = this.$summary_container.find('.summary-btns');\n\t\tthis.$raw_btns = this.$summary_container.find('.raw-btns');\n\t}\n\t\n\tload_summary_of(doc, after_submission=false) {\n\t\tafter_submission ?\n\t\t\tthis.$component.css('grid-column', 'span 10 / span 10') :\n\t\t\tthis.$component.css('grid-column', 'span 6 / span 6');\n\n\t\tthis.toggle_summary_placeholder(false);\n\n\t\tthis.doc = doc;\n\n\t\tthis.attach_document_info(doc);\n\n\t\tthis.attach_items_info(doc);\n\n\t\tthis.attach_totals_info(doc);\n\n\t\tthis.attach_payments_info(doc);\n\n\t\tconst condition_btns_map = this.get_condition_btn_map(after_submission);\n\n\t\tthis.add_summary_btns(condition_btns_map);\n\t\tthis.add_raw_btns();\n\t}\n\t\n\tadd_raw_btns(){\n\t\tthis.$raw_btns.html('');\n\t\tif(window.enable_raw_print == 1 && window.raw_printer){\n\t\t\tthis.$raw_btns.append(\n\t\t\t\t`<div class=\"summary-btn btn btn-default direct-print-btn\">Direct Print</div>\n\t\t\t\t<div style=\"margin-top: 10px;\" class=\"summary-btn btn btn-default cash-drawer-btn\">Open Cash Drawer</div>`\n\t\t\t);\n\t\t}\n\t\tthis.$raw_btns.children().last().removeClass('mr-4');\n\t}\n};\n", "erpnext.PointOfSale.Controller = class {\n\tconstructor(wrapper) {\n\t\tthis.wrapper = $(wrapper).find('.layout-main-section');\n\t\tthis.page = wrapper.page;\n\n\t\tthis.check_opening_entry();\n\t}\n\n\tfetch_opening_entry() {\n\t\treturn frappe.call(\"erpnext.selling.page.point_of_sale.point_of_sale.check_opening_entry\", { \"user\": frappe.session.user });\n\t}\n\n\tcheck_opening_entry() {\n\t\tthis.fetch_opening_entry().then((r) => {\n\t\t\tif (r.message.length) {\n\t\t\t\t// assuming only one opening voucher is available for the current user\n\t\t\t\tthis.prepare_app_defaults(r.message[0]);\n\t\t\t} else {\n\t\t\t\tthis.create_opening_voucher();\n\t\t\t}\n\t\t});\n\t}\n\n\tcreate_opening_voucher() {\n\t\tconst me = this;\n\t\tconst table_fields = [\n\t\t\t{\n\t\t\t\tfieldname: \"mode_of_payment\", fieldtype: \"Link\",\n\t\t\t\tin_list_view: 1, label: \"Mode of Payment\",\n\t\t\t\toptions: \"Mode of Payment\", reqd: 1\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"opening_amount\", fieldtype: \"Currency\",\n\t\t\t\tin_list_view: 1, label: \"Opening Amount\",\n\t\t\t\toptions: \"company:company_currency\",\n\t\t\t\tchange: function () {\n\t\t\t\t\tdialog.fields_dict.balance_details.df.data.some(d => {\n\t\t\t\t\t\tif (d.idx == this.doc.idx) {\n\t\t\t\t\t\t\td.opening_amount = this.value;\n\t\t\t\t\t\t\tdialog.fields_dict.balance_details.grid.refresh();\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst fetch_pos_payment_methods = () => {\n\t\t\tconst pos_profile = dialog.fields_dict.pos_profile.get_value();\n\t\t\tif (!pos_profile) return;\n\t\t\tfrappe.db.get_doc(\"POS Profile\", pos_profile).then(({ payments }) => {\n\t\t\t\tdialog.fields_dict.balance_details.df.data = [];\n\t\t\t\tpayments.forEach(pay => {\n\t\t\t\t\tconst { mode_of_payment } = pay;\n\t\t\t\t\tdialog.fields_dict.balance_details.df.data.push({ mode_of_payment, opening_amount: '0' });\n\t\t\t\t});\n\t\t\t\tdialog.fields_dict.balance_details.grid.refresh();\n\t\t\t});\n\t\t}\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Create POS Opening Entry'),\n\t\t\tstatic: true,\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Link', label: __('Company'), default: frappe.defaults.get_default('company'),\n\t\t\t\t\toptions: 'Company', fieldname: 'company', reqd: 1\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Link', label: __('POS Profile'),\n\t\t\t\t\toptions: 'POS Profile', fieldname: 'pos_profile', reqd: 1,\n\t\t\t\t\tget_query: () => pos_profile_query,\n\t\t\t\t\tonchange: () => fetch_pos_payment_methods()\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"balance_details\",\n\t\t\t\t\tfieldtype: \"Table\",\n\t\t\t\t\tlabel: \"Opening Balance Details\",\n\t\t\t\t\tcannot_add_rows: false,\n\t\t\t\t\tin_place_edit: true,\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tdata: [],\n\t\t\t\t\tfields: table_fields\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action: async function({ company, pos_profile, balance_details }) {\n\t\t\t\tif (!balance_details.length) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"Please add Mode of payments and opening balance details.\"),\n\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t})\n\t\t\t\t\treturn frappe.utils.play_sound(\"error\");\n\t\t\t\t}\n\n\t\t\t\t// filter balance details for empty rows\n\t\t\t\tbalance_details = balance_details.filter(d => d.mode_of_payment);\n\n\t\t\t\tconst method = \"erpnext.selling.page.point_of_sale.point_of_sale.create_opening_voucher\";\n\t\t\t\tconst res = await frappe.call({ method, args: { pos_profile, company, balance_details }, freeze:true });\n\t\t\t\t!res.exc && me.prepare_app_defaults(res.message);\n\t\t\t\tdialog.hide();\n\t\t\t},\n\t\t\tprimary_action_label: __('Submit')\n\t\t});\n\t\tdialog.show();\n\t\tconst pos_profile_query = {\n\t\t\tquery: 'erpnext.accounts.doctype.pos_profile.pos_profile.pos_profile_query',\n\t\t\tfilters: { company: dialog.fields_dict.company.get_value() }\n\t\t};\n\t}\n\n\tasync prepare_app_defaults(data) {\n\t\tthis.pos_opening = data.name;\n\t\tthis.company = data.company;\n\t\tthis.pos_profile = data.pos_profile;\n\t\tthis.pos_opening_time = data.period_start_date;\n\t\tthis.item_stock_map = {};\n\t\tthis.settings = {};\n\n\t\tfrappe.db.get_value('Stock Settings', undefined, 'allow_negative_stock').then(({ message }) => {\n\t\t\tthis.allow_negative_stock = flt(message.allow_negative_stock) || false;\n\t\t});\n\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.selling.page.point_of_sale.point_of_sale.get_pos_profile_data\",\n\t\t\targs: { \"pos_profile\": this.pos_profile },\n\t\t\tcallback: (res) => {\n\t\t\t\tconst profile = res.message;\n\t\t\t\tObject.assign(this.settings, profile);\n\t\t\t\tthis.settings.customer_groups = profile.customer_groups.map(group => group.name);\n\t\t\t\tthis.make_app();\n\t\t\t}\n\t\t});\n\t}\n\n\tset_opening_entry_status() {\n\t\tthis.page.set_title_sub(\n\t\t\t`<span class=\"indicator orange\">\n\t\t\t\t<a class=\"text-muted\" href=\"#Form/POS%20Opening%20Entry/${this.pos_opening}\">\n\t\t\t\t\tOpened at ${moment(this.pos_opening_time).format(\"Do MMMM, h:mma\")}\n\t\t\t\t</a>\n\t\t\t</span>`);\n\t}\n\n\tmake_app() {\n\t\tthis.prepare_dom();\n\t\tthis.prepare_components();\n\t\tthis.prepare_menu();\n\t\tthis.make_new_invoice();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<div class=\"point-of-sale-app\"></div>`\n\t\t);\n\n\t\tthis.$components_wrapper = this.wrapper.find('.point-of-sale-app');\n\t}\n\n\tprepare_components() {\n\t\tthis.init_item_selector();\n\t\tthis.init_item_details();\n\t\tthis.init_item_cart();\n\t\tthis.init_payments();\n\t\tthis.init_recent_order_list();\n\t\tthis.init_order_summary();\n\t}\n\n\tprepare_menu() {\n\t\tthis.page.clear_menu();\n\n\t\tthis.page.add_menu_item(__(\"Open Form View\"), this.open_form_view.bind(this), false, 'Ctrl+F');\n\n\t\tthis.page.add_menu_item(__(\"Toggle Recent Orders\"), this.toggle_recent_order.bind(this), false, 'Ctrl+O');\n\n\t\tthis.page.add_menu_item(__(\"Save as Draft\"), this.save_draft_invoice.bind(this), false, 'Ctrl+S');\n\n\t\tthis.page.add_menu_item(__('Close the POS'), this.close_pos.bind(this), false, 'Shift+Ctrl+C');\n\t}\n\n\topen_form_view() {\n\t\tfrappe.model.sync(this.frm.doc);\n\t\tfrappe.set_route(\"Form\", this.frm.doc.doctype, this.frm.doc.name);\n\t}\n\n\ttoggle_recent_order() {\n\t\tconst show = this.recent_order_list.$component.is(':hidden');\n\t\tthis.toggle_recent_order_list(show);\n\t}\n\n\tsave_draft_invoice() {\n\t\tif (!this.$components_wrapper.is(\":visible\")) return;\n\n\t\tif (this.frm.doc.items.length == 0) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"You must add atleast one item to save it as draft.\"),\n\t\t\t\tindicator:'red'\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.frm.save(undefined, undefined, undefined, () => {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"There was an error saving the document.\"),\n\t\t\t\tindicator: 'red'\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t}).then(() => {\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => frappe.dom.freeze(),\n\t\t\t\t() => this.make_new_invoice(),\n\t\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t]);\n\t\t});\n\t}\n\n\tclose_pos() {\n\t\tif (!this.$components_wrapper.is(\":visible\")) return;\n\n\t\tlet voucher = frappe.model.get_new_doc('POS Closing Entry');\n\t\tvoucher.pos_profile = this.frm.doc.pos_profile;\n\t\tvoucher.user = frappe.session.user;\n\t\tvoucher.company = this.frm.doc.company;\n\t\tvoucher.pos_opening_entry = this.pos_opening;\n\t\tvoucher.period_end_date = frappe.datetime.now_datetime();\n\t\tvoucher.posting_date = frappe.datetime.now_date();\n\t\tfrappe.set_route('Form', 'POS Closing Entry', voucher.name);\n\t}\n\n\tinit_item_selector() {\n\t\tthis.item_selector = new erpnext.PointOfSale.ItemSelector({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tpos_profile: this.pos_profile,\n\t\t\tsettings: this.settings,\n\t\t\tevents: {\n\t\t\t\titem_selected: args => this.on_cart_update(args),\n\n\t\t\t\tget_frm: () => this.frm || {}\n\t\t\t}\n\t\t})\n\t}\n\n\tinit_item_cart() {\n\t\tthis.cart = new erpnext.PointOfSale.ItemCart({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tsettings: this.settings,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\tcart_item_clicked: (item) => {\n\t\t\t\t\tconst item_row = this.get_item_from_frm(item);\n\t\t\t\t\tthis.item_details.toggle_item_details_section(item_row);\n\t\t\t\t},\n\n\t\t\t\tnumpad_event: (value, action) => this.update_item_field(value, action),\n\n\t\t\t\tcheckout: () => this.save_and_checkout(),\n\n\t\t\t\tedit_cart: () => this.payment.edit_cart(),\n\n\t\t\t\tcustomer_details_updated: (details) => {\n\t\t\t\t\tthis.customer_details = details;\n\t\t\t\t\t// will add/remove LP payment method\n\t\t\t\t\tthis.payment.render_loyalty_points_payment_mode();\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\tinit_item_details() {\n\t\tthis.item_details = new erpnext.PointOfSale.ItemDetails({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tsettings: this.settings,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\ttoggle_item_selector: (minimize) => {\n\t\t\t\t\tthis.item_selector.resize_selector(minimize);\n\t\t\t\t\tthis.cart.toggle_numpad(minimize);\n\t\t\t\t},\n\n\t\t\t\tform_updated: (item, field, value) => {\n\t\t\t\t\tconst item_row = frappe.model.get_doc(item.doctype, item.name);\n\t\t\t\t\tif (item_row && item_row[field] != value) {\n\t\t\t\t\t\tconst args = {\n\t\t\t\t\t\t\tfield,\n\t\t\t\t\t\t\tvalue,\n\t\t\t\t\t\t\titem: this.item_details.current_item\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn this.on_cart_update(args);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t},\n\n\t\t\t\thighlight_cart_item: (item) => {\n\t\t\t\t\tconst cart_item = this.cart.get_cart_item(item);\n\t\t\t\t\tthis.cart.toggle_item_highlight(cart_item);\n\t\t\t\t},\n\n\t\t\t\titem_field_focused: (fieldname) => {\n\t\t\t\t\tthis.cart.toggle_numpad_field_edit(fieldname);\n\t\t\t\t},\n\t\t\t\tset_value_in_current_cart_item: (selector, value) => {\n\t\t\t\t\tthis.cart.update_selector_value_in_cart_item(selector, value, this.item_details.current_item);\n\t\t\t\t},\n\t\t\t\tclone_new_batch_item_in_frm: (batch_serial_map, item) => {\n\t\t\t\t\t// called if serial nos are 'auto_selected' and if those serial nos belongs to multiple batches\n\t\t\t\t\t// for each unique batch new item row is added in the form & cart\n\t\t\t\t\tObject.keys(batch_serial_map).forEach(batch => {\n\t\t\t\t\t\tconst item_to_clone = this.frm.doc.items.find(i => i.name == item.name);\n\t\t\t\t\t\tconst new_row = this.frm.add_child(\"items\", { ...item_to_clone });\n\t\t\t\t\t\t// update new serialno and batch\n\t\t\t\t\t\tnew_row.batch_no = batch;\n\t\t\t\t\t\tnew_row.serial_no = batch_serial_map[batch].join(`\\n`);\n\t\t\t\t\t\tnew_row.qty = batch_serial_map[batch].length;\n\t\t\t\t\t\tthis.frm.doc.items.forEach(row => {\n\t\t\t\t\t\t\tif (item.item_code === row.item_code) {\n\t\t\t\t\t\t\t\tthis.update_cart_html(row);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tremove_item_from_cart: () => this.remove_item_from_cart(),\n\t\t\t\tget_item_stock_map: () => this.item_stock_map,\n\t\t\t\tclose_item_details: () => {\n\t\t\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t\t\t\tthis.cart.prev_action = null;\n\t\t\t\t\tthis.cart.toggle_item_highlight();\n\t\t\t\t},\n\t\t\t\tget_available_stock: (item_code, warehouse) => this.get_available_stock(item_code, warehouse)\n\t\t\t}\n\t\t});\n\t}\n\n\tinit_payments() {\n\t\tthis.payment = new erpnext.PointOfSale.Payment({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm || {},\n\n\t\t\t\tget_customer_details: () => this.customer_details || {},\n\n\t\t\t\ttoggle_other_sections: (show) => {\n\t\t\t\t\tif (show) {\n\t\t\t\t\t\tthis.item_details.$component.is(':visible') ? this.item_details.$component.css('display', 'none') : '';\n\t\t\t\t\t\tthis.item_selector.toggle_component(false);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.item_selector.toggle_component(true);\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tsubmit_invoice: () => {\n\t\t\t\t\tthis.frm.savesubmit()\n\t\t\t\t\t\t.then((r) => {\n\t\t\t\t\t\t\tthis.toggle_components(false);\n\t\t\t\t\t\t\tthis.order_summary.toggle_component(true);\n\t\t\t\t\t\t\tthis.order_summary.load_summary_of(this.frm.doc, true);\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tindicator: 'green',\n\t\t\t\t\t\t\t\tmessage: __('POS invoice {0} created succesfully', [r.doc.name])\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tinit_recent_order_list() {\n\t\tthis.recent_order_list = new erpnext.PointOfSale.PastOrderList({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tevents: {\n\t\t\t\topen_invoice_data: (name) => {\n\t\t\t\t\tfrappe.db.get_doc('POS Invoice', name).then((doc) => {\n\t\t\t\t\t\tthis.order_summary.load_summary_of(doc);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\treset_summary: () => this.order_summary.toggle_summary_placeholder(true)\n\t\t\t}\n\t\t})\n\t}\n\n\tinit_order_summary() {\n\t\tthis.order_summary = new erpnext.PointOfSale.PastOrderSummary({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\tprocess_return: (name) => {\n\t\t\t\t\tthis.recent_order_list.toggle_component(false);\n\t\t\t\t\tfrappe.db.get_doc('POS Invoice', name).then((doc) => {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => this.make_return_invoice(doc),\n\t\t\t\t\t\t\t() => this.cart.load_invoice(),\n\t\t\t\t\t\t\t() => this.item_selector.toggle_component(true)\n\t\t\t\t\t\t]);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tedit_order: (name) => {\n\t\t\t\t\tthis.recent_order_list.toggle_component(false);\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => this.frm.refresh(name),\n\t\t\t\t\t\t() => this.frm.call('reset_mode_of_payments'),\n\t\t\t\t\t\t() => this.cart.load_invoice(),\n\t\t\t\t\t\t() => this.item_selector.toggle_component(true)\n\t\t\t\t\t]);\n\t\t\t\t},\n\t\t\t\tdelete_order: (name) => {\n\t\t\t\t\tfrappe.model.delete_doc(this.frm.doc.doctype, name, () => {\n\t\t\t\t\t\tthis.recent_order_list.refresh_list();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tnew_order: () => {\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => frappe.dom.freeze(),\n\t\t\t\t\t\t() => this.make_new_invoice(),\n\t\t\t\t\t\t() => this.item_selector.toggle_component(true),\n\t\t\t\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\ttoggle_recent_order_list(show) {\n\t\tthis.toggle_components(!show);\n\t\tthis.recent_order_list.toggle_component(show);\n\t\tthis.order_summary.toggle_component(show);\n\t}\n\n\ttoggle_components(show) {\n\t\tthis.cart.toggle_component(show);\n\t\tthis.item_selector.toggle_component(show);\n\n\t\t// do not show item details or payment if recent order is toggled off\n\t\t!show ? (this.item_details.toggle_component(false) || this.payment.toggle_component(false)) : '';\n\t}\n\n\tmake_new_invoice() {\n\t\treturn frappe.run_serially([\n\t\t\t() => frappe.dom.freeze(),\n\t\t\t() => this.make_sales_invoice_frm(),\n\t\t\t() => this.set_pos_profile_data(),\n\t\t\t() => this.set_pos_profile_status(),\n\t\t\t() => this.cart.load_invoice(),\n\t\t\t() => frappe.dom.unfreeze()\n\t\t]);\n\t}\n\n\tmake_sales_invoice_frm() {\n\t\tconst doctype = 'POS Invoice';\n\t\treturn new Promise(resolve => {\n\t\t\tif (this.frm) {\n\t\t\t\tthis.frm = this.get_new_frm(this.frm);\n\t\t\t\tthis.frm.doc.items = [];\n\t\t\t\tthis.frm.doc.is_pos = 1\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\tfrappe.model.with_doctype(doctype, () => {\n\t\t\t\t\tthis.frm = this.get_new_frm();\n\t\t\t\t\tthis.frm.doc.items = [];\n\t\t\t\t\tthis.frm.doc.is_pos = 1\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tget_new_frm(_frm) {\n\t\tconst doctype = 'POS Invoice';\n\t\tconst page = $('<div>');\n\t\tconst frm = _frm || new frappe.ui.form.Form(doctype, page, false);\n\t\tconst name = frappe.model.make_new_doc_and_get_name(doctype, true);\n\t\tfrm.refresh(name);\n\n\t\treturn frm;\n\t}\n\n\tasync make_return_invoice(doc) {\n\t\tfrappe.dom.freeze();\n\t\tthis.frm = this.get_new_frm(this.frm);\n\t\tthis.frm.doc.items = [];\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pos_invoice.pos_invoice.make_sales_return\",\n\t\t\targs: {\n\t\t\t\t'source_name': doc.name,\n\t\t\t\t'target_doc': this.frm.doc\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tfrappe.model.sync(r.message);\n\t\t\t\tfrappe.get_doc(r.message.doctype, r.message.name).__run_link_triggers = false;\n\t\t\t\tthis.set_pos_profile_data().then(() => {\n\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tset_pos_profile_data() {\n\t\tif (this.company && !this.frm.doc.company) this.frm.doc.company = this.company;\n\t\tif ((this.pos_profile && !this.frm.doc.pos_profile) | (this.frm.doc.is_return && this.pos_profile != this.frm.doc.pos_profile)) {\n\t\t\tthis.frm.doc.pos_profile = this.pos_profile;\n\t\t}\n\n\t\tif (!this.frm.doc.company) return;\n\n\t\treturn this.frm.trigger(\"set_pos_data\");\n\t}\n\n\tset_pos_profile_status() {\n\t\tthis.page.set_indicator(this.pos_profile, \"blue\");\n\t}\n\n\tasync on_cart_update(args) {\n\t\tfrappe.dom.freeze();\n\t\tlet item_row = undefined;\n\t\ttry {\n\t\t\tlet { field, value, item } = args;\n\t\t\titem_row = this.get_item_from_frm(item);\n\t\t\tconst item_row_exists = !$.isEmptyObject(item_row);\n\n\t\t\tconst from_selector = field === 'qty' && value === \"+1\";\n\t\t\tif (from_selector)\n\t\t\t\tvalue = flt(item_row.qty) + flt(value);\n\n\t\t\tif (item_row_exists) {\n\t\t\t\tif (field === 'qty')\n\t\t\t\t\tvalue = flt(value);\n\n\t\t\t\tif (['qty', 'conversion_factor'].includes(field) && value > 0 && !this.allow_negative_stock) {\n\t\t\t\t\tconst qty_needed = field === 'qty' ? value * item_row.conversion_factor : item_row.qty * value;\n\t\t\t\t\tawait this.check_stock_availability(item_row, qty_needed, this.frm.doc.set_warehouse);\n\t\t\t\t}\n\n\t\t\t\tif (this.is_current_item_being_edited(item_row) || from_selector) {\n\t\t\t\t\tawait frappe.model.set_value(item_row.doctype, item_row.name, field, value);\n\t\t\t\t\tthis.update_cart_html(item_row);\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tif (!this.frm.doc.customer)\n\t\t\t\t\treturn this.raise_customer_selection_alert();\n\n\t\t\t\tconst { item_code, batch_no, serial_no, rate } = item;\n\n\t\t\t\tif (!item_code)\n\t\t\t\t\treturn;\n\n\t\t\t\tconst new_item = { item_code, batch_no, rate, [field]: value };\n\n\t\t\t\tif (serial_no) {\n\t\t\t\t\tawait this.check_serial_no_availablilty(item_code, this.frm.doc.set_warehouse, serial_no);\n\t\t\t\t\tnew_item['serial_no'] = serial_no;\n\t\t\t\t}\n\n\t\t\t\tif (field === 'serial_no')\n\t\t\t\t\tnew_item['qty'] = value.split(`\\n`).length || 0;\n\n\t\t\t\titem_row = this.frm.add_child('items', new_item);\n\n\t\t\t\tif (field === 'qty' && value !== 0 && !this.allow_negative_stock)\n\t\t\t\t\tawait this.check_stock_availability(item_row, value, this.frm.doc.set_warehouse);\n\n\t\t\t\tawait this.trigger_new_item_events(item_row);\n\n\t\t\t\tthis.update_cart_html(item_row);\n\n\t\t\t\tif (this.item_details.$component.is(':visible'))\n\t\t\t\t\tthis.edit_item_details_of(item_row);\n\n\t\t\t\tif (this.check_serial_batch_selection_needed(item_row) && !this.item_details.$component.is(':visible'))\n\t\t\t\t\tthis.edit_item_details_of(item_row);\n\t\t\t}\n\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t} finally {\n\t\t\tfrappe.dom.unfreeze();\n\t\t\treturn item_row;\n\t\t}\n\t}\n\n\traise_customer_selection_alert() {\n\t\tfrappe.dom.unfreeze();\n\t\tfrappe.show_alert({\n\t\t\tmessage: __('You must select a customer before adding an item.'),\n\t\t\tindicator: 'orange'\n\t\t});\n\t\tfrappe.utils.play_sound(\"error\");\n\t}\n\n\tget_item_from_frm({ name, item_code, batch_no, uom, rate }) {\n\t\tlet item_row = null;\n\t\tif (name) {\n\t\t\titem_row = this.frm.doc.items.find(i => i.name == name);\n\t\t} else {\n\t\t\t// if item is clicked twice from item selector\n\t\t\t// then \"item_code, batch_no, uom, rate\" will help in getting the exact item\n\t\t\t// to increase the qty by one\n\t\t\tconst has_batch_no = batch_no;\n\t\t\titem_row = this.frm.doc.items.find(\n\t\t\t\ti => i.item_code === item_code\n\t\t\t\t\t&& (!has_batch_no || (has_batch_no && i.batch_no === batch_no))\n\t\t\t\t\t&& (i.uom === uom)\n\t\t\t\t\t&& (i.rate == rate)\n\t\t\t);\n\t\t}\n\n\t\treturn item_row || {};\n\t}\n\n\tedit_item_details_of(item_row) {\n\t\tthis.item_details.toggle_item_details_section(item_row);\n\t}\n\n\tis_current_item_being_edited(item_row) {\n\t\treturn item_row.name == this.item_details.current_item.name;\n\t}\n\n\tupdate_cart_html(item_row, remove_item) {\n\t\tthis.cart.update_item_html(item_row, remove_item);\n\t\tthis.cart.update_totals_section(this.frm);\n\t}\n\n\tcheck_serial_batch_selection_needed(item_row) {\n\t\t// right now item details is shown for every type of item.\n\t\t// if item details is not shown for every item then this fn will be needed\n\t\tconst serialized = item_row.has_serial_no;\n\t\tconst batched = item_row.has_batch_no;\n\t\tconst no_serial_selected = !item_row.serial_no;\n\t\tconst no_batch_selected = !item_row.batch_no;\n\n\t\tif ((serialized && no_serial_selected) || (batched && no_batch_selected) ||\n\t\t\t(serialized && batched && (no_batch_selected || no_serial_selected))) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tasync trigger_new_item_events(item_row) {\n\t\tawait this.frm.script_manager.trigger('item_code', item_row.doctype, item_row.name);\n\t\tawait this.frm.script_manager.trigger('qty', item_row.doctype, item_row.name);\n\t}\n\n\tasync check_stock_availability(item_row, qty_needed, warehouse) {\n\t\tconst resp = (await this.get_available_stock(item_row.item_code, warehouse)).message;\n\t\tconst available_qty = resp[0];\n\t\tconst is_stock_item = resp[1];\n\n\t\tfrappe.dom.unfreeze();\n\t\tconst bold_item_code = item_row.item_code.bold();\n\t\tconst bold_warehouse = warehouse.bold();\n\t\tconst bold_available_qty = available_qty.toString().bold()\n\t\tif (!(available_qty > 0)) {\n\t\t\tif (is_stock_item) {\n\t\t\t\tfrappe.model.clear_doc(item_row.doctype, item_row.name);\n\t\t\t\tfrappe.throw({\n\t\t\t\t\ttitle: __(\"Not Available\"),\n\t\t\t\t\tmessage: __('Item Code: {0} is not available under warehouse {1}.', [bold_item_code, bold_warehouse])\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else if (available_qty < qty_needed) {\n\t\t\tfrappe.throw({\n\t\t\t\tmessage: __('Stock quantity not enough for Item Code: {0} under warehouse {1}. Available quantity {2}.', [bold_item_code, bold_warehouse, bold_available_qty]),\n\t\t\t\tindicator: 'orange'\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t}\n\t\tfrappe.dom.freeze();\n\t}\n\n\tasync check_serial_no_availablilty(item_code, warehouse, serial_no) {\n\t\tconst method = \"erpnext.stock.doctype.serial_no.serial_no.get_pos_reserved_serial_nos\";\n\t\tconst args = {filters: { item_code, warehouse }}\n\t\tconst res = await frappe.call({ method, args });\n\n\t\tif (res.message.includes(serial_no)) {\n\t\t\tfrappe.throw({\n\t\t\t\ttitle: __(\"Not Available\"),\n\t\t\t\tmessage: __('Serial No: {0} has already been transacted into another POS Invoice.', [serial_no.bold()])\n\t\t\t});\n\t\t}\n\t}\n\n\tget_available_stock(item_code, warehouse) {\n\t\tconst me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pos_invoice.pos_invoice.get_stock_availability\",\n\t\t\targs: {\n\t\t\t\t'item_code': item_code,\n\t\t\t\t'warehouse': warehouse,\n\t\t\t},\n\t\t\tcallback(res) {\n\t\t\t\tif (!me.item_stock_map[item_code])\n\t\t\t\t\tme.item_stock_map[item_code] = {};\n\t\t\t\tme.item_stock_map[item_code][warehouse] = res.message[0];\n\t\t\t}\n\t\t});\n\t}\n\n\tupdate_item_field(value, field_or_action) {\n\t\tif (field_or_action === 'checkout') {\n\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t} else if (field_or_action === 'remove') {\n\t\t\tthis.remove_item_from_cart();\n\t\t} else {\n\t\t\tconst field_control = this.item_details[`${field_or_action}_control`];\n\t\t\tif (!field_control) return;\n\t\t\tfield_control.set_focus();\n\t\t\tvalue != \"\" && field_control.set_value(value);\n\t\t}\n\t}\n\n\tremove_item_from_cart() {\n\t\tfrappe.dom.freeze();\n\t\tconst { doctype, name, current_item } = this.item_details;\n\n\t\treturn frappe.model.set_value(doctype, name, 'qty', 0)\n\t\t\t.then(() => {\n\t\t\t\tfrappe.model.clear_doc(doctype, name);\n\t\t\t\tthis.update_cart_html(current_item, true);\n\t\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t})\n\t\t\t.catch(e => console.log(e));\n\t}\n\n\tasync save_and_checkout() {\n\t\tif (this.frm.is_dirty()) {\n\t\t\tlet save_error = false;\n\t\t\tawait this.frm.save(null, null, null, () => save_error = true);\n\t\t\t// only move to payment section if save is successful\n\t\t\t!save_error && this.payment.checkout();\n\t\t\t// show checkout button on error\n\t\t\tsave_error && setTimeout(() => {\n\t\t\t\tthis.cart.toggle_checkout_btn(true);\n\t\t\t}, 300); // wait for save to finish\n\t\t} else {\n\t\t\tthis.payment.checkout();\n\t\t}\n\t}\n};\n", "erpnext.PointOfSale.Controller = class extends erpnext.PointOfSale.Controller{\n\tmake_app() {\n\t\tthis.prepare_dom();\n\t\tthis.prepare_components();\n\t\tthis.prepare_menu();\n\t\tthis.make_new_invoice();\n\t\tthis.init_stripe_terminal();\n\t}\n\t\n\tinit_stripe_terminal(){\n\t\tif(window.enable_stripe_terminal == 1){\n\t\t\tthis.stripe = new erpnext.PointOfSale.StripeTerminal();\n\t\t\tfrappe.dom.freeze();\n\t\t\t//this.stripe.connect_to_stripe_terminal(this, true);\t\n\t\t\tthis.stripe.assign_stripe_connection_token(this, true);\n\t\t\tfrappe.dom.unfreeze();\n\t\t}\n\t}\n\t\n\tinit_order_summary() {\n\t\tthis.order_summary = new erpnext.PointOfSale.PastOrderSummary({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\tprocess_return: (name) => {\n\t\t\t\t\tthis.recent_order_list.toggle_component(false);\n\t\t\t\t\tfrappe.db.get_doc('POS Invoice', name).then((doc) => {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => this.make_return_invoice(doc),\n\t\t\t\t\t\t\t() => this.cart.load_invoice(),\n\t\t\t\t\t\t\t() => this.item_selector.toggle_component(true)\n\t\t\t\t\t\t]);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tedit_order: (name) => {\n\t\t\t\t\tthis.recent_order_list.toggle_component(false);\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => this.frm.refresh(name),\n\t\t\t\t\t\t() => this.frm.call('reset_mode_of_payments'),\n\t\t\t\t\t\t() => this.cart.load_invoice(),\n\t\t\t\t\t\t() => this.item_selector.toggle_component(true)\n\t\t\t\t\t]);\n\t\t\t\t},\n\t\t\t\tdelete_order: (name) => {\n\t\t\t\t\tfrappe.model.delete_doc(this.frm.doc.doctype, name, () => {\n\t\t\t\t\t\tthis.recent_order_list.refresh_list();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tnew_order: () => {\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => frappe.dom.freeze(),\n\t\t\t\t\t\t() => this.make_new_invoice(),\n\t\t\t\t\t\t() => this.item_selector.toggle_component(true),\n\t\t\t\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t\t\t]);\n\t\t\t\t},\n\t\t\t\traw_print: () => {\n\t\t\t\t\tthis.raw_print(this.frm);\n\t\t\t\t},\n\t\t\t\topen_cash_drawer: () => {\n\t\t\t\t\tthis.open_cash_drawer();\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\t\n\tasync prepare_app_defaults(data) {\n\t\tthis.pos_opening = data.name;\n\t\tthis.company = data.company;\n\t\tthis.pos_profile = data.pos_profile;\n\t\tthis.pos_opening_time = data.period_start_date;\n\t\tthis.item_stock_map = {};\n\t\tthis.settings = {};\n\n\t\tfrappe.db.get_value('Stock Settings', undefined, 'allow_negative_stock').then(({ message }) => {\n\t\t\tthis.allow_negative_stock = flt(message.allow_negative_stock) || false;\n\t\t});\n\t\t\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.selling.page.point_of_sale.point_of_sale.get_pos_profile_data\",\n\t\t\targs: { \"pos_profile\": this.pos_profile },\n\t\t\tcallback: (res) => {\n\t\t\t\tconst profile = res.message;\n\t\t\t\twindow.enable_raw_print = profile.enable_raw_printing;\n\t\t\t\twindow.enable_stripe_terminal = profile.enable_stripe_terminal;\n\t\t\t\twindow.stripe_mode_of_payment = profile.stripe_mode_of_payment;\n\t\t\t\t//Select raw printer\n\t\t\t\tif(window.enable_raw_print == 1){\n\t\t\t\t\tfrappe.db.get_doc('QZ Tray Settings', undefined).then((qz_doc) => {\n\t\t\t\t\t\tif(qz_doc.trusted_certificate != null && qz_doc.trusted_certificate != \"\" && qz_doc.private_certificate != \"\" && qz_doc.private_certificate != null){\n\t\t\t\t\t\t\tfrappe.ui.form.qz_init().then(function(){\n\t\t\t\t\t\t\t\t///// QZ Certificate ///\n\t\t\t\t\t\t\t\tqz.security.setCertificatePromise(function(resolve, reject) {\n\t\t\t\t\t\t\t\t\tresolve(qz_doc.trusted_certificate);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tqz.security.setSignaturePromise(function(toSign) {\n\t\t\t\t\t\t\t\t\treturn function(resolve, reject) {\n\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\tvar pk = KEYUTIL.getKey(qz_doc.private_certificate);\n\t\t\t\t\t\t\t\t\t\t\t//var sig = new KJUR.crypto.Signature({\"alg\": \"SHA512withRSA\"});  // Use \"SHA1withRSA\" for QZ Tray 2.0 and older\n\t\t\t\t\t\t\t\t\t\t\tvar sig = new KJUR.crypto.Signature({\"alg\": \"SHA1withRSA\"});  // Use \"SHA1withRSA\" for QZ Tray 2.0 and older\n\t\t\t\t\t\t\t\t\t\t\tsig.init(pk); \n\t\t\t\t\t\t\t\t\t\t\tsig.updateString(toSign);\n\t\t\t\t\t\t\t\t\t\t\tvar hex = sig.sign();\n\t\t\t\t\t\t\t\t\t\t\tresolve(stob64(hextorstr(hex)));\n\t\t\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t});\t\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\t\t\t\t'fields': [\n\t\t\t\t\t\t\t\t{'fieldname': 'printer', 'fieldtype': 'Select', 'reqd': 1, 'label': \"Printer\"}\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tprimary_action: function(){\n\t\t\t\t\t\t\t\twindow.raw_printer = d.get_values().printer;\n\t\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsecondary_action: function(){\n\t\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsecondary_action_label: \"Cancel\",\n\t\t\t\t\t\t\t'title': 'Select printer for Raw Printing'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfrappe.ui.form.qz_get_printer_list().then((data) => {\n\t\t\t\t\t\t\td.set_df_property('printer', 'options', data);\n\t\t\t\t\t\t\td.show();\n\t\t\t\t\t\t});\t\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\twindow.automatically_print = profile.automatically_print;\n\t\t\t\twindow.open_cash_drawer_automatically = profile.open_cash_drawer_automatically;\n\t\t\t\t//For weigh scale\n\t\t\t\twindow.enable_weigh_scale = profile.enable_weigh_scale;\n\t\t\t\tObject.assign(this.settings, profile);\n\t\t\t\tthis.settings.customer_groups = profile.customer_groups.map(group => group.name);\n\t\t\t\tthis.make_app();\n\t\t\t}\n\t\t});\n\t\t\n\t\t/*frappe.db.get_doc(\"POS Profile\", this.pos_profile).then((profile) => {\n\t\t\twindow.enable_raw_print = profile.enable_raw_printing;\n\t\t\twindow.enable_stripe_terminal = profile.enable_stripe_terminal;\n\t\t\twindow.stripe_mode_of_payment = profile.stripe_mode_of_payment;\n\t\t\t//Select raw printer\n\t\t\tif(window.enable_raw_print == 1){\n\t\t\t\tfrappe.db.get_doc('QZ Tray Settings', undefined).then((qz_doc) => {\n\t\t\t\t\tif(qz_doc.trusted_certificate != null && qz_doc.trusted_certificate != \"\" && qz_doc.private_certificate != \"\" && qz_doc.private_certificate != null){\n\t\t\t\t\t\tfrappe.ui.form.qz_init().then(function(){\n\t\t\t\t\t\t\t///// QZ Certificate ///\n\t\t\t\t\t\t\tqz.security.setCertificatePromise(function(resolve, reject) {\n\t\t\t\t\t\t\t\tresolve(qz_doc.trusted_certificate);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tqz.security.setSignaturePromise(function(toSign) {\n\t\t\t\t\t\t\t\treturn function(resolve, reject) {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tvar pk = KEYUTIL.getKey(qz_doc.private_certificate);\n\t\t\t\t\t\t\t\t\t\t//var sig = new KJUR.crypto.Signature({\"alg\": \"SHA512withRSA\"});  // Use \"SHA1withRSA\" for QZ Tray 2.0 and older\n\t\t\t\t\t\t\t\t\t\tvar sig = new KJUR.crypto.Signature({\"alg\": \"SHA1withRSA\"});  // Use \"SHA1withRSA\" for QZ Tray 2.0 and older\n\t\t\t\t\t\t\t\t\t\tsig.init(pk); \n\t\t\t\t\t\t\t\t\t\tsig.updateString(toSign);\n\t\t\t\t\t\t\t\t\t\tvar hex = sig.sign();\n\t\t\t\t\t\t\t\t\t\tresolve(stob64(hextorstr(hex)));\n\t\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t});\t\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\t\t\t'fields': [\n\t\t\t\t\t\t\t{'fieldname': 'printer', 'fieldtype': 'Select', 'reqd': 1, 'label': \"Printer\"}\n\t\t\t\t\t\t],\n\t\t\t\t\t\tprimary_action: function(){\n\t\t\t\t\t\t\twindow.raw_printer = d.get_values().printer;\n\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsecondary_action: function(){\n\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsecondary_action_label: \"Cancel\",\n\t\t\t\t\t\t'title': 'Select printer for Raw Printing'\n\t\t\t\t\t});\n\t\t\t\t\tfrappe.ui.form.qz_get_printer_list().then((data) => {\n\t\t\t\t\t\td.set_df_property('printer', 'options', data);\n\t\t\t\t\t\td.show();\n\t\t\t\t\t});\t\n\t\t\t\t});\n\t\t\t}\n\t\t\twindow.automatically_print = profile.automatically_print;\n\t\t\twindow.open_cash_drawer_automatically = profile.open_cash_drawer_automatically;\n\t\t\t//For weigh scale\n\t\t\twindow.enable_weigh_scale = profile.enable_weigh_scale;\n\t\t\tObject.assign(this.settings, profile);\n\t\t\tthis.settings.customer_groups = profile.customer_groups.map(group => group.customer_group);\n\t\t\tthis.make_app();\n\t\t});*/\n\t}\n\t\n\tinit_item_details() {\n\t\tthis.item_details = new erpnext.PointOfSale.ItemDetails({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tsettings: this.settings,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\ttoggle_item_selector: (minimize) => {\n\t\t\t\t\tthis.item_selector.resize_selector(minimize);\n\t\t\t\t\tthis.cart.toggle_numpad(minimize);\n\t\t\t\t},\n\n\t\t\t\tform_updated: (item, field, value) => {\n\t\t\t\t\tconst item_row = frappe.model.get_doc(item.doctype, item.name);\n\t\t\t\t\tif (item_row && item_row[field] != value) {\n\t\t\t\t\t\tconst args = {\n\t\t\t\t\t\t\tfield,\n\t\t\t\t\t\t\tvalue,\n\t\t\t\t\t\t\titem: this.item_details.current_item\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn this.on_cart_update(args);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t},\n\n\t\t\t\thighlight_cart_item: (item) => {\n\t\t\t\t\tconst cart_item = this.cart.get_cart_item(item);\n\t\t\t\t\tthis.cart.toggle_item_highlight(cart_item);\n\t\t\t\t},\n\n\t\t\t\titem_field_focused: (fieldname) => {\n\t\t\t\t\tthis.cart.toggle_numpad_field_edit(fieldname);\n\t\t\t\t},\n\t\t\t\tset_value_in_current_cart_item: (selector, value) => {\n\t\t\t\t\tthis.cart.update_selector_value_in_cart_item(selector, value, this.item_details.current_item);\n\t\t\t\t},\n\t\t\t\tclone_new_batch_item_in_frm: (batch_serial_map, item) => {\n\t\t\t\t\t// called if serial nos are 'auto_selected' and if those serial nos belongs to multiple batches\n\t\t\t\t\t// for each unique batch new item row is added in the form & cart\n\t\t\t\t\tObject.keys(batch_serial_map).forEach(batch => {\n\t\t\t\t\t\tconst item_to_clone = this.frm.doc.items.find(i => i.name == item.name);\n\t\t\t\t\t\tconst new_row = this.frm.add_child(\"items\", { ...item_to_clone });\n\t\t\t\t\t\t// update new serialno and batch\n\t\t\t\t\t\tnew_row.batch_no = batch;\n\t\t\t\t\t\tnew_row.serial_no = batch_serial_map[batch].join(`\\n`);\n\t\t\t\t\t\tnew_row.qty = batch_serial_map[batch].length;\n\t\t\t\t\t\tthis.frm.doc.items.forEach(row => {\n\t\t\t\t\t\t\tif (item.item_code === row.item_code) {\n\t\t\t\t\t\t\t\tthis.update_cart_html(row);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tremove_item_from_cart: () => this.remove_item_from_cart(),\n\t\t\t\tget_item_stock_map: () => this.item_stock_map,\n\t\t\t\tclose_item_details: () => {\n\t\t\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t\t\t\tthis.cart.prev_action = null;\n\t\t\t\t\tthis.cart.toggle_item_highlight();\n\t\t\t\t\t//For weigh scale\n\t\t\t\t\tif(window.enable_weigh_scale == 1){\n\t\t\t\t\t\twindow.is_item_details_open = false;\n\t\t\t\t\t\twindow.mettlerWorker.postMessage({\"command\": \"stop\"});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget_available_stock: (item_code, warehouse) => this.get_available_stock(item_code, warehouse)\n\t\t\t}\n\t\t});\n\t}\n\t\n\tremove_item_from_cart() {\n\t\tfrappe.dom.freeze();\n\t\tconst { doctype, name, current_item } = this.item_details;\n\n\t\treturn frappe.model.set_value(doctype, name, 'qty', 0)\n\t\t\t.then(() => {\n\t\t\t\tfrappe.model.clear_doc(doctype, name);\n\t\t\t\tthis.update_cart_html(current_item, true);\n\t\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t})\n\t\t\t.catch(e => console.log(e));\n\t\t\t\n\t\t//For weigh scale\n\t\tif(window.enable_weigh_scale == 1){\n\t\t\twindow.is_item_details_open = false;\n\t\t}\n\t}\n\t\n\tinit_payments() {\n\t\tthis.payment = new erpnext.PointOfSale.Payment({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm || {},\n\n\t\t\t\tget_customer_details: () => this.customer_details || {},\n\n\t\t\t\ttoggle_other_sections: (show) => {\n\t\t\t\t\tif (show) {\n\t\t\t\t\t\tthis.item_details.$component.is(':visible') ? this.item_details.$component.css('display', 'none') : '';\n\t\t\t\t\t\tthis.item_selector.toggle_component(false);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.item_selector.toggle_component(true);\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tsubmit_invoice: () => {\n\t\t\t\t\t//Support for stripe payments\n\t\t\t\t\tvar allowSubmit = 1;\n\t\t\t\t\tif(window.enable_stripe_terminal == 1)\n\t\t\t\t\t{\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(this.frm.doc.payments.length > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfor (var i=0;i<=this.frm.doc.payments.length;i++) {\n\t\t\t\t\t\t\t\tif(this.frm.doc.payments[i] != undefined){\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t if(this.frm.doc.payments[i].mode_of_payment == window.stripe_mode_of_payment && this.frm.doc.payments[i].base_amount != 0)\n\t\t\t\t\t\t\t\t\t {\n\t\t\t\t\t\t\t\t\t\tif(this.frm.doc.payments[i].amount > 0)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tallowSubmit = 0;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\telse if(this.frm.doc.is_return == 1 && this.frm.doc.payments[i].card_payment_intent){\n\t\t\t\t\t\t\t\t\t\t\tallowSubmit = 0;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\telse if(this.frm.doc.is_return == 1 && !this.frm.doc.payments[i].card_payment_intent){\n\t\t\t\t\t\t\t\t\t\t\tfrappe.throw(\"This transaction was not paid using a Stripe Payment. Please change the return payment method.\");\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t }\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (allowSubmit == 1){\n\t\t\t\t\t\tthis.frm.savesubmit()\n\t\t\t\t\t\t\t.then((r) => {\n\t\t\t\t\t\t\t\t//For raw printing\n\t\t\t\t\t\t\t\tif(window.open_cash_drawer_automatically == 1){\n\t\t\t\t\t\t\t\t\tthis.open_cash_drawer();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif(window.automatically_print == 1){\n\t\t\t\t\t\t\t\t\tthis.raw_print(this.frm);\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tthis.toggle_components(false);\n\t\t\t\t\t\t\t\tthis.order_summary.toggle_component(true);\n\t\t\t\t\t\t\t\tthis.order_summary.load_summary_of(this.frm.doc, true);\n\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\tindicator: 'green',\n\t\t\t\t\t\t\t\t\tmessage: __('POS invoice {0} created succesfully', [r.doc.name])\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\t//var stripe = new erpnext.PointOfSale.StripeTerminal();\n\t\t\t\t\t\t//this.stripe.assign_stripe_connection_token(this,true);\n\t\t\t\t\t\tthis.stripe.collecting_payments(this, true);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\traw_print: () => {\n\t\t\t\t\tthis.raw_print(this.frm);\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\topen_cash_drawer: () => {\n\t\t\t\t\tthis.open_cash_drawer();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\t\n\tasync on_cart_update(args) {\n\t\tfrappe.dom.freeze();\n\t\tlet item_row = undefined;\n\t\ttry {\n\t\t\tlet { field, value, item } = args;\n\t\t\titem_row = this.get_item_from_frm(item);\n\t\t\tconst item_row_exists = !$.isEmptyObject(item_row);\n\n\t\t\tconst from_selector = field === 'qty' && value === \"+1\";\n\t\t\tif (from_selector)\n\t\t\t\tvalue = flt(item_row.qty) + flt(value);\n\n\t\t\tif (item_row_exists) {\n\t\t\t\tif (field === 'qty')\n\t\t\t\t\tvalue = flt(value);\n\n\t\t\t\tif (['qty', 'conversion_factor'].includes(field) && value > 0 && !this.allow_negative_stock) {\n\t\t\t\t\tconst qty_needed = field === 'qty' ? value * item_row.conversion_factor : item_row.qty * value;\n\t\t\t\t\tawait this.check_stock_availability(item_row, qty_needed, this.frm.doc.set_warehouse);\n\t\t\t\t}\n\n\t\t\t\tif (this.is_current_item_being_edited(item_row) || from_selector) {\n\t\t\t\t\tawait frappe.model.set_value(item_row.doctype, item_row.name, field, value);\n\t\t\t\t\tthis.update_cart_html(item_row);\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tif (!this.frm.doc.customer)\n\t\t\t\t\treturn this.raise_customer_selection_alert();\n\n\t\t\t\tconst { item_code, batch_no, serial_no, rate } = item;\n\n\t\t\t\tif (!item_code)\n\t\t\t\t\treturn;\n\n\t\t\t\tconst new_item = { item_code, batch_no, rate, [field]: value };\n\n\t\t\t\tif (serial_no) {\n\t\t\t\t\tawait this.check_serial_no_availablilty(item_code, this.frm.doc.set_warehouse, serial_no);\n\t\t\t\t\tnew_item['serial_no'] = serial_no;\n\t\t\t\t}\n\n\t\t\t\tif (field === 'serial_no')\n\t\t\t\t\tnew_item['qty'] = value.split(`\\n`).length || 0;\n\n\t\t\t\titem_row = this.frm.add_child('items', new_item);\n\n\t\t\t\tif (field === 'qty' && value !== 0 && !this.allow_negative_stock)\n\t\t\t\t\tawait this.check_stock_availability(item_row, value, this.frm.doc.set_warehouse);\n\n\t\t\t\tawait this.trigger_new_item_events(item_row);\n\n\t\t\t\tthis.update_cart_html(item_row);\n\n\t\t\t\tif (this.item_details.$component.is(':visible'))\n\t\t\t\t\tthis.edit_item_details_of(item_row);\n\n\t\t\t\tif (this.check_serial_batch_selection_needed(item_row) && !this.item_details.$component.is(':visible'))\n\t\t\t\t\tthis.edit_item_details_of(item_row);\n\t\t\t}\n\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t} finally {\n\t\t\tif(window.enable_stripe_terminal == 1){\n\t\t\t\tthis.stripe.display_details(this);\n\t\t\t}\n\t\t\tfrappe.dom.unfreeze();\n\t\t\treturn item_row;\n\t\t}\n\t}\n\t\n\topen_cash_drawer(){\n\t\tif(window.enable_raw_print == 1 && window.raw_printer){\n\t\t\tvar me = this;\n\t\t\tfrappe.ui.form.qz_get_printer_list().then(function(printers){\n\t\t\t\tvar config;\n\t\t\t\tprinters.forEach(function(printer){\n\t\t\t\t\tif(printer == window.raw_printer){\n\t\t\t\t\t\tconfig = qz.configs.create(printer);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tvar data = [\n\t\t\t\t\t'\\x10' + '\\x14' + '\\x01' + '\\x00' + '\\x05' //Generate Pulse to kick-out cash drawer\n\t\t\t\t];\n\t\t\t\tqz.print(config, data);\n\t\t\t});\n\t\t}\n\t}\n\t\n\traw_print(frm){\n\t\tif(window.enable_raw_print == 1 && window.raw_printer){\n\t\t\tvar me = this;\n\t\t\t\n\t\t\tfrappe.ui.form.qz_get_printer_list().then(function(printers){\n\t\t\t\tvar config;\n\t\t\t\tprinters.forEach(function(printer){\n\t\t\t\t\tif(printer == window.raw_printer){\n\t\t\t\t\t\tconfig = qz.configs.create(printer);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tvar data = [\n\t\t\t\t\t'\\x1B' + '\\x40', //init\n\t\t\t\t\t'\\x1B' + '\\x61' + '\\x31', //center align\n\t\t\t\t\tfrm.doc.company + '\\x0A',\n\t\t\t\t\t'\\x1B' + '\\x45' + '\\x0D', //bold on\n\t\t\t\t\t'Invoice' + '\\x0A',\n\t\t\t\t\t'\\x1B' + '\\x45' + '\\x0A', //bold off\n\t\t\t\t\t'Receipt No: ' + frm.doc.name + '\\x0A',\n\t\t\t\t\t'Cashier: ' + frm.doc.owner + '\\x0A',\n\t\t\t\t\t'Customer: ' + frm.doc.customer_name + '\\x0A',\n\t\t\t\t\t'Date: ' + moment(frm.doc.posting_date).format(\"MM-DD-YYYY\") + '\\x0A',\n\t\t\t\t\t'Time: ' + frm.doc.posting_time + '\\x0A' + '\\x0A',\n\t\t\t\t\t'\\x1B' + '\\x61' + '\\x30', // left align\n\t\t\t\t\t'\\x1B' + '\\x45' + '\\x0D', //bold on\n\t\t\t\t\t'Item                                Amount' + '\\x0A',\n\t\t\t\t\t'\\x1B' + '\\x45' + '\\x0A' //bold off\n\t\t\t\t];\n\t\t\t\tfrm.doc.items.forEach(function(row){\n\t\t\t\t\tvar rdata = me.get_item_print(row.item_name, row.qty, row.rate, row.amount);\n\t\t\t\t\tdata.push.apply(data, rdata)\n\t\t\t\t});\n\t\t\t\t//data.push(\n\t\t\t\t//\t'\\x1B' + '\\x61' + '\\x32' // right align\n\t\t\t\t//);\n\t\t\t\tvar tprint = me.get_total_print(frm.doc);\n\t\t\t\tdata.push.apply(data, tprint);\n\t\t\t\tvar cut = [\n\t\t\t\t   '\\x0A' + '\\x0A' + '\\x0A' + '\\x0A' + '\\x0A' + '\\x0A' + '\\x0A',\n\t\t\t\t   '\\x1B' + '\\x69'\n\t\t\t\t]\n\t\t\t\tdata.push.apply(data, cut);   // cut paper (old syntax)\n\t\t\t\tqz.print(config, data);\n\t\t\t});\n\t\t}\n\t}\n\t\n\tget_total_print(doc){\n\t\tvar ret = [];\n\t\tvar length = doc.total.toString().length;\n\t\tvar total = 'Total ';\n\t\tfor(var i=length; i<=11; i++){\n\t\t\ttotal = total + ' ';\n\t\t}\n\t\ttotal = total + '$' + doc.total.toString();\n\t\tvar tlength = total.length;\n\t\t//Add extra spaces to align everything to the right\n\t\tfor(var i=0; i<(42-tlength); i++){\n\t\t\ttotal = ' ' + total;\n\t\t}\n\t\tret.push(total  + '\\x0A');\n\t\t\n\t\t//For taxes\n\t\tif(doc.taxes && doc.taxes.length > 0){\n\t\t\tdoc.taxes.forEach(function(row){\n\t\t\t\tlength = row.total.toString().length;\n\t\t\t\ttotal = row.description;\n\t\t\t\tfor(var i=length; i<=11; i++){\n\t\t\t\t\ttotal = total + ' ';\n\t\t\t\t}\n\t\t\t\ttotal = total + '$' + doc.total.toString();\n\t\t\t\tvar tlength = total.length;\n\t\t\t\t//Add extra spaces to align everything to the right\n\t\t\t\tfor(var i=0; i<(42-tlength); i++){\n\t\t\t\t\ttotal = ' ' + total;\n\t\t\t\t}\n\t\t\t\tret.push(total + '\\x0A');\n\t\t\t});\n\t\t}\n\t\t\n\t\t\n\t\t//Grand Total\n\t\tret.push('\\x1B' + '\\x45' + '\\x0D'); //Bold on\n\t\ttotal = 'Grand Total ';\n\t\tlength = doc.grand_total.toString().length;\n\t\tfor(var i=length; i<=11; i++){\n\t\t\ttotal = total + ' ';\n\t\t}\n\t\ttotal = total + '$' + doc.grand_total.toString();\n\t\tvar tlength = total.length;\n\t\t//Add extra spaces to align everything to the right\n\t\tfor(var i=0; i<(42-tlength); i++){\n\t\t\ttotal = ' ' + total;\n\t\t}\n\t\tret.push(total + '\\x0A');\n\t\tret.push('\\x1B' + '\\x45' + '\\x0A'); //Bold off\n\t\t\n\t\t//Payments\n\t\tvar stripe_info = [];\n\t\tvar cash_drawer = [];\n\t\tif(doc.payments && doc.payments.length > 0){\n\t\t\tdoc.payments.forEach(function(row){\n\t\t\t\tif(row.base_amount > 0){\n\t\t\t\t\tlength = row.base_amount.toString().length;\n\t\t\t\t\ttotal = row.mode_of_payment + ' ';\n\t\t\t\t\tfor(var i=length; i<=11; i++){\n\t\t\t\t\t\ttotal = total + ' ';\n\t\t\t\t\t}\n\t\t\t\t\ttotal = total + '$' + row.base_amount.toString();\n\t\t\t\t\tvar tlength = total.length;\n\t\t\t\t\t//Add extra spaces to align everything to the right\n\t\t\t\t\tfor(var i=0; i<(42-tlength); i++){\n\t\t\t\t\t\ttotal = ' ' + total;\n\t\t\t\t\t}\n\t\t\t\t\tret.push(total + '\\x0A');\n\t\t\t\t\t\n\t\t\t\t\t//If it's a stripe payment, add mandatory information at end o receipt\n\t\t\t\t\tif(row.mode_of_payment==window.stripe_mode_of_payment && row.base_amount > 0){\n\t\t\t\t\t\tstripe_info = [\n\t\t\t\t\t\t\t'\\x1B' + '\\x61' + '\\x31', // center align,\n\t\t\t\t\t\t\t'\\x0A',\n\t\t\t\t\t\t\trow.card_brand.toUpperCase() + ' XXXXXXXXXXXX' + row.card_last4 + '\\x0A',\n\t\t\t\t\t\t\t'Auth CD: ' + row.card_authorization_code + '\\x0A',\n\t\t\t\t\t\t\t'AID: ' + row.card_dedicated_file_name + '\\x0A',\n\t\t\t\t\t\t\trow.card_application_preferred_name + '\\x0A',\n\t\t\t\t\t\t\t'TVR: ' + row.card_terminal_verification_results + '\\x0A',\n\t\t\t\t\t\t\t'TSI: ' + row.card_transaction_status_information + '\\x0A',\n\t\t\t\t\t\t\t'IAD: ' + row.card_dedicated_file_name\n\t\t\t\t\t\t];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t\n\t\t//Total Payments\n\t\tret.push('\\x1B' + '\\x45' + '\\x0D'); //Bold on\n\t\ttotal = 'Paid Amount ';\n\t\tlength = doc.grand_total.toString().length;\n\t\tfor(var i=length; i<=11; i++){\n\t\t\ttotal = total + ' ';\n\t\t}\n\t\ttotal = total + '$' + doc.paid_amount.toString()\n\t\tvar tlength = total.length;\n\t\t//Add extra spaces to align everything to the right\n\t\tfor(var i=0; i<(42-tlength); i++){\n\t\t\ttotal = ' ' + total;\n\t\t}\n\t\tret.push(total + '\\x0A');\n\t\tret.push('\\x1B' + '\\x45' + '\\x0A'); //Bold off\n\t\t\n\t\t//Add the stripe data\n\t\tif(stripe_info.length > 0){\n\t\t\tret.push.apply(ret, stripe_info);\n\t\t}\n\t\t\n\t\treturn ret;\n\t}\n\t\n\tget_item_print(item, qty, rate, amount){\n\t\tvar ilength = item.length;\n\t\tvar ret = [];\n\t\t//Put in for loop in case item length > 30\n\t\tfor(var i=0; i<ilength; i=i+29){\n\t\t\tret.push(item.substring(i, i+29) + \"\\x0A\");\n\t\t}\n\t\t\n\t\t//For quantity\n\t\tvar qty_rate = \"$\" + rate.toString() + \"x \" + qty.toString();\n\t\tvar qlength = qty_rate.length;\n\t\tfor(var i=0; i<(30-qlength); i++){\n\t\t\tqty_rate = qty_rate + \" \";\n\t\t}\n\t\t\n\t\t//Add amount at end of qty-rate line\n\t\tvar alength = amount.toString().length;\n\t\tfor(var i=0; i<(11-alength); i++){\n\t\t\tqty_rate = qty_rate + \" \";\n\t\t}\n\t\tqty_rate = qty_rate + \"$\" + amount.toString();\n\t\tret.push(qty_rate + \"\\x0A\");\n\t\treturn ret;\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
